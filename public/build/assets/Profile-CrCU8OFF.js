import{r as A,Y as w,c as y,j as D,b as m,e as s,g as V,t as l,i as p,x as q,y as U,V as d,a1 as i,l as x,f as B,o as f}from"./vendor-DnFm82Vn.js";import{u as F,a as T,A as I,P as R}from"./app-BLDFnswJ.js";const L={class:"max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},G={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},H={class:"lg:col-span-1"},Y={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},J={class:"text-center"},K={class:"text-lg font-semibold text-gray-900"},O={class:"text-sm text-gray-600"},Q={class:"mt-4 flex items-center justify-center space-x-2"},W={class:"flex items-center text-sm text-gray-600"},X={class:"mt-4 text-xs text-gray-500"},Z={class:"mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ee={class:"space-y-4"},se={class:"flex justify-between items-center"},te={class:"font-semibold text-gray-900"},re={class:"flex justify-between items-center"},oe={class:"font-semibold text-purple-600"},ae={class:"flex justify-between items-center"},le={class:"font-semibold text-blue-600"},ne={class:"flex justify-between items-center"},de={class:"font-semibold text-blue-600"},ie={class:"lg:col-span-2"},ue={class:"bg-white rounded-xl shadow-sm border border-gray-200"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6"},me={class:"mt-6"},fe={class:"mt-6"},be={class:"border-t border-gray-200 pt-6"},ve={class:"space-y-4"},ge={class:"text-sm text-gray-600 bg-gray-100 rounded-lg p-3"},we={class:"flex justify-end space-x-4 pt-6 border-t border-gray-200"},xe=["disabled"],ye={class:"mt-6 bg-white rounded-xl shadow-sm border border-gray-200"},_e={key:0,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},he={class:"space-y-4"},Ae={key:0},Ve=["required"],Ue={key:0,class:"mt-1 text-sm text-red-600"},ke={class:"block text-sm font-medium text-gray-700 mb-2"},Ee={key:0,class:"mt-1 text-sm text-red-600"},Ce={class:"flex justify-end pt-6 border-t border-gray-200"},Se=["disabled"],$e={__name:"Profile",setup(Pe){const b=F(),{get:k,put:_}=T(),v=A(!1),g=A(!1),u=w({products:0,lotteries:0,orders:0,revenue:0}),c=w({current_password:"",new_password:""}),t=y(()=>b.user),E=y(()=>{if(!t.value)return"U";const r=t.value.first_name?.[0]||"",e=t.value.last_name?.[0]||"";return(r+e).toUpperCase()}),C=y(()=>t.value&&t.value.roles&&Array.isArray(t.value.roles)&&t.value.roles.length>0?t.value.roles.map(e=>{switch(e.name){case"Business Individual":return"Vendeur Individuel (simple-dashboard)";case"Business Enterprise":return"Vendeur Entreprise (dashboard complet)";case"Business":return"Vendeur (legacy)";case"Particulier":return"Client";case"Admin":return"Administrateur";case"Super Admin":return"Super Administrateur";case"Agent":return"Agent";default:return e.name}}).join(", "):"Non défini"),o=w({first_name:"",last_name:"",email:"",phone:"",city:"",address:"",bio:""}),n=w({current_password:"",new_password:"",new_password_confirmation:"",showCurrentPassword:!1}),h=()=>{t.value&&(o.first_name=t.value.first_name||"",o.last_name=t.value.last_name||"",o.email=t.value.email||"",o.phone=t.value.phone||"",o.city=t.value.city||"",o.address=t.value.address||"",o.bio=t.value.bio||"")},S=async()=>{try{const r=await k("/merchant/dashboard/stats");r.data&&(u.products=r.data.total_products||0,u.lotteries=r.data.active_lotteries||0,u.orders=r.data.total_orders||0,u.revenue=r.data.revenue_this_month||0)}catch(r){console.error("Erreur lors du chargement des statistiques:",r)}},P=async()=>{v.value=!0;try{await _("/user/profile",o),await b.refreshUser(),window.$toast&&window.$toast.success("Profil mis à jour avec succès","✅ Profil")}catch(r){console.error("Erreur lors de la mise à jour du profil:",r),window.$toast&&window.$toast.error("Erreur lors de la mise à jour du profil","❌ Erreur")}finally{v.value=!1}},M=()=>{h()},j=async()=>{g.value=!0,c.current_password="",c.new_password="";try{const r={new_password:n.new_password,new_password_confirmation:n.new_password_confirmation};(t.value?.has_password||n.current_password)&&(r.current_password=n.current_password);const e=await _("/user/password",r);if(n.current_password="",n.new_password="",n.new_password_confirmation="",window.$toast){const a=e.data?.is_first_password?"Mot de passe défini avec succès":"Mot de passe modifié avec succès";window.$toast.success(a,"✅ Sécurité")}await b.refreshUser()}catch(r){if(console.error("Erreur lors du changement de mot de passe:",r),r.response?.data?.errors){const e=r.response.data.errors;e.current_password&&(c.current_password=Array.isArray(e.current_password)?e.current_password[0]:e.current_password),e.new_password&&(c.new_password=Array.isArray(e.new_password)?e.new_password[0]:e.new_password)}if(window.$toast){const e=r.response?.data?.message||"Erreur lors du changement de mot de passe";window.$toast.error(e,"❌ Erreur")}}finally{g.value=!1}},$=()=>t.value?`https://ui-avatars.com/api/?name=${E.value}&background=3b82f6&color=fff&size=128`:"/default-avatar.png",N=r=>{console.log("Avatar upload success:",r);const e=r?.avatar_url||r?.data?.avatar_url||r?.response?.avatar_url;e?(t.value&&(t.value.avatar_url=e),b.refreshUser(),window.$toast&&window.$toast.success("Photo de profil mise à jour avec succès","✅ Photo")):console.warn("No avatar URL in response:",r)},z=r=>{console.error("Erreur upload avatar:",r);let e="Erreur lors de la mise à jour de la photo";r?.message?e=r.message:typeof r=="string"&&(e=r),window.$toast&&window.$toast.error(e,"❌ Erreur")};return D(()=>{h(),S()}),(r,e)=>(f(),m("div",L,[e[32]||(e[32]=s("div",{class:"mb-8"},[s("h1",{class:"text-3xl font-bold text-gray-900"},"Mon Profil"),s("p",{class:"mt-2 text-gray-600"},"Gérez vos informations personnelles et professionnelles")],-1)),s("div",G,[s("div",H,[s("div",Y,[s("div",J,[V(I,{currentAvatarUrl:t.value?.avatar_url||$(),uploadEndpoint:"/merchant/profile/avatar",fieldName:"avatar",altText:`Photo de profil de ${t.value?.first_name} ${t.value?.last_name}`,helpText:"Cliquez pour modifier votre photo de profil",maxSizeMB:5,onSuccess:N,onError:z},null,8,["currentAvatarUrl","altText"]),s("h3",K,l(t.value?.first_name)+" "+l(t.value?.last_name),1),s("p",O,l(t.value?.email),1),s("div",Q,[s("div",W,[s("div",{class:q(["w-2 h-2 rounded-full mr-2",t.value?.is_active?"bg-blue-400":"bg-red-400"])},null,2),p(" "+l(t.value?.is_active?"Compte actif":"Compte inactif"),1)])]),s("div",X,[e[10]||(e[10]=s("p",null,"Membre depuis",-1)),s("p",null,l(t.value?.created_at?new Date(t.value.created_at).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"Non disponible"),1)])])]),s("div",Z,[e[15]||(e[15]=s("h4",{class:"font-semibold text-gray-900 mb-4"},"Mes statistiques",-1)),s("div",ee,[s("div",se,[e[11]||(e[11]=s("span",{class:"text-sm text-gray-600"},"Produits",-1)),s("span",te,l(u.products||0),1)]),s("div",re,[e[12]||(e[12]=s("span",{class:"text-sm text-gray-600"},"Tombolas actives",-1)),s("span",oe,l(u.lotteries||0),1)]),s("div",ae,[e[13]||(e[13]=s("span",{class:"text-sm text-gray-600"},"Commandes",-1)),s("span",le,l(u.orders||0),1)]),s("div",ne,[e[14]||(e[14]=s("span",{class:"text-sm text-gray-600"},"Revenus ce mois",-1)),s("span",de,l((u.revenue||0).toLocaleString("fr-FR"))+" FCFA",1)])])])]),s("div",ie,[s("div",ue,[s("form",{onSubmit:U(P,["prevent"]),class:"space-y-6 p-6"},[s("div",null,[e[22]||(e[22]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Informations personnelles",-1)),s("div",ce,[s("div",null,[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Prénom "),s("span",{class:"text-red-500"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.first_name=a),type:"text",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"}},null,512),[[i,o.first_name]])]),s("div",null,[e[17]||(e[17]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Nom "),s("span",{class:"text-red-500"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.last_name=a),type:"text",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"}},null,512),[[i,o.last_name]])])]),s("div",pe,[s("div",null,[e[18]||(e[18]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Email "),s("span",{class:"text-red-500"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.email=a),type:"email",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"}},null,512),[[i,o.email]])]),s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Téléphone "),s("span",{class:"text-red-500"},"*")],-1)),V(R,{modelValue:o.phone,"onUpdate:modelValue":e[3]||(e[3]=a=>o.phone=a),placeholder:"Numéro de téléphone","initial-country":"ga"},null,8,["modelValue"])])]),s("div",me,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Ville",-1)),d(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.city=a),type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"}},null,512),[[i,o.city]])]),s("div",fe,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Adresse",-1)),d(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.address=a),rows:"3",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"},placeholder:"Votre adresse complète..."},null,512),[[i,o.address]])])]),s("div",be,[e[25]||(e[25]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Informations business",-1)),s("div",ve,[s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rôle",-1)),s("div",ge,l(C.value),1)]),s("div",null,[e[24]||(e[24]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bio professionnelle",-1)),d(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.bio=a),rows:"4",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"},placeholder:"Décrivez votre activité, vos produits, votre expertise..."},null,512),[[i,o.bio]])])])]),s("div",we,[s("button",{type:"button",onClick:M,class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"}," Annuler "),s("button",{type:"submit",disabled:v.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50"},l(v.value?"Sauvegarde...":"Sauvegarder"),9,xe)])],32)]),s("div",ye,[s("form",{onSubmit:U(j,["prevent"]),class:"space-y-6 p-6"},[s("div",null,[e[31]||(e[31]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Changer le mot de passe",-1)),t.value?.has_password?x("",!0):(f(),m("div",_e,e[26]||(e[26]=[B('<div class="flex items-start"><svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="flex-1"><p class="text-sm font-medium text-blue-800">Compte connecté via réseau social</p><p class="text-sm text-blue-700 mt-1"> Vous vous êtes connecté via Google ou Facebook. Définissez un mot de passe pour pouvoir vous connecter directement avec votre email. </p></div></div>',1)]))),s("div",he,[t.value?.has_password||n.showCurrentPassword?(f(),m("div",Ae,[e[27]||(e[27]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Mot de passe actuel "),s("span",{class:"text-red-500"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>n.current_password=a),type:"password",required:t.value?.has_password,class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"},placeholder:"Entrez votre mot de passe actuel"},null,8,Ve),[[i,n.current_password]]),c.current_password?(f(),m("p",Ue,l(c.current_password),1)):x("",!0)])):x("",!0),s("div",null,[s("label",ke,[p(l(t.value?.has_password?"Nouveau mot de passe":"Mot de passe")+" ",1),e[28]||(e[28]=s("span",{class:"text-red-500"},"*",-1))]),d(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>n.new_password=a),type:"password",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"},placeholder:"Minimum 8 caractères"},null,512),[[i,n.new_password]]),e[29]||(e[29]=s("p",{class:"mt-1 text-xs text-gray-500"}," Minimum 8 caractères, avec au moins une majuscule, une minuscule et un chiffre ",-1)),c.new_password?(f(),m("p",Ee,l(c.new_password),1)):x("",!0)]),s("div",null,[e[30]||(e[30]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Confirmer le mot de passe "),s("span",{class:"text-red-500"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>n.new_password_confirmation=a),type:"password",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{color:"#5f5f5f"},placeholder:"Confirmez votre mot de passe"},null,512),[[i,n.new_password_confirmation]])])])]),s("div",Ce,[s("button",{type:"submit",disabled:g.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50"},l(g.value?"Sauvegarde...":t.value?.has_password?"Changer le mot de passe":"Définir le mot de passe"),9,Se)])],32)])])])]))}};export{$e as default};
