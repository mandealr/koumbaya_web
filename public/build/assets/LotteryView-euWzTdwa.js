import{b as p,l as x,o as u,e as t,O as W,x as X,U as E,V as L,r as j,K as Y,c as g,j as Z,z as A,g as i,w as R,h as tt,t as o,v as et,i as _,u as r,a7 as st,G as ot,aR as at,D as lt,I as nt,A as it,ak as rt,a6 as V,at as dt,s as ut,an as ct,aF as mt,b3 as pt,F as vt,y as xt,aw as gt}from"./vendor-jx2CZFIM.js";import{a as _t}from"./app-BHl73pPI.js";const bt={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},yt={__name:"LotteryDrawModal",props:{show:{type:Boolean,default:!1},lottery:{type:Object,default:()=>({})}},emits:["close","confirm"],setup(f,{emit:w}){const $=f,s=w,c=()=>{s("close")},v=()=>{s("confirm",$.lottery)};return(b,y)=>f.show?(u(),p("div",bt,[t("div",{class:"flex items-center justify-center min-h-screen px-4 text-center sm:block sm:p-0"},[t("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-40 transition-opacity",onClick:c}),t("div",{class:"koumbaya-card inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle bg-white shadow-xl transform transition-all"},[y[0]||(y[0]=t("div",{class:"koumbaya-card-header"},[t("h3",{class:"koumbaya-heading-4"},"Lancer le tirage")],-1)),y[1]||(y[1]=t("div",{class:"koumbaya-card-body"},[t("p",{class:"koumbaya-text-body"}," Êtes-vous sûr de vouloir lancer le tirage pour cette tombola ? Cette action est irréversible. ")],-1)),t("div",{class:"koumbaya-card-footer"},[t("div",{class:"flex gap-4"},[t("button",{onClick:c,class:"koumbaya-btn koumbaya-btn-outline flex-1"}," Annuler "),t("button",{onClick:v,class:"koumbaya-btn koumbaya-btn-primary flex-1"}," Confirmer ")])])])])])):x("",!0)}},ft={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},wt={class:"flex items-center justify-center min-h-screen px-4 text-center"},ht={class:"koumbaya-card inline-block w-full max-w-md my-8 overflow-hidden text-left align-middle bg-white shadow-xl transform transition-all"},kt={class:"koumbaya-form-group"},$t={class:"koumbaya-form-group"},Dt={__name:"LotteryExtendModal",props:{show:{type:Boolean,default:!1},lottery:{type:Object,default:()=>({})}},emits:["close","submit"],setup(f,{emit:w}){const $=f,s=w,c=W({newDrawDate:"",reason:""}),v=()=>{s("close")},b=()=>{s("submit",{lotteryId:$.lottery.id,...c})};return(y,n)=>f.show?(u(),p("div",ft,[t("div",wt,[t("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-40 transition-opacity",onClick:v}),t("div",ht,[n[5]||(n[5]=t("div",{class:"koumbaya-card-header"},[t("h3",{class:"koumbaya-heading-4"},"Prolonger la tombola")],-1)),t("form",{onSubmit:X(b,["prevent"]),class:"koumbaya-card-body space-y-4"},[t("div",kt,[n[2]||(n[2]=t("label",{class:"koumbaya-label"},"Nouvelle date de tirage",-1)),E(t("input",{"onUpdate:modelValue":n[0]||(n[0]=D=>c.newDrawDate=D),type:"datetime-local",required:"",class:"koumbaya-input"},null,512),[[L,c.newDrawDate]])]),t("div",$t,[n[3]||(n[3]=t("label",{class:"koumbaya-label"},"Raison de la prolongation",-1)),E(t("textarea",{"onUpdate:modelValue":n[1]||(n[1]=D=>c.reason=D),rows:"3",class:"koumbaya-input",placeholder:"Expliquez pourquoi vous prolongez cette tombola...",required:""},null,512),[[L,c.reason]])]),t("div",{class:"koumbaya-card-footer"},[t("div",{class:"flex gap-4"},[t("button",{type:"button",onClick:v,class:"koumbaya-btn koumbaya-btn-outline flex-1"}," Annuler "),n[4]||(n[4]=t("button",{type:"submit",class:"koumbaya-btn koumbaya-btn-primary flex-1"}," Prolonger ",-1))])])],32)])])])):x("",!0)}},jt={class:"space-y-6"},Ct={class:"flex justify-between items-start"},Mt={class:"flex items-center space-x-3 mb-2"},Pt={class:"text-3xl font-bold text-gray-900"},Ft={class:"flex space-x-3"},Tt={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Et={class:"bg-white p-6 rounded-xl shadow-sm border"},Lt={class:"flex items-center"},At={class:"p-3 bg-blue-100 rounded-lg"},Rt={class:"ml-4"},Vt={class:"text-2xl font-bold text-gray-900"},zt={class:"bg-white p-6 rounded-xl shadow-sm border"},St={class:"flex items-center"},qt={class:"p-3 bg-blue-100 rounded-lg"},Nt={class:"ml-4"},Bt={class:"text-2xl font-bold text-gray-900"},It={class:"bg-white p-6 rounded-xl shadow-sm border"},Ot={class:"flex items-center"},Ut={class:"p-3 bg-purple-100 rounded-lg"},Gt={class:"ml-4"},Jt={class:"text-2xl font-bold text-gray-900"},Kt={class:"bg-white p-6 rounded-xl shadow-sm border"},Ht={class:"flex items-center"},Qt={class:"p-3 bg-yellow-100 rounded-lg"},Wt={class:"ml-4"},Xt={class:"text-2xl font-bold text-gray-900"},Yt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Zt={class:"lg:col-span-2 space-y-6"},te={class:"bg-white rounded-xl shadow-sm border overflow-hidden"},ee={class:"p-6"},se={class:"flex space-x-6"},oe={class:"flex-shrink-0"},ae=["src","alt"],le={class:"flex-1"},ne={class:"text-xl font-semibold text-gray-900 mb-2"},ie={class:"text-gray-600 mb-4"},re={class:"grid grid-cols-2 gap-4"},de={class:"text-lg font-semibold text-gray-900"},ue={class:"text-lg font-semibold text-gray-900"},ce={class:"text-lg font-semibold text-gray-900"},me={class:"text-lg font-semibold text-gray-900"},pe={class:"bg-white rounded-xl shadow-sm border"},ve={class:"p-6"},xe={class:"space-y-4"},ge={class:"flex justify-between items-center mb-2"},_e={class:"text-sm text-gray-500"},be={class:"w-full bg-gray-200 rounded-full h-2"},ye={class:"flex justify-between items-center mb-2"},fe={class:"text-sm text-gray-500"},we={class:"text-xs text-gray-600"},he={key:0},ke={class:"flex justify-between items-center mb-2"},$e={class:"text-sm text-gray-500"},De={class:"w-full bg-gray-200 rounded-full h-2"},je={class:"mt-6 grid grid-cols-3 gap-4 text-center"},Ce={class:"p-4 bg-blue-50 rounded-lg"},Me={class:"text-2xl font-bold text-blue-600"},Pe={class:"p-4 bg-blue-50 rounded-lg"},Fe={class:"text-2xl font-bold text-blue-600"},Te={class:"p-4 bg-yellow-50 rounded-lg"},Ee={class:"text-2xl font-bold text-yellow-600"},Le={key:0,class:"bg-white rounded-xl shadow-sm border"},Ae={class:"px-6 py-4 border-b border-gray-200"},Re={class:"text-lg font-semibold text-gray-900 flex items-center"},Ve={class:"p-6"},ze={class:"flex items-center space-x-4"},Se={class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center"},qe={class:"font-semibold text-gray-900"},Ne={class:"text-sm text-gray-600"},Be={class:"space-y-6"},Ie={class:"bg-white rounded-xl shadow-sm border"},Oe={class:"p-6 space-y-3"},Ue={class:"bg-white rounded-xl shadow-sm border"},Ge={class:"px-6 py-4 border-b border-gray-200"},Je={class:"flex justify-between items-center"},Ke={class:"p-6"},He={class:"space-y-3"},Qe={class:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"},We={class:"text-sm font-medium text-gray-600"},Xe={class:"flex-1 min-w-0"},Ye={class:"text-sm font-medium text-gray-900 truncate"},Ze={class:"text-xs text-gray-500"},ts={class:"text-sm text-gray-500"},es={class:"bg-white rounded-xl shadow-sm border"},ss={class:"p-6"},os={class:"space-y-4"},as={class:"flex justify-between"},ls={class:"text-sm font-medium text-gray-900"},ns={class:"flex justify-between"},is={class:"text-sm font-medium text-gray-900"},rs={class:"flex justify-between"},ds={class:"text-sm font-medium text-gray-900"},us={class:"flex justify-between"},cs={class:"text-sm font-medium text-blue-600"},vs={__name:"LotteryView",setup(f){const w=Y(),{get:$}=_t(),s=j({id:w.params.id,title:"",description:"",status:"",product_value:0,ticket_price:0,category:"",participants_count:0,tickets_sold:0,total_revenue:0,max_participants:0,revenue_target:0,end_date:"",created_at:"",views_count:0,product_image:"",winner:null,draw_date:null,product:null,lottery_number:"",max_tickets:0,sold_tickets:0,progress_percentage:0}),c=j([]),v=j(!1),b=j(!1),y=j(!1),n=g(()=>s.value.max_tickets?Math.min(s.value.sold_tickets/s.value.max_tickets*100,100):0),D=g(()=>s.value.revenue_target?Math.min(s.value.total_revenue/s.value.revenue_target*100,100):0),T=g(()=>!s.value.views_count||s.value.views_count===0?0:(s.value.participants_count/s.value.views_count*100).toFixed(1)),z=g(()=>s.value.participants_count===0?0:s.value.total_revenue/s.value.participants_count),S=g(()=>{const a=s.value.product_value;return((s.value.total_revenue-a)/a*100).toFixed(1)}),q=g(()=>{const a=new Date,d=new Date(s.value.end_date)-a;if(d<=0)return"Terminée";const l=Math.floor(d/(1e3*60*60*24)),C=Math.floor(d%(1e3*60*60*24)/(1e3*60*60));return l>0?`${l}j ${C}h`:`${C}h`}),N=g(()=>{const a=new Date,d=new Date(s.value.end_date)-a;return d<=0?0:Math.ceil(d/(1e3*60*60*24))}),B=g(()=>s.value.status==="active"&&!s.value.winning_ticket_number&&(s.value.sold_tickets>=s.value.max_tickets||s.value.draw_date&&new Date(s.value.draw_date)<=new Date)),I=a=>({active:"Active",completed:"Terminée",pending:"En attente",paused:"En pause",cancelled:"Annulée"})[a]||a,h=a=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0)+" FCFA",P=a=>new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(a)),O=()=>{window.$toast&&window.$toast.info("Fonctionnalité de téléchargement en cours de développement","🚀 En développement")},U=()=>{window.$toast&&window.$toast.info("Mise en pause de la tombola...","⏸️ Pause")},G=()=>{v.value=!1,F()},J=()=>{b.value=!1,F()},F=async()=>{try{const a=await $(`/lotteries/${w.params.id}`);if(a?.lottery){const e=a.lottery;console.log("LotteryData:",e),console.log("Available keys:",Object.keys(e));const d=new Set,l=e.paid_tickets||e.paidTickets||e.tickets||[];console.log("PaidTickets:",l),console.log("PaidTickets length:",l.length),l.forEach(m=>{m.user?.id&&d.add(m.user.id)});const C=d.size,K=(e.sold_tickets||0)*(e.ticket_price||0),M=new Map;l.forEach(m=>{if(m.user?.id){const k=m.user.id,Q=`${m.user.first_name||""} ${m.user.last_name||""}`.trim();M.has(k)?M.get(k).tickets_count++:M.set(k,{id:k,name:Q||"Utilisateur anonyme",participated_at:m.created_at||new Date().toISOString(),tickets_count:1})}});const H=Array.from(M.values()).sort((m,k)=>new Date(k.participated_at)-new Date(m.participated_at)).slice(0,5);s.value={...s.value,id:e.id,title:e.title,description:e.description||"",status:e.status,lottery_number:e.lottery_number,ticket_price:e.ticket_price||0,max_tickets:e.max_tickets||0,sold_tickets:e.sold_tickets||0,progress_percentage:e.progress_percentage||0,draw_date:e.draw_date,created_at:e.created_at,tickets_sold:e.sold_tickets||0,participants_count:C,total_revenue:K,max_participants:e.max_tickets||0,end_date:e.draw_date,revenue_target:e.revenue_target||null,views_count:e.views_count||0,product:e.product,product_value:e.product?.price||0,category:e.product?.category?.name||"",product_image:e.product?.image_url||e.product?.image||"",winner:e.winner||null,winning_ticket_number:e.winning_ticket_number||null},c.value=H}}catch(a){console.error("Erreur lors du chargement de la tombola:",a),window.$toast&&window.$toast.error("Erreur lors du chargement des données de la tombola")}};return Z(()=>{F()}),(a,e)=>{const d=tt("router-link");return u(),p("div",jt,[t("div",Ct,[t("div",null,[t("div",Mt,[i(d,{to:"/merchant/lotteries",class:"text-gray-500 hover:text-gray-700"},{default:R(()=>[i(r(gt),{class:"w-5 h-5"})]),_:1}),t("h1",Pt,o(s.value.title),1),t("span",{class:et(["px-3 py-1 rounded-full text-sm font-medium",s.value.status==="active"||s.value.status==="completed"?"bg-blue-100 text-blue-800":s.value.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},o(I(s.value.status)),3)]),e[6]||(e[6]=t("p",{class:"text-gray-600"},"Gérez votre tombola et suivez les participations",-1))]),t("div",Ft,[s.value.status==="active"?(u(),p("button",{key:0,onClick:e[0]||(e[0]=l=>b.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center whitespace-nowrap"},[i(r(st),{class:"w-4 h-4 mr-2 flex-shrink-0"}),e[7]||(e[7]=_(" Prolonger ",-1))])):x("",!0),s.value.status==="active"&&B.value?(u(),p("button",{key:1,onClick:e[1]||(e[1]=l=>v.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center whitespace-nowrap"},[i(r(ot),{class:"w-4 h-4 mr-2 flex-shrink-0"}),e[8]||(e[8]=_(" Effectuer le tirage ",-1))])):x("",!0),t("button",{onClick:e[2]||(e[2]=l=>y.value=!0),class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center whitespace-nowrap"},[i(r(at),{class:"w-4 h-4 mr-2 flex-shrink-0"}),e[9]||(e[9]=_(" Modifier ",-1))])])]),t("div",Tt,[t("div",Et,[t("div",Lt,[t("div",At,[i(r(lt),{class:"w-6 h-6 text-blue-600"})]),t("div",Rt,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-gray-600"},"Participants",-1)),t("p",Vt,o(s.value.participants_count),1)])])]),t("div",zt,[t("div",St,[t("div",qt,[i(r(nt),{class:"w-6 h-6 text-blue-600"})]),t("div",Nt,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-gray-600"},"Revenus générés",-1)),t("p",Bt,o(h(s.value.total_revenue)),1)])])]),t("div",It,[t("div",Ot,[t("div",Ut,[i(r(it),{class:"w-6 h-6 text-purple-600"})]),t("div",Gt,[e[12]||(e[12]=t("p",{class:"text-sm font-medium text-gray-600"},"Tickets vendus",-1)),t("p",Jt,o(s.value.tickets_sold),1)])])]),t("div",Kt,[t("div",Ht,[t("div",Qt,[i(r(rt),{class:"w-6 h-6 text-yellow-600"})]),t("div",Wt,[e[13]||(e[13]=t("p",{class:"text-sm font-medium text-gray-600"},"Temps restant",-1)),t("p",Xt,o(q.value),1)])])])]),t("div",Yt,[t("div",Zt,[t("div",te,[e[18]||(e[18]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Informations du produit")],-1)),t("div",ee,[t("div",se,[t("div",oe,[t("img",{src:s.value.product_image||"/images/products/placeholder.jpg",alt:s.value.title,class:"w-32 h-32 object-cover rounded-lg"},null,8,ae)]),t("div",le,[t("h4",ne,o(s.value.title),1),t("p",ie,o(s.value.description),1),t("div",re,[t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm font-medium text-gray-500"},"Valeur du produit",-1)),t("p",de,o(h(s.value.product_value)),1)]),t("div",null,[e[15]||(e[15]=t("p",{class:"text-sm font-medium text-gray-500"},"Prix du ticket",-1)),t("p",ue,o(h(s.value.ticket_price)),1)]),t("div",null,[e[16]||(e[16]=t("p",{class:"text-sm font-medium text-gray-500"},"Catégorie",-1)),t("p",ce,o(s.value.category?.name||s.value.category||"Sans catégorie"),1)]),t("div",null,[e[17]||(e[17]=t("p",{class:"text-sm font-medium text-gray-500"},"Date de fin",-1)),t("p",me,o(P(s.value.end_date)),1)])])])])])]),t("div",pe,[e[25]||(e[25]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Progression")],-1)),t("div",ve,[t("div",xe,[t("div",null,[t("div",ge,[e[19]||(e[19]=t("span",{class:"text-sm font-medium text-gray-700"},"Objectif de tickets",-1)),t("span",_e,o(s.value.sold_tickets)+" / "+o(s.value.max_tickets),1)]),t("div",be,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:V({width:n.value+"%"})},null,4)])]),t("div",null,[t("div",ye,[e[20]||(e[20]=t("span",{class:"text-sm font-medium text-gray-700"},"Participants uniques",-1)),t("span",fe,o(s.value.participants_count)+" personnes",1)]),t("div",we," Moyenne: "+o(s.value.participants_count>0?(s.value.sold_tickets/s.value.participants_count).toFixed(1):0)+" tickets/personne ",1)]),s.value.revenue_target?(u(),p("div",he,[t("div",ke,[e[21]||(e[21]=t("span",{class:"text-sm font-medium text-gray-700"},"Objectif de revenus",-1)),t("span",$e,o(h(s.value.total_revenue))+" / "+o(h(s.value.revenue_target)),1)]),t("div",De,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:V({width:D.value+"%"})},null,4)])])):x("",!0)]),t("div",je,[t("div",Ce,[t("p",Me,o(n.value)+"%",1),e[22]||(e[22]=t("p",{class:"text-sm text-blue-600"},"Tickets vendus",-1))]),t("div",Pe,[t("p",Fe,o(T.value)+"%",1),e[23]||(e[23]=t("p",{class:"text-sm text-blue-600"},"Conversion",-1))]),t("div",Te,[t("p",Ee,o(N.value),1),e[24]||(e[24]=t("p",{class:"text-sm text-yellow-600"},"Jours restants",-1))])])])]),s.value.winner?(u(),p("div",Le,[t("div",Ae,[t("h3",Re,[i(r(dt),{class:"w-5 h-5 text-yellow-500 mr-2"}),e[26]||(e[26]=_(" Gagnant ",-1))])]),t("div",Ve,[t("div",ze,[t("div",Se,[i(r(ut),{class:"w-6 h-6 text-yellow-600"})]),t("div",null,[t("p",qe,o(s.value.winner.name),1),t("p",Ne,"Tirage effectué le "+o(P(s.value.draw_date)),1)])]),e[27]||(e[27]=t("div",{class:"mt-4 p-4 bg-yellow-50 rounded-lg"},[t("p",{class:"text-sm text-yellow-800"}," Félicitations ! Le gagnant a été contacté automatiquement par email. ")],-1))])])):x("",!0)]),t("div",Be,[t("div",Ie,[e[31]||(e[31]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Actions rapides")],-1)),t("div",Oe,[t("button",{onClick:e[3]||(e[3]=(...l)=>a.shareLottery&&a.shareLottery(...l)),class:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},[i(r(ct),{class:"w-4 h-4 mr-2"}),e[28]||(e[28]=_(" Partager la tombola ",-1))]),t("button",{onClick:O,class:"w-full flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"},[i(r(mt),{class:"w-4 h-4 mr-2"}),e[29]||(e[29]=_(" Télécharger le rapport ",-1))]),s.value.status==="active"?(u(),p("button",{key:0,onClick:U,class:"w-full flex items-center justify-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"},[i(r(pt),{class:"w-4 h-4 mr-2"}),e[30]||(e[30]=_(" Mettre en pause ",-1))])):x("",!0)])]),t("div",Ue,[t("div",Ge,[t("div",Je,[e[33]||(e[33]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Participants récents",-1)),i(d,{to:`/merchant/lotteries/${s.value.id}/participants`,class:"text-sm text-blue-600 hover:text-blue-700"},{default:R(()=>e[32]||(e[32]=[_(" Voir tout ",-1)])),_:1,__:[32]},8,["to"])])]),t("div",Ke,[t("div",He,[(u(!0),p(vt,null,xt(c.value,l=>(u(),p("div",{key:l.id,class:"flex items-center space-x-3"},[t("div",Qe,[t("span",We,o(l.name.charAt(0)),1)]),t("div",Xe,[t("p",Ye,o(l.name),1),t("p",Ze,o(P(l.participated_at)),1)]),t("div",ts,o(l.tickets_count)+" ticket"+o(l.tickets_count>1?"s":""),1)]))),128))])])]),t("div",es,[e[38]||(e[38]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Statistiques")],-1)),t("div",ss,[t("div",os,[t("div",as,[e[34]||(e[34]=t("span",{class:"text-sm text-gray-600"},"Vues de la tombola",-1)),t("span",ls,o(s.value.views_count||"N/A"),1)]),t("div",ns,[e[35]||(e[35]=t("span",{class:"text-sm text-gray-600"},"Taux de conversion",-1)),t("span",is,o(T.value)+"%",1)]),t("div",rs,[e[36]||(e[36]=t("span",{class:"text-sm text-gray-600"},"Panier moyen",-1)),t("span",ds,o(h(z.value)),1)]),t("div",us,[e[37]||(e[37]=t("span",{class:"text-sm text-gray-600"},"Retour sur investissement",-1)),t("span",cs,"+"+o(S.value)+"%",1)])])])])])]),v.value?(u(),A(yt,{key:0,lottery:s.value,onClose:e[4]||(e[4]=l=>v.value=!1),onDrawn:G},null,8,["lottery"])):x("",!0),b.value?(u(),A(Dt,{key:1,lottery:s.value,onClose:e[5]||(e[5]=l=>b.value=!1),onExtended:J},null,8,["lottery"])):x("",!0)])}}};export{vs as default};
