import{c as C,K as W,r as g,O as F,j as K,b as i,l as x,e as t,g as u,t as d,w as E,h as H,F as M,U as b,V as y,$ as S,u as c,y as Q,ah as X,i as v,al as Y,x as Z,q as ee,o as a,aw as P}from"./vendor-DfmgW4wj.js";import{a as te}from"./app-Chv4JI1t.js";import{I as se}from"./ImageUpload-f3GKMAyb.js";const oe={class:"max-w-4xl mx-auto space-y-6"},re={key:0,class:"flex justify-center items-center py-12"},ie={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-6 text-center"},ae={class:"text-red-600"},le={class:"flex items-center justify-between"},ne={class:"mt-2 text-gray-600"},de={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},ue={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ce={class:"lg:col-span-2"},pe={key:0,class:"mt-1 text-sm text-red-600"},me={class:"lg:col-span-2"},ge={key:0,class:"mt-1 text-sm text-red-600"},xe=["disabled"],fe={key:0,disabled:""},be=["value"],ye={key:0,class:"mt-1 text-sm text-red-600"},ve={key:0,class:"mt-1 text-sm text-red-600"},_e={class:"lg:col-span-2"},we={key:0,class:"mt-1 text-sm text-red-600"},he={key:1,class:"mt-1 text-sm text-orange-600"},ke={key:2,class:"text-sm text-gray-700 mt-1"},Ee={key:0},Pe={key:0,class:"mt-1 text-sm text-red-600"},Ue={key:1,class:"text-sm text-gray-700 mt-1"},$e={key:0,class:"mt-1 text-sm text-red-600"},Ve={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Ie={class:"space-y-6"},Ce={class:"bg-blue-50 border border-blue-200 rounded-xl p-4 mt-6"},Fe={class:"flex items-start space-x-3"},Me={class:"flex justify-between items-center bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Se=["disabled"],Ae={key:0,class:"flex items-center"},je={key:1,class:"flex items-center"},Le={__name:"EditProduct",setup(qe){const A=ee(),j=W(),{get:U,put:q,loading:_}=te(),$=C(()=>j.params.id),w=g(!1),h=g(!0),V=g(!1),p=g(""),f=g(null);g(null);const I=g([]),m=g([]),s=F({name:"",description:"",category_id:"",condition:"",sale_mode:"direct",price:"",ticket_price:"",location:"",images:[],imageUrls:[]}),l=F({name:"",description:"",category_id:"",condition:"",price:"",ticket_price:"",location:"",images:""}),z=C(()=>s.name&&s.description&&s.category_id&&s.condition&&s.price&&parseFloat(s.price)>=1e3&&(!f.value||f.value.sale_mode!=="lottery"||s.ticket_price&&parseFloat(s.ticket_price)>=100)),N=async()=>{try{h.value=!0,p.value="";const o=await U("/products?my_products=1");if(o&&o.data&&o.data.products){const e=o.data.products.find(n=>n.id.toString()===$.value.toString());e?(f.value=e,s.name=e.name||"",s.description=e.description||"",s.category_id=e.category_id||"",s.condition=e.condition||"",s.sale_mode=e.sale_mode||"direct",s.price=e.price||"",s.ticket_price=e.ticket_price||"",s.location=e.location||"",e.images&&Array.isArray(e.images)?m.value=[...e.images]:e.main_image?m.value=[e.main_image]:e.image_url&&(m.value=[e.image_url]),V.value=!0):p.value="Ce produit n'existe pas ou ne vous appartient pas"}else p.value="Erreur lors du chargement des produits"}catch(o){console.error("Error loading product:",o),o.response?.status===404?p.value="Produit non trouvé":o.response?.status===403?p.value="Vous n'êtes pas autorisé à modifier ce produit":p.value=`Erreur lors du chargement du produit: ${o.message}`}finally{h.value=!1}},R=async()=>{try{const o=await U("/categories");o.categories&&(I.value=o.categories)}catch(o){console.error("Error loading categories:",o)}},L=async()=>{w.value=!0,O();try{const o={name:s.name,description:s.description,category_id:parseInt(s.category_id),price:parseFloat(s.price),condition:s.condition,location:s.location};f.value.sale_mode==="lottery"&&s.ticket_price&&(o.ticket_price=parseFloat(s.ticket_price));const e=[];m.value.length>0&&e.push(...m.value),s.imageUrls.length>0?e.push(...s.imageUrls):s.images.length>0&&e.push(...s.images.map(r=>r.preview)),e.length>0&&(o.images=e);const n=await q(`/products/${$.value}`,o);n&&(n.product||n.success)&&(window.$toast&&window.$toast.success("Produit modifié avec succès !","✅ Succès"),setTimeout(()=>{A.push("/merchant/products")},1500))}catch(o){console.error("Error updating product:",o),J(o)}finally{w.value=!1}},B=({index:o,url:e,response:n})=>{console.log("Image uploadée avec succès:",{index:o,url:e,response:n}),window.$toast&&window.$toast.success(`Image ${o+1} uploadée avec succès`,"✅ Upload")},D=({index:o,error:e})=>{console.error("Erreur upload image:",{index:o,error:e}),window.$toast&&window.$toast.error(`Erreur lors de l'upload de l'image ${o+1}: ${e.message}`,"❌ Erreur")},G=({index:o,progress:e})=>{console.log(`Upload image ${o+1}: ${e}%`)},T=({index:o,url:e})=>{console.log("Suppression image existante:",{index:o,url:e}),m.value=m.value.filter((n,r)=>r!==o),window.$toast&&window.$toast.info("Image existante supprimée","ℹ️ Info")},O=()=>{Object.keys(l).forEach(o=>{l[o]=""})},J=o=>{if(o.response?.data?.errors){const e=o.response.data.errors;Object.keys(e).forEach(n=>{l[n]!==void 0&&(l[n]=e[n][0])}),k("Veuillez corriger les erreurs dans le formulaire")}else o.response?.data?.message?k(o.response.data.message):k("Une erreur est survenue. Veuillez réessayer.")},k=o=>{window.$toast&&window.$toast.error(o,"❌ Erreur")};return K(async()=>{await Promise.all([N(),R()])}),(o,e)=>{const n=H("router-link");return a(),i("div",oe,[h.value?(a(),i("div",re,e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0099cc]"},null,-1),t("span",{class:"ml-3 text-gray-600"},"Chargement du produit...",-1)]))):p.value?(a(),i("div",ie,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Erreur",-1)),t("p",ae,d(p.value),1),u(n,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors mt-4"},{default:E(()=>[u(c(P),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=v(" Retour aux produits ",-1))]),_:1,__:[9]})])):V.value&&f.value?(a(),i(M,{key:2},[t("div",le,[t("div",null,[e[11]||(e[11]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Modifier le Produit",-1)),t("p",ne,'Modifiez les informations de "'+d(f.value.name)+'"',1)]),u(n,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},{default:E(()=>[u(c(P),{class:"w-4 h-4 mr-2"}),e[12]||(e[12]=v(" Retour aux produits ",-1))]),_:1,__:[12]})]),t("form",{onSubmit:Z(L,["prevent"]),class:"space-y-6"},[t("div",de,[e[22]||(e[22]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Informations de base",-1)),t("div",ue,[t("div",ce,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Nom du produit * ",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.name=r),type:"text",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: iPhone 15 Pro Max 256GB"},null,512),[[y,s.name]]),l.name?(a(),i("p",pe,d(l.name),1)):x("",!0)]),t("div",me,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Description * ",-1)),b(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.description=r),rows:"4",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Décrivez votre produit en détail..."},null,512),[[y,s.description]]),l.description?(a(),i("p",ge,d(l.description),1)):x("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Catégorie * ",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.category_id=r),required:"",disabled:c(_),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all disabled:opacity-50 text-gray-900"},[e[15]||(e[15]=t("option",{value:""},"Sélectionner une catégorie",-1)),c(_)?(a(),i("option",fe,"Chargement des catégories...")):x("",!0),(a(!0),i(M,null,Q(I.value,r=>(a(),i("option",{key:r.id,value:r.id},d(r.name),9,be))),128))],8,xe),[[S,s.category_id]]),l.category_id?(a(),i("p",ye,d(l.category_id),1)):x("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Condition * ",-1)),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.condition=r),required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900"},e[17]||(e[17]=[t("option",{value:""},"État du produit",-1),t("option",{value:"new"},"Neuf",-1),t("option",{value:"used"},"Occasion",-1),t("option",{value:"refurbished"},"Reconditionné",-1)]),512),[[S,s.condition]]),l.condition?(a(),i("p",ve,d(l.condition),1)):x("",!0)]),t("div",_e,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Valeur du produit (FCFA) * ",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.price=r),type:"number",required:"",min:"1000",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: 850000"},null,512),[[y,s.price]]),l.price?(a(),i("p",we,d(l.price),1)):s.price&&parseFloat(s.price)<1e3?(a(),i("p",he,"Le prix minimum est de 1000 FCFA")):(a(),i("p",ke,"Prix de vente ou valeur estimée du produit"))]),f.value.sale_mode==="lottery"?(a(),i("div",Ee,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Prix par ticket (FCFA) * ",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.ticket_price=r),type:"number",required:"",min:"100",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: 2500"},null,512),[[y,s.ticket_price]]),l.ticket_price?(a(),i("p",Pe,d(l.ticket_price),1)):(a(),i("p",Ue,"Prix que paieront les participants"))])):x("",!0),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Localisation ",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s.location=r),type:"text",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: Abidjan, Cocody"},null,512),[[y,s.location]]),l.location?(a(),i("p",$e,d(l.location),1)):x("",!0)])])]),t("div",Ve,[e[24]||(e[24]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Images du produit",-1)),t("div",Ie,[u(se,{modelValue:s.imageUrls,"onUpdate:modelValue":e[7]||(e[7]=r=>s.imageUrls=r),"existing-images":m.value,"upload-endpoint":"/products/images","max-files":10,"max-size-m-b":5,"help-text":"JPG, PNG, WebP - Max 5MB chacune - La première image sera la photo principale",onSuccess:B,onError:D,onProgress:G,onRemoveExisting:T},null,8,["modelValue","existing-images"])]),t("div",Ce,[t("div",Fe,[u(c(X),{class:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e[23]||(e[23]=t("div",{class:"text-sm text-blue-700"},[t("p",{class:"font-medium mb-1"},"Conseils pour de bonnes photos :"),t("ul",{class:"space-y-1 text-sm"},[t("li",null,"• Les images existantes seront conservées si vous n'ajoutez pas de nouvelles images"),t("li",null,"• Utilisez un bon éclairage naturel"),t("li",null,"• Prenez plusieurs angles du produit"),t("li",null,"• Maximum 10 images par produit"),t("li",null,"• Formats acceptés : JPG, PNG, WebP"),t("li",null,"• Taille maximum : 5MB par image")])],-1))])])]),t("div",Me,[u(n,{to:"/merchant/products",class:"inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},{default:E(()=>[u(c(P),{class:"w-4 h-4 mr-2"}),e[25]||(e[25]=v(" Annuler ",-1))]),_:1,__:[25]}),t("button",{type:"submit",disabled:w.value||!z.value||c(_),class:"inline-flex items-center px-6 py-3 bg-[#0099cc] hover:bg-[#0088bb] disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors"},[w.value||c(_)?(a(),i("span",Ae,e[26]||(e[26]=[t("div",{class:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"},null,-1),v(" Modification... ",-1)]))):(a(),i("span",je,[u(c(Y),{class:"w-4 h-4 mr-2"}),e[27]||(e[27]=v(" Enregistrer les modifications ",-1))]))],8,Se)])],32)],64)):x("",!0)])}}};export{Le as default};
