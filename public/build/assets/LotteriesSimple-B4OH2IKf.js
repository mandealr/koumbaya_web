import{r as m,c as q,y as W,g as Y,b as u,e,j as w,i as P,w as G,k as Z,A as U,B as K,E as ee,f as te,t as n,u as l,F as H,n as I,l as k,q as L,o as g,G as se}from"./vendor-CTxEzfV9.js";import{a as ae,o as oe}from"./app-BlkjIhBH.js";function re(){const{get:z,post:M,loading:_,error:V}=ae(),d=m([]),b=m({total:0,active:0,completed:0,pending:0,cancelled:0}),c=m({status:"all",search:"",sortBy:"end_date_asc"}),j=m({current_page:1,per_page:15,total:0,last_page:1}),y=async(a={})=>{try{const s={per_page:c.value.per_page||15,page:a.page||1,sort_by:c.value.sortBy,...a};c.value.status&&c.value.status!=="all"&&(s.status=c.value.status),c.value.search&&(s.search=c.value.search);const r=await z("/merchant/dashboard/lottery-performance",{params:s});return r.success&&(d.value=r.data.data||r.data,r.data.current_page&&(j.value={current_page:r.data.current_page,per_page:r.data.per_page,total:r.data.total,last_page:r.data.last_page}),r.stats?b.value=r.stats:x()),r}catch(s){throw console.error("Erreur lors du chargement des tombolas:",s),s}},x=()=>{const a=d.value.length,s=d.value.filter(v=>v.status==="active").length,r=d.value.filter(v=>v.status==="completed").length,p=d.value.filter(v=>v.status==="pending").length,h=d.value.filter(v=>v.status==="cancelled").length;b.value={total:a,active:s,completed:r,pending:p,cancelled:h}},F=async a=>{try{const s=await M(`/lotteries/${a}/draw`);if(s.success||s.message){const r=d.value.findIndex(p=>p.id===a);r!==-1&&(d.value[r]={...d.value[r],status:"completed",is_drawn:!0,winner_user_id:s.lottery?.winner_user_id,winner_ticket_number:s.lottery?.winner_ticket_number,draw_date:s.lottery?.draw_date}),x()}return s}catch(s){throw console.error("Erreur lors du tirage:",s),s}},D=async a=>{try{const s=await z(`/lotteries/${a}`);return s.lottery||s.data}catch(s){throw console.error("Erreur lors du chargement des détails:",s),s}},N=async a=>{c.value={...c.value,...a},await y()},$=async a=>{c.value.search=a,await y()},B=async a=>{await y({page:a})},C=q(()=>[{key:"all",label:"Toutes",count:b.value.total},{key:"active",label:"Actives",count:b.value.active},{key:"pending",label:"En attente",count:b.value.pending},{key:"completed",label:"Terminées",count:b.value.completed},{key:"cancelled",label:"Annulées",count:b.value.cancelled}]);return{lotteries:q(()=>{let a=[...d.value];if(c.value.search){const s=c.value.search.toLowerCase();a=a.filter(r=>r.lottery_number?.toLowerCase().includes(s)||r.product?.name?.toLowerCase().includes(s)||r.product?.description?.toLowerCase().includes(s))}return a}),stats:b,filters:c,pagination:j,tabs:C,loading:_,error:V,fetchLotteries:y,drawLottery:F,getLotteryDetails:D,updateFilters:N,searchLotteries:$,changePage:B,canDrawLottery:a=>a.status==="active"&&!a.is_drawn&&a.can_draw===!0&&new Date(a.end_date)<=new Date,getFormattedStatus:a=>({pending:{label:"En attente",class:"bg-yellow-100 text-yellow-800"},active:{label:"Active",class:"bg-green-100 text-green-800"},completed:{label:"Terminée",class:"bg-blue-100 text-blue-800"},cancelled:{label:"Annulée",class:"bg-red-100 text-red-800"}})[a]||{label:a,class:"bg-gray-100 text-gray-800"},getTimeRemaining:a=>{const s=new Date,p=new Date(a)-s;if(p<=0)return"Terminée";const h=Math.floor(p/(1e3*60*60*24)),v=Math.floor(p%(1e3*60*60*24)/(1e3*60*60)),A=Math.floor(p%(1e3*60*60)/(1e3*60));return h>0?`${h}j ${v}h`:v>0?`${v}h ${A}min`:`${A}min`}}}const le={class:"space-y-6"},ne={class:"sm:flex sm:items-center sm:justify-between"},de={class:"mt-4 sm:mt-0"},ie={class:"bg-white p-4 rounded-lg shadow"},ce={class:"flex flex-col sm:flex-row gap-4"},ue={class:"flex-1"},ge={class:"relative"},pe={class:"sm:w-48"},ve={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},me={class:"bg-white rounded-lg shadow p-4"},be={class:"text-2xl font-bold text-gray-900"},_e={class:"bg-white rounded-lg shadow p-4"},xe={class:"text-2xl font-bold text-green-600"},fe={class:"bg-white rounded-lg shadow p-4"},he={class:"text-2xl font-bold text-yellow-600"},ye={class:"bg-white rounded-lg shadow p-4"},we={class:"text-2xl font-bold text-blue-600"},ke={class:"bg-white rounded-lg shadow p-4"},Ce={class:"text-2xl font-bold text-red-600"},Te={class:"border-b border-gray-200"},Le={class:"-mb-px flex space-x-8"},Me=["onClick"],je={key:0,class:"ml-2 bg-gray-100 text-gray-600 py-1 px-2 rounded-full text-xs"},De={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},$e={class:"flex"},Be={class:"ml-3"},Ee={class:"text-sm text-red-800"},Se={class:"bg-white rounded-lg shadow"},Ae={class:"p-6"},Pe={key:0,class:"text-center py-12"},ze={key:1,class:"text-center py-12"},Ve={key:2},Fe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Ne={class:"h-48 bg-gray-200 relative"},Re={class:"absolute top-2 right-2"},Ge={class:"p-4"},qe={class:"flex justify-between items-start mb-2"},Ue={class:"font-semibold text-gray-900 truncate"},He={class:"text-sm text-gray-600 ml-2"},Ie={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Qe={class:"space-y-2 text-sm"},Xe={class:"flex justify-between"},Je={class:"font-medium"},Oe={class:"flex justify-between"},We={class:"font-medium"},Ye={class:"flex justify-between"},Ze={class:"w-full bg-gray-200 rounded-full h-2"},Ke={class:"flex gap-2 mt-4"},et=["onClick","disabled"],tt={key:0,class:"mt-6 flex justify-between items-center"},st={class:"text-sm text-gray-700"},at={class:"flex gap-2"},ot=["disabled"],rt=["disabled"],lt={key:1,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},nt={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},dt={class:"text-sm text-gray-600 mb-6"},it={class:"flex gap-3 justify-end"},ct=["disabled"],ut={key:2,class:"fixed bottom-4 right-4 z-50"},gt={class:"flex"},pt={class:"flex-shrink-0"},vt={key:0,class:"h-5 w-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},mt={key:1,class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bt={class:"ml-3"},ft={__name:"LotteriesSimple",setup(z){const{lotteries:M,stats:_,tabs:V,pagination:d,loading:b,error:c,fetchLotteries:j,drawLottery:y,updateFilters:x,searchLotteries:F,changePage:D,canDrawLottery:N,getFormattedStatus:$,getTimeRemaining:B}=re(),C=m("all"),E=m(""),S=m("end_date_asc"),T=m(!1),f=m(null),a=m(null),s=m(!1),r=m(""),p=m("success");let h=null;const v=()=>{clearTimeout(h),h=setTimeout(()=>{F(E.value)},500)},A=i=>{C.value=i,x({status:i==="all"?null:i,page:1})},Q=()=>{x({sortBy:S.value,page:1})},X=i=>{f.value=i,T.value=!0},J=async()=>{if(f.value){a.value=f.value.id;try{const i=await y(f.value.id);s.value=!0,p.value="success",r.value=`Tirage effectué avec succès ! Gagnant : ${i.winning_ticket?.user?.first_name} ${i.winning_ticket?.user?.last_name}`,T.value=!1,f.value=null,setTimeout(()=>{s.value=!1},5e3)}catch(i){console.error("Erreur lors du tirage:",i),s.value=!0,p.value="error",r.value=i.response?.data?.error||"Erreur lors du tirage",setTimeout(()=>{s.value=!1},5e3)}finally{a.value=null}}};return W(()=>C.value,i=>{x(i!=="all"?{status:i}:{status:null})}),Y(async()=>{try{await j()}catch(i){console.error("Erreur lors du chargement initial:",i),s.value=!0,p.value="error",r.value="Erreur lors du chargement des tombolas",setTimeout(()=>{s.value=!1},5e3)}}),(i,t)=>{const R=Z("router-link");return g(),u("div",le,[e("div",ne,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Mes Tombolas"),e("p",{class:"mt-2 text-gray-600"},"Gérez vos tombolas et effectuez les tirages")],-1)),e("div",de,[P(R,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[5]||(t[5]=[k(" Nouvelle tombola ",-1)])),_:1,__:[5]})])]),e("div",ie,[e("div",ce,[e("div",ue,[e("div",ge,[t[7]||(t[7]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),U(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>E.value=o),onInput:v,type:"text",placeholder:"Rechercher par numéro, nom ou description...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[K,E.value]])])]),e("div",pe,[U(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>S.value=o),onChange:Q,class:"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[8]||(t[8]=[te('<option value="end_date_asc">Date de fin (croissant)</option><option value="end_date_desc">Date de fin (décroissant)</option><option value="popularity">Popularité</option><option value="ticket_price_asc">Prix ticket (croissant)</option><option value="ticket_price_desc">Prix ticket (décroissant)</option>',5)]),544),[[ee,S.value]])])])]),e("div",ve,[e("div",me,[e("div",be,n(l(_).total),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600"},"Total",-1))]),e("div",_e,[e("div",xe,n(l(_).active),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-600"},"Actives",-1))]),e("div",fe,[e("div",he,n(l(_).pending),1),t[11]||(t[11]=e("div",{class:"text-sm text-gray-600"},"En attente",-1))]),e("div",ye,[e("div",we,n(l(_).completed),1),t[12]||(t[12]=e("div",{class:"text-sm text-gray-600"},"Terminées",-1))]),e("div",ke,[e("div",Ce,n(l(_).cancelled),1),t[13]||(t[13]=e("div",{class:"text-sm text-gray-600"},"Annulées",-1))])]),e("div",Te,[e("nav",Le,[(g(!0),u(H,null,I(l(V),o=>(g(),u("button",{key:o.key,onClick:O=>A(o.key),class:L(["py-2 px-1 border-b-2 font-medium text-sm",C.value===o.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[k(n(o.label)+" ",1),o.count!==null?(g(),u("span",je,n(o.count),1)):w("",!0)],10,Me))),128))])]),l(c)?(g(),u("div",De,[e("div",$e,[t[14]||(t[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Be,[e("p",Ee,n(l(c)),1)])])])):w("",!0),e("div",Se,[e("div",Ae,[l(b)?(g(),u("div",Pe,t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des tombolas...",-1)]))):l(M).length===0?(g(),u("div",ze,[t[17]||(t[17]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),t[18]||(t[18]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucune tombola",-1)),t[19]||(t[19]=e("p",{class:"text-gray-600 mb-4"},"Vous n'avez pas encore créé de tombolas.",-1)),P(R,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[16]||(t[16]=[k(" Créer ma première tombola ",-1)])),_:1,__:[16]})])):(g(),u("div",Ve,[e("div",Fe,[(g(!0),u(H,null,I(l(M),o=>(g(),u("div",{key:o.id,class:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow"},[e("div",Ne,[P(oe,{src:o.product?.main_image||o.product?.image_url||o.product?.image,alt:o.product?.name,"container-class":"h-48 w-full","image-class":"w-full h-full object-cover","fallback-class":"h-48 w-full","fallback-text":"Photo"},null,8,["src","alt"]),e("div",Re,[e("span",{class:L(["px-2 py-1 text-xs font-medium rounded-full",l($)(o.status).class])},n(l($)(o.status).label),3)])]),e("div",Ge,[e("div",qe,[e("h4",Ue,n(o.product?.name||"Produit sans nom"),1),e("span",He,"#"+n(o.lottery_number),1)]),e("p",Ie,n(o.product?.description),1),e("div",Qe,[e("div",Xe,[t[20]||(t[20]=e("span",{class:"text-gray-600"},"Prix du ticket:",-1)),e("span",Je,n(o.ticket_price)+" XAF",1)]),e("div",Oe,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Tickets vendus:",-1)),e("span",We,n(o.sold_tickets||0)+"/"+n(o.total_tickets),1)]),e("div",Ye,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"Temps restant:",-1)),e("span",{class:L(["font-medium",{"text-red-600":l(B)(o.end_date)==="Terminée"}])},n(l(B)(o.end_date)),3)]),e("div",Ze,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:se({width:`${Math.min((o.sold_tickets||0)/o.total_tickets*100,100)}%`})},null,4)])]),e("div",Ke,[P(R,{to:{name:"merchant.lottery.view",params:{id:o.id}},class:"flex-1 text-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 transition-colors"},{default:G(()=>t[23]||(t[23]=[k(" Détails ",-1)])),_:2,__:[23]},1032,["to"]),l(N)(o)?(g(),u("button",{key:0,onClick:O=>X(o),disabled:a.value===o.id,class:"flex-1 px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 transition-colors"},n(a.value===o.id?"Tirage...":"Effectuer le tirage"),9,et)):w("",!0)])])]))),128))]),l(d).last_page>1?(g(),u("div",tt,[e("div",st," Page "+n(l(d).current_page)+" sur "+n(l(d).last_page)+" ("+n(l(d).total)+" résultats) ",1),e("div",at,[e("button",{onClick:t[2]||(t[2]=o=>l(D)(l(d).current_page-1)),disabled:l(d).current_page<=1,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Précédent ",8,ot),e("button",{onClick:t[3]||(t[3]=o=>l(D)(l(d).current_page+1)),disabled:l(d).current_page>=l(d).last_page,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Suivant ",8,rt)])])):w("",!0)]))])]),T.value?(g(),u("div",lt,[e("div",nt,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Confirmer le tirage",-1)),e("p",dt,[t[24]||(t[24]=k(" Êtes-vous sûr de vouloir effectuer le tirage pour la tombola ",-1)),e("strong",null,n(f.value?.product?.name),1),t[25]||(t[25]=k(" ? Cette action est irréversible. ",-1))]),e("div",it,[e("button",{onClick:t[4]||(t[4]=o=>T.value=!1),class:"px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100"}," Annuler "),e("button",{onClick:J,disabled:a.value,class:"px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400"},n(a.value?"Tirage...":"Confirmer le tirage"),9,ct)])])])):w("",!0),s.value?(g(),u("div",ut,[e("div",{class:L(["rounded-md p-4 shadow-lg",p.value==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"])},[e("div",gt,[e("div",pt,[p.value==="success"?(g(),u("svg",vt,t[27]||(t[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(g(),u("svg",mt,t[28]||(t[28]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])))]),e("div",bt,[e("p",{class:L(["text-sm",p.value==="success"?"text-green-800":"text-red-800"])},n(r.value),3)])])],2)])):w("",!0)])}}};export{ft as default};
