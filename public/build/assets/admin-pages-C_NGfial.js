import{d as ct,r as $,c as W,a as we,b as ke,e as _e,f as Ne,g as qe,h as ze,o as me,i as r,j as e,k as z,u as k,F as J,l as K,t as a,m as ne,n as A,p as Ae,q as B,s as mt,v as pt,w as Be,x as i,y as Y,z as ue,A as ce,B as Oe,C as Ge,D as se,E as be,G as ve,H as w,I as R,J as ee,K as Ue,L as le,M as re,N as Me,O as Ce,P as Le,Q as he,R as ye,S as Ee,T as Xe,U as $e,V as Ve,W as Re,X as Ie,Y as fe,Z as gt,_ as ft,$ as vt,a0 as xt,a1 as bt,a2 as yt,a3 as _t,a4 as wt,a5 as ht,a6 as $t,a7 as He,a8 as kt,a9 as Je,aa as Ct,ab as Et}from"./vue-core-BXnTE0w7.js";import{_ as Te,A as At}from"./common-components-C44zC4g7.js";import{a as xe,u as pe,b as St}from"./utils-CcZu3SrZ.js";import{i as jt}from"./vendor-Cg4W4xsk.js";const Pt=ct("auth",()=>{const x=$(null),E=$(localStorage.getItem("auth_token")),I=$(!1),P=$(""),f=W(()=>!!E.value&&!!x.value),S=W(()=>{if(x.value?.userType?.name==="MANAGER"||x.value?.user_type_id===1)return!0;if(x.value?.roles&&Array.isArray(x.value.roles)){const b=["Super Admin","Admin","Agent","Agent Back Office"];return x.value.roles.some(L=>b.includes(L.name))}return x.value?.email?["superadmin@koumbaya.ga","admin@koumbaya.ga","agent@koumbaya.ga","backoffice@koumbaya.ga"].includes(x.value.email):!1}),p=W(()=>{if(x.value?.roles&&Array.isArray(x.value.roles)){const b=["Super Admin","Admin"];return x.value.roles.some(L=>b.includes(L.name))}return x.value?.email?.includes("superadmin")?!0:x.value?.email?["superadmin@koumbaya.ga","admin@koumbaya.ga"].includes(x.value.email):!1}),h=W(()=>{if(x.value?.roles&&Array.isArray(x.value.roles)){const b=["Agent","Agent Back Office"];return x.value.roles.some(L=>b.includes(L.name))}return x.value?.email?["agent@koumbaya.ga","backoffice@koumbaya.ga"].includes(x.value.email):!1}),M=W(()=>x.value?.roles&&Array.isArray(x.value.roles)?x.value.roles.some(b=>b.name==="Business"):x.value?.can_sell&&x.value?.account_type==="business"?!0:x.value?.email?["business@koumbaya.ga","business2@koumbaya.ga"].includes(x.value.email):!1),D=W(()=>S.value?!1:x.value?.roles&&Array.isArray(x.value.roles)?x.value.roles.some(b=>b.name==="Particulier"):x.value?.account_type==="personal"?!0:!S.value&&!M.value),V=W(()=>x.value?.account_type==="business"||x.value?.roles?.some(b=>b.name==="Business")),U=W(()=>x.value?.account_type==="personal"||x.value?.roles?.some(b=>b.name==="Particulier")),O=W(()=>x.value?.can_sell===!0||V.value||x.value?.roles?.some(b=>b.name==="Business"));async function G(b){I.value=!0,P.value="";try{const L=await xe.post("/auth/login",b),{access_token:F,user:y}=L.data;return E.value=F,x.value=y,localStorage.setItem("auth_token",F),{success:!0}}catch(L){let F="Erreur de connexion";if(L.response?.status===401)F="Identifiants incorrects";else if(L.response?.status===429)F="Trop de tentatives. Veuillez patienter.";else if(L.response?.status===422){const y=L.response?.data?.errors;y?F=Object.values(y).flat().join(", "):F=L.response?.data?.message||"Données invalides"}else L.response?F=L.response?.data?.error||L.response?.data?.message||"Erreur de connexion":F="Problème de connexion réseau";return P.value=F,{success:!1,error:F}}finally{I.value=!1}}async function N(b){I.value=!0,P.value="";try{const L=await xe.post("/auth/register",b),{access_token:F,user:y}=L.data;return E.value=F,x.value=y,localStorage.setItem("auth_token",F),{success:!0}}catch(L){return P.value=L.response?.data?.error||L.response?.data?.message||"Erreur lors de l'inscription",{success:!1,error:P.value}}finally{I.value=!1}}async function H(){try{await xe.post("/auth/logout")}catch(b){console.error("Erreur lors de la déconnexion:",b)}finally{x.value=null,E.value=null,localStorage.removeItem("auth_token")}}async function q(){if(E.value)try{const b=await xe.get("/auth/me");x.value=b.data.user}catch{x.value=null,E.value=null,localStorage.removeItem("auth_token")}}async function Q(){if(f.value)try{const b=await xe.get("/auth/me");x.value=b.data.user}catch(b){console.error("Erreur lors du rafraîchissement:",b)}}function X(){P.value=""}function Z(b){P.value=b}function T(b){x.value=b}function v(b){E.value=b,b?localStorage.setItem("auth_token",b):localStorage.removeItem("auth_token")}function m(){return x.value?(console.log("🔄 Logique de redirection:",{email:x.value?.email,user:x.value,roles:x.value?.roles,isManager:S.value,isAdmin:p.value,isAgent:h.value,isMerchant:M.value,isCustomer:D.value,account_type:x.value?.account_type,roles:x.value?.roles?.map(b=>b.name)}),S.value?(console.log("✅ Redirection vers admin.dashboard (Manager)"),"admin.dashboard"):x.value?.roles&&Array.isArray(x.value.roles)&&x.value.roles.some(L=>L.name==="Business")?(console.log("✅ Redirection vers merchant.dashboard (Business)"),"merchant.dashboard"):(console.log("✅ Redirection vers customer.dashboard (Customer par défaut)"),"customer.dashboard")):"home"}return{user:x,token:E,loading:I,error:P,isAuthenticated:f,isManager:S,isAdmin:p,isAgent:h,isMerchant:M,isCustomer:D,isBusiness:V,isPersonal:U,canSell:O,login:G,register:N,logout:H,checkAuth:q,refreshUser:Q,clearError:X,setError:Z,setUser:T,setToken:v,getDefaultRedirect:m}}),Ke=(x,E)=>{const I=x.__vccOpts||x;for(const[P,f]of E)I[P]=f;return I},Dt={class:"space-y-6"},Ut={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Mt={class:"flex items-center"},Vt={class:"ml-4"},Tt={class:"text-sm font-medium text-gray-600"},Lt={class:"text-2xl font-bold text-gray-900"},Rt={class:"mt-4 pt-4 border-t border-gray-100"},Ft={class:"flex items-center text-sm"},It={key:0,class:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4"},Nt={class:"flex"},qt={class:"ml-3"},zt={class:"mt-1 text-sm text-red-700"},Bt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ot={class:"lg:col-span-2 space-y-6"},Gt={class:"admin-card"},Xt={class:"h-64 flex items-center justify-center bg-gray-50 rounded-lg"},Ht={class:"text-center"},Jt={class:"admin-card"},Kt={class:"overflow-x-auto"},Wt={class:"min-w-full"},Yt={class:"bg-white divide-y divide-gray-200"},Qt={class:"px-6 py-4 whitespace-nowrap"},Zt={class:"flex items-center"},es={class:"ml-4"},ts={class:"text-sm font-medium text-gray-900"},ss={class:"text-sm text-gray-500"},as={class:"px-6 py-4 whitespace-nowrap"},os={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ns={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},is={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},rs=["onClick"],ls={class:"space-y-6"},ds={class:"admin-card"},us={key:0,class:"space-y-4"},cs={key:1,class:"space-y-4"},ms={class:"flex-1 min-w-0"},ps={class:"text-sm font-medium text-gray-900"},gs={class:"text-sm text-gray-600"},fs={class:"text-xs text-gray-500 mt-1"},vs={key:2,class:"text-center py-6 text-gray-500"},xs={class:"admin-card"},bs={class:"space-y-4"},ys={class:"flex-shrink-0"},_s={class:"inline-flex items-center justify-center w-6 h-6 text-sm font-bold text-gray-600"},ws={class:"flex-1 min-w-0"},hs={class:"text-sm font-medium text-gray-900 truncate"},$s={class:"flex items-center space-x-2 mt-1"},ks={class:"text-xs text-gray-500"},Cs={class:"admin-card"},Es={class:"space-y-3"},kp={__name:"Dashboard",setup(x){const E=Be();pe();const{stats:I,recentLotteries:P,recentActivities:f,topProducts:S,loading:p,error:h,loadDashboardData:M}=St(),D={UsersIcon:ze,ShoppingBagIcon:qe,GiftIcon:Ne,CurrencyDollarIcon:_e,BanknotesIcon:ke,InformationCircleIcon:we},V=W(()=>I.value.map(T=>({...T,icon:D[T.icon]||we}))),U=W(()=>f.value.map(T=>({...T,icon:D[T.icon]||we}))),O=T=>new Date(T).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),G=T=>{const m=Math.floor((new Date-T)/1e3);return m<60?`il y a ${m}s`:m<3600?`il y a ${Math.floor(m/60)}min`:m<86400?`il y a ${Math.floor(m/3600)}h`:`il y a ${Math.floor(m/86400)}j`},N=async()=>{await M()},H=()=>{E.push("/admin/users")},q=()=>{E.push("/admin/lotteries")},Q=()=>{window.$toast&&window.$toast.info("Fonctionnalité des activités détaillées en cours de développement","ℹ️ Information")},X=T=>{window.$toast&&window.$toast.info(`Affichage des détails de la tombola ${T.lottery_number}`,"👁️ Détails")},Z=async()=>{try{window.$toast&&window.$toast.info("Génération du rapport en cours...","📊 Rapport"),await new Promise(T=>setTimeout(T,2e3)),window.$toast&&window.$toast.success("Rapport généré avec succès!","✅ Rapport")}catch{window.$toast&&window.$toast.error("Erreur lors de la génération du rapport","❌ Erreur")}};return me(async()=>{await M()}),(T,v)=>(i(),r("div",Dt,[v[15]||(v[15]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Tableau de bord"),e("p",{class:"mt-2 text-gray-600"},"Vue d'ensemble des activités de la plateforme Koumbaya")],-1)),e("div",Ut,[k(p)?(i(),r(J,{key:0},K(4,m=>e("div",{key:m,class:"admin-card animate-pulse"},v[0]||(v[0]=[ne('<div class="flex items-center"><div class="p-3 rounded-lg bg-gray-200"></div><div class="ml-4 flex-1"><div class="h-4 bg-gray-200 rounded w-20 mb-2"></div><div class="h-6 bg-gray-200 rounded w-16"></div></div></div><div class="mt-4 pt-4 border-t border-gray-100"><div class="h-4 bg-gray-200 rounded w-24"></div></div>',2)]))),64)):(i(!0),r(J,{key:1},K(V.value,m=>(i(),r("div",{key:m.label,class:"admin-card hover:shadow-md transition-shadow duration-200"},[e("div",Mt,[e("div",{class:Y(["p-3 rounded-lg",m.bgColor])},[(i(),ue(ce(m.icon),{class:Y(["w-6 h-6",m.iconColor])},null,8,["class"]))],2),e("div",Vt,[e("p",Tt,a(m.label),1),e("p",Lt,a(m.value),1)])]),e("div",Rt,[e("div",Ft,[e("span",{class:Y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",m.change>=0?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},[(i(),ue(ce(m.change>=0?k(Oe):k(Ge)),{class:"w-3 h-3 mr-1"})),B(" "+a(Math.abs(m.change))+"% ",1)],2),v[1]||(v[1]=e("span",{class:"ml-2 text-gray-500"},"vs mois dernier",-1))])])]))),128))]),k(h)&&!k(p)?(i(),r("div",It,[e("div",Nt,[e("div",qt,[v[2]||(v[2]=e("h3",{class:"text-sm font-medium text-red-800"},"Erreur de chargement",-1)),e("p",zt,a(k(h)),1),e("button",{onClick:N,class:"mt-2 text-sm bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded"}," Réessayer ")])])])):z("",!0),e("div",Bt,[e("div",Ot,[e("div",Gt,[v[5]||(v[5]=ne('<div class="admin-card-header"><div class="flex items-center justify-between"><h3 class="text-lg font-semibold text-gray-900">Revenus mensuels</h3><div class="flex items-center space-x-2"><button class="text-sm text-gray-500 hover:text-gray-700 px-3 py-1 rounded-md hover:bg-gray-100">30j</button><button class="text-sm bg-[#0099cc]/10 text-[#0099cc] px-3 py-1 rounded-md">90j</button><button class="text-sm text-gray-500 hover:text-gray-700 px-3 py-1 rounded-md hover:bg-gray-100">1an</button></div></div></div>',1)),e("div",Xt,[e("div",Ht,[A(k(Ae),{class:"w-12 h-12 text-gray-400 mx-auto mb-2"}),v[3]||(v[3]=e("p",{class:"text-gray-500"},"Graphique des revenus",-1)),v[4]||(v[4]=e("p",{class:"text-xs text-gray-400"},"Données en cours de chargement...",-1))])])]),e("div",Jt,[v[7]||(v[7]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Tombolas récentes")],-1)),e("div",Kt,[e("table",Wt,[v[6]||(v[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Produit"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Statut"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tickets"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date de fin"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Yt,[(i(!0),r(J,null,K(k(P),m=>(i(),r("tr",{key:m.id,class:"hover:bg-gray-50"},[e("td",Qt,[e("div",Zt,[A(Te,{src:m.product.image_url||m.product.main_image||m.product.image,alt:m.product.name,"container-class":"h-10 w-10 rounded-lg","image-class":"h-full w-full object-cover rounded-lg","fallback-class":"h-full w-full rounded-lg"},null,8,["src","alt"]),e("div",es,[e("div",ts,a(m.product.name),1),e("div",ss,a(m.lottery_number),1)])])]),e("td",as,[e("span",{class:Y(["inline-flex px-2 py-1 text-xs font-medium rounded-full",m.status==="active"?"admin-badge-success":m.status==="completed"?"bg-gray-100 text-gray-800":"admin-badge-warning"])},a(m.statusLabel),3)]),e("td",os,a(m.sold_tickets)+"/"+a(m.total_tickets),1),e("td",ns,a(O(m.end_date)),1),e("td",is,[e("button",{onClick:b=>X(m),class:"text-[#0099cc] hover:text-[#0088bb] mr-3"}," Voir ",8,rs),m.status==="active"?(i(),r("button",{key:0,onClick:q,class:"text-orange-600 hover:text-orange-900"}," Modifier ")):z("",!0)])]))),128))])])])])]),e("div",ls,[e("div",ds,[v[10]||(v[10]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Activités récentes")],-1)),k(p)?(i(),r("div",us,[(i(),r(J,null,K(4,m=>e("div",{key:m,class:"flex items-start space-x-3 p-3 animate-pulse"},v[8]||(v[8]=[ne('<div class="w-8 h-8 bg-gray-200 rounded-full flex-shrink-0"></div><div class="flex-1 min-w-0 space-y-2"><div class="h-4 bg-gray-200 rounded w-32"></div><div class="h-3 bg-gray-200 rounded w-48"></div><div class="h-3 bg-gray-200 rounded w-16"></div></div>',2)]))),64))])):U.value.length>0?(i(),r("div",cs,[(i(!0),r(J,null,K(U.value,m=>(i(),r("div",{key:m.id,class:"flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors"},[e("div",{class:Y(["w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",m.type==="user"?"bg-[#0099cc]/10 text-[#0099cc]":m.type==="product"?"bg-blue-100 text-blue-600":m.type==="payment"?"bg-yellow-100 text-yellow-600":"bg-purple-100 text-purple-600"])},[(i(),ue(ce(m.icon),{class:"w-4 h-4"}))],2),e("div",ms,[e("p",ps,a(m.title),1),e("p",gs,a(m.description),1),e("p",fs,a(G(m.time)),1)])]))),128))])):(i(),r("div",vs,[A(k(we),{class:"w-8 h-8 mx-auto mb-2 text-gray-400"}),v[9]||(v[9]=e("p",{class:"text-sm"},"Aucune activité récente",-1))])),e("div",{class:"mt-4 pt-4 border-t border-gray-100"},[e("button",{onClick:Q,class:"admin-btn-secondary w-full text-sm"}," Voir toutes les activités ")])]),e("div",xs,[v[11]||(v[11]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Produits populaires")],-1)),e("div",bs,[(i(!0),r(J,null,K(k(S),(m,b)=>(i(),r("div",{key:m.id,class:"flex items-center space-x-3"},[e("div",ys,[e("span",_s,a(b+1),1)]),A(Te,{src:m.image_url||m.main_image||m.image,alt:m.title,"container-class":"w-10 h-10 rounded-lg flex-shrink-0","image-class":"w-full h-full object-cover rounded-lg","fallback-class":"w-full h-full rounded-lg"},null,8,["src","alt"]),e("div",ws,[e("p",hs,a(m.title),1),e("div",$s,[e("p",ks,a(m.sales)+" tickets",1),e("span",{class:Y(["text-xs font-medium",m.growth>0?"text-blue-600":"text-red-600"])},a(m.growth>0?"+":"")+a(m.growth)+"% ",3)])])]))),128))])]),e("div",Cs,[v[14]||(v[14]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Actions rapides")],-1)),e("div",Es,[e("button",{onClick:H,class:"admin-btn-primary w-full justify-center"},[A(k(mt),{class:"w-4 h-4 mr-2"}),v[12]||(v[12]=B(" Gérer les utilisateurs ",-1))]),e("button",{onClick:Z,class:"admin-btn-secondary w-full justify-center"},[A(k(pt),{class:"w-4 h-4 mr-2"}),v[13]||(v[13]=B(" Générer rapport ",-1))])])])])])]))}},As={class:"px-6"},Ss={class:"mb-8"},js={class:"flex justify-between items-center"},Ps={class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6"},Ds={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Us=["value"],Ms={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Vs={class:"px-6 py-4 border-b border-gray-200"},Ts={class:"flex justify-between items-center"},Ls={class:"text-lg font-semibold text-gray-900"},Rs={class:"flex space-x-2"},Fs={class:"p-2 text-gray-400 hover:text-gray-600"},Is={key:0,class:"p-8 text-center"},Ns={key:1,class:"overflow-x-auto"},qs={class:"min-w-full divide-y divide-gray-200"},zs={class:"bg-white divide-y divide-gray-200"},Bs={class:"px-6 py-4 whitespace-nowrap"},Os={class:"flex items-center"},Gs={class:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center"},Xs={class:"text-sm font-medium text-gray-700"},Hs={class:"ml-4"},Js={class:"text-sm font-medium text-gray-900"},Ks={key:0,class:"text-sm text-gray-500"},Ws={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ys={class:"px-6 py-4 whitespace-nowrap"},Qs={class:"px-6 py-4 whitespace-nowrap"},Zs={class:"flex items-center space-x-2"},ea={key:0,class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},ta={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},sa={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},aa={class:"flex space-x-2"},oa=["onClick"],na=["onClick"],ia={class:"px-6 py-3 border-t border-gray-200"},ra={class:"flex items-center justify-between"},la={class:"text-sm text-gray-700"},da={class:"flex space-x-2"},ua=["disabled"],ca=["disabled"],Cp={__name:"UserManagement",setup(x){const{get:E,post:I}=pe(),P=$([]),f=$(!1);$(!1);const S=$(1),p=$(20),h=$(0),M=$([]),D=se({search:"",role:"",status:""});be(()=>D,()=>{S.value=1,G()},{deep:!0});const V=W(()=>P.value),U=W(()=>P.value),O=W(()=>Math.ceil(h.value/p.value)),G=async()=>{f.value=!0;try{const T=new URLSearchParams;T.append("page",S.value),T.append("per_page",p.value),D.search&&T.append("search",D.search),D.role&&T.append("role",D.role),D.status&&T.append("status",D.status);const v=await E(`/admin/users?${T.toString()}`);v&&v.data&&(P.value=v.data.users||[],h.value=v.data.pagination?.total||0,M.value=v.data.available_roles||[])}catch(T){console.error("Erreur lors du chargement des utilisateurs:",T),P.value=[]}finally{f.value=!1}},N=()=>{D.search="",D.role="",D.status="",S.value=1},H=T=>{console.log("Éditer utilisateur:",T)},q=async T=>{try{const v=await I(`/admin/users/${T.id}/toggle-status`);v&&v.success&&(await G(),window.$toast&&window.$toast.success(v.message||"Statut modifié","✓ Succès"))}catch(v){console.error("Erreur lors de la modification du statut:",v),window.$toast&&window.$toast.error("Erreur lors de la modification du statut","✘ Erreur")}},Q=T=>new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(T)),X=T=>({"Super Admin":"Super Admin",Admin:"Administrateur",Agent:"Agent","Agent Back Office":"Agent BO",Marchand:"Marchand",Client:"Client"})[T]||T,Z=T=>({"Super Admin":"bg-purple-100 text-purple-800",Admin:"bg-red-100 text-red-800",Agent:"bg-yellow-100 text-yellow-800","Agent Back Office":"bg-orange-100 text-orange-800",Marchand:"bg-blue-100 text-blue-800",Client:"bg-green-100 text-green-800"})[T]||"bg-gray-100 text-gray-800";return be(S,()=>{G()}),me(()=>{G()}),(T,v)=>(i(),r("div",As,[e("div",Ss,[e("div",js,[v[6]||(v[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion des Utilisateurs"),e("p",{class:"mt-2 text-gray-600"},"Gérez tous les utilisateurs de la plateforme")],-1)),e("button",{onClick:G,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"},[A(k(ve),{class:Y(["w-5 h-5 inline mr-2",f.value?"animate-spin":""])},null,8,["class"]),v[5]||(v[5]=B(" Recharger ",-1))])])]),e("div",Ps,[e("div",Ds,[e("div",null,[v[7]||(v[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rechercher",-1)),w(e("input",{"onUpdate:modelValue":v[0]||(v[0]=m=>D.search=m),type:"text",placeholder:"Nom, email...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,D.search]])]),e("div",null,[v[9]||(v[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rôle",-1)),w(e("select",{"onUpdate:modelValue":v[1]||(v[1]=m=>D.role=m),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[v[8]||(v[8]=e("option",{value:""},"Tous les rôles",-1)),(i(!0),r(J,null,K(M.value,m=>(i(),r("option",{key:m.value,value:m.value},a(m.label),9,Us))),128))],512),[[ee,D.role]])]),e("div",null,[v[11]||(v[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),w(e("select",{"onUpdate:modelValue":v[2]||(v[2]=m=>D.status=m),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},v[10]||(v[10]=[ne('<option value="">Tous les statuts</option><option value="active">Actif</option><option value="inactive">Inactif</option><option value="verified">Vérifié</option><option value="unverified">Non vérifié</option>',5)]),512),[[ee,D.status]])]),e("div",{class:"flex items-end"},[e("button",{onClick:N,class:"w-full px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"}," Réinitialiser ")])])]),e("div",Ms,[e("div",Vs,[e("div",Ts,[e("h3",Ls," Utilisateurs ("+a(V.value.length)+") ",1),e("div",Rs,[e("button",Fs,[A(k(ve),{class:"w-5 h-5"})])])])]),f.value?(i(),r("div",Is,v[12]||(v[12]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Chargement...",-1)]))):(i(),r("div",Ns,[e("table",qs,[v[13]||(v[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Utilisateur "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Rôle "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Inscription "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",zs,[(i(!0),r(J,null,K(U.value,m=>(i(),r("tr",{key:m.id,class:"hover:bg-gray-50"},[e("td",Bs,[e("div",Os,[e("div",Gs,[e("span",Xs,a(m.first_name[0])+a(m.last_name[0]),1)]),e("div",Hs,[e("div",Js,a(m.first_name)+" "+a(m.last_name),1),m.phone?(i(),r("div",Ks,a(m.phone),1)):z("",!0)])])]),e("td",Ws,a(m.email),1),e("td",Ys,[e("span",{class:Y(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",Z(m.primary_role)])},a(X(m.primary_role)),3)]),e("td",Qs,[e("div",Zs,[e("span",{class:Y(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",m.is_active?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},a(m.is_active?"Actif":"Inactif"),3),m.verified_at?(i(),r("span",ea," Vérifié ")):z("",!0)])]),e("td",ta,a(Q(m.created_at)),1),e("td",sa,[e("div",aa,[e("button",{onClick:b=>H(m),class:"text-blue-600 hover:text-blue-900"}," Modifier ",8,oa),e("button",{onClick:b=>q(m),class:Y(m.is_active?"text-red-600 hover:text-red-900":"text-blue-600 hover:text-blue-900")},a(m.is_active?"Désactiver":"Activer"),11,na)])])]))),128))])])])),e("div",ia,[e("div",ra,[e("div",la," Affichage de "+a((S.value-1)*p.value+1)+" à "+a(Math.min(S.value*p.value,h.value))+" sur "+a(h.value)+" résultats ",1),e("div",da,[e("button",{onClick:v[3]||(v[3]=m=>S.value--),disabled:S.value===1,class:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded disabled:opacity-50"}," Précédent ",8,ua),e("button",{onClick:v[4]||(v[4]=m=>S.value++),disabled:S.value===O.value,class:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded disabled:opacity-50"}," Suivant ",8,ca)])])])])]))}},ma={class:"mb-8 flex justify-between items-center"},pa={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},ga={class:"flex items-center"},fa={class:"ml-4"},va={class:"text-sm font-medium text-gray-600"},xa={class:"text-2xl font-bold text-gray-900"},ba={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6"},ya={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},_a=["value"],wa={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},ha={key:0,class:"text-center py-12"},$a={key:1},ka={class:"px-6 py-3 bg-gray-50 border-b border-gray-200"},Ca={class:"flex justify-between items-center"},Ea={class:"text-lg font-semibold text-gray-900"},Aa={class:"overflow-x-auto"},Sa={class:"min-w-full divide-y divide-gray-200"},ja={class:"bg-white divide-y divide-gray-200"},Pa={class:"px-6 py-4 whitespace-nowrap"},Da={class:"flex items-center"},Ua={class:"w-16 h-16 flex-shrink-0"},Ma={class:"ml-4"},Va={class:"text-sm font-medium text-gray-900"},Ta={class:"text-sm text-gray-500 line-clamp-2"},La={class:"px-6 py-4 whitespace-nowrap"},Ra={class:"text-sm text-gray-900"},Fa={class:"px-6 py-4 whitespace-nowrap"},Ia={class:"text-sm text-gray-900"},Na={key:0,class:"text-xs text-gray-500"},qa={class:"px-6 py-4 whitespace-nowrap"},za={key:0,class:"text-sm text-gray-900"},Ba={key:1,class:"text-xs text-gray-500"},Oa={class:"px-6 py-4 whitespace-nowrap"},Ga={class:"px-6 py-4 whitespace-nowrap"},Xa={key:0},Ha={class:"flex items-center"},Ja={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},Ka={class:"text-xs text-gray-600"},Wa={class:"text-xs text-gray-500 mt-1"},Ya={key:1,class:"text-xs text-gray-500"},Qa={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Za={class:"flex space-x-2"},eo=["onClick"],to=["onClick"],so=["onClick"],ao={class:"px-6 py-3 border-t border-gray-200"},oo={class:"flex items-center justify-between"},no={class:"text-sm text-gray-700"},io={class:"flex space-x-2"},ro=["disabled"],lo=["disabled"],uo={key:0,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},co={class:"bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},mo={class:"px-6 py-4 space-y-4"},po={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},go=["value"],fo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vo={key:0},xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={class:"flex items-center pt-6"},yo={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},_o=["disabled"],wo={key:0},ho={key:1},$o={__name:"ProductManagement",setup(x){const{get:E,put:I,delete:P}=pe(),f=Be(),S=$(!1),p=$(!1),h=$(!1),M=$(null),D=$([]),V=$([]),U=$(1),O=$(0),G=$(20),N=se({search:"",category:"",status:""}),H=$([{label:"Total produits",value:"0",color:"bg-blue-500",icon:qe},{label:"Actifs",value:"0",color:"bg-green-500",icon:Ue},{label:"Valeur totale",value:"0 FCFA",color:"bg-yellow-500",icon:_e},{label:"En tombola",value:"0 FCFA",color:"bg-purple-500",icon:Ae}]),q=se({name:"",description:"",price:"",ticket_price:"",category_id:"",sale_mode:"direct",status:"draft",is_featured:!1});be(()=>N,()=>{U.value=1,X()},{deep:!0}),be(U,()=>{X()});const Q=W(()=>Math.ceil(O.value/G.value)),X=async()=>{S.value=!0;try{const o=new URLSearchParams;o.append("page",U.value),o.append("per_page",G.value),N.search&&o.append("search",N.search),N.category&&o.append("category_id",N.category),N.status&&o.append("status",N.status);const s=await E(`/admin/products?${o.toString()}`);s&&s.data&&(D.value=s.data.products||[],O.value=s.data.pagination?.total||0,V.value=s.data.categories||[],s.data.stats&&(H.value[0].value=s.data.stats.total?.toString()||"0",H.value[1].value=s.data.stats.active?.toString()||"0",H.value[2].value=y(s.data.stats.total_value||0)+" FCFA",H.value[3].value=y(s.data.stats.total_lottery_value||0)+" FCFA"))}catch(o){console.error("Erreur lors du chargement des produits:",o),D.value=[]}finally{S.value=!1}},Z=async()=>{p.value=!0;try{const o=await I(`/admin/products/${M.value.id}`,q);o&&o.success&&(await X(),h.value=!1,L(),window.$toast&&window.$toast.success("Produit mis à jour avec succès","✓ Succès"))}catch(o){console.error("Erreur lors de la mise à jour:",o),window.$toast&&window.$toast.error("Erreur lors de la mise à jour","✗ Erreur")}finally{p.value=!1}},T=async o=>{if(confirm("Voulez-vous vraiment supprimer ce produit ? Cette action est irréversible."))try{const s=await P(`/admin/products/${o}`);s&&s.success&&(await X(),window.$toast&&window.$toast.success("Produit supprimé avec succès","✓ Succès"))}catch(s){if(console.error("Erreur lors de la suppression:",s),window.$toast){const u=s.response?.data?.message||"Erreur lors de la suppression";window.$toast.error(u,"✗ Erreur")}}},v=o=>{M.value=o,Object.assign(q,{name:o.name,description:o.description,price:o.price,ticket_price:o.ticket_price,category_id:o.category_id,sale_mode:o.sale_mode,status:o.status,is_featured:o.is_featured||!1}),h.value=!0},m=o=>{f.push(`/admin/products/${o}`)},b=()=>{h.value=!1,L()},L=()=>{Object.assign(q,{name:"",description:"",price:"",ticket_price:"",category_id:"",sale_mode:"direct",status:"draft",is_featured:!1}),M.value=null},F=()=>{N.search="",N.category="",N.status="",U.value=1},y=o=>new Intl.NumberFormat("fr-FR").format(o||0),d=o=>({active:"Actif",draft:"Brouillon",completed:"Terminé",cancelled:"Annulé"})[o]||o,j=o=>({active:"bg-green-100 text-green-800",draft:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",_=o=>({direct:"Vente directe",lottery:"Tombola"})[o]||o;return me(()=>{X()}),(o,s)=>(i(),r("div",null,[e("div",ma,[s[14]||(s[14]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion des produits"),e("p",{class:"mt-2 text-gray-600"},"Gérez les produits disponibles pour les tombolas")],-1)),e("button",{onClick:X,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center"},[A(k(ve),{class:Y(["w-5 h-5 mr-2",S.value?"animate-spin":""])},null,8,["class"]),s[13]||(s[13]=B(" Actualiser ",-1))])]),e("div",pa,[(i(!0),r(J,null,K(H.value,u=>(i(),r("div",{key:u.label,class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},[e("div",ga,[e("div",{class:Y(["p-3 rounded-lg",u.color])},[(i(),ue(ce(u.icon),{class:"w-6 h-6 text-white"}))],2),e("div",fa,[e("p",va,a(u.label),1),e("p",xa,a(u.value),1)])])]))),128))]),e("div",ba,[e("div",ya,[e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rechercher",-1)),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>N.search=u),type:"text",placeholder:"Nom du produit...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,N.search]])]),e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catégorie",-1)),w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=u=>N.category=u),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[s[16]||(s[16]=e("option",{value:""},"Toutes les catégories",-1)),(i(!0),r(J,null,K(V.value,u=>(i(),r("option",{key:u.id,value:u.id},a(u.name),9,_a))),128))],512),[[ee,N.category]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),w(e("select",{"onUpdate:modelValue":s[2]||(s[2]=u=>N.status=u),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},s[18]||(s[18]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"completed"},"Terminé",-1)]),512),[[ee,N.status]])]),e("div",{class:"flex items-end"},[e("button",{onClick:F,class:"w-full px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"}," Réinitialiser ")])])]),e("div",wa,[S.value?(i(),r("div",ha,s[20]||(s[20]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des produits...",-1)]))):(i(),r("div",$a,[e("div",ka,[e("div",Ca,[e("h3",Ea,a(O.value)+" produit"+a(O.value>1?"s":""),1)])]),e("div",Aa,[e("table",Sa,[s[21]||(s[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Produit "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Catégorie "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Prix "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Marchand "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tombola "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ja,[(i(!0),r(J,null,K(D.value,u=>(i(),r("tr",{key:u.id,class:"hover:bg-gray-50"},[e("td",Pa,[e("div",Da,[e("div",Ua,[A(Te,{src:u.image_url||u.main_image,alt:u.name,"container-class":"w-16 h-16 rounded-lg","image-class":"w-full h-full object-cover rounded-lg"},null,8,["src","alt"])]),e("div",Ma,[e("div",Va,a(u.name),1),e("div",Ta,a(u.description),1)])])]),e("td",La,[e("span",Ra,a(u.category?.name||"N/A"),1)]),e("td",Fa,[e("div",Ia,a(y(u.price))+" FCFA",1),u.sale_mode==="lottery"?(i(),r("div",Na,a(y(u.ticket_price))+" FCFA/ticket ",1)):z("",!0)]),e("td",qa,[u.merchant?(i(),r("div",za,a(u.merchant.name),1)):z("",!0),u.merchant?(i(),r("div",Ba,a(u.merchant.email),1)):z("",!0)]),e("td",Oa,[e("span",{class:Y(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",j(u.status)])},a(d(u.status)),3)]),e("td",Ga,[u.lottery?(i(),r("div",Xa,[e("div",Ha,[e("div",Ja,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:Me({width:u.lottery.progress+"%"})},null,4)]),e("span",Ka,a(u.lottery.progress)+"%",1)]),e("div",Wa,a(u.lottery.sold_tickets)+"/"+a(u.lottery.total_tickets)+" tickets ",1)])):(i(),r("span",Ya,a(_(u.sale_mode)),1))]),e("td",Qa,[e("div",Za,[e("button",{onClick:ie=>v(u),class:"text-blue-600 hover:text-blue-900",title:"Modifier"},[A(k(Ce),{class:"w-4 h-4"})],8,eo),e("button",{onClick:ie=>m(u.id),class:"text-blue-600 hover:text-blue-900",title:"Voir"},[A(k(Le),{class:"w-4 h-4"})],8,to),e("button",{onClick:ie=>T(u.id),class:"text-red-600 hover:text-red-900",title:"Supprimer"},[A(k(he),{class:"w-4 h-4"})],8,so)])])]))),128))])])]),e("div",ao,[e("div",oo,[e("div",no," Affichage de "+a((U.value-1)*G.value+1)+" à "+a(Math.min(U.value*G.value,O.value))+" sur "+a(O.value)+" résultats ",1),e("div",io,[e("button",{onClick:s[3]||(s[3]=u=>U.value--),disabled:U.value===1,class:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded disabled:opacity-50"}," Précédent ",8,ro),e("button",{onClick:s[4]||(s[4]=u=>U.value++),disabled:U.value===Q.value,class:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded disabled:opacity-50"}," Suivant ",8,lo)])])])]))]),h.value?(i(),r("div",uo,[e("div",co,[s[31]||(s[31]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"}," Modifier le produit ")],-1)),e("form",{onSubmit:s[12]||(s[12]=le(u=>Z(),["prevent"]))},[e("div",mo,[e("div",po,[e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom *",-1)),w(e("input",{"onUpdate:modelValue":s[5]||(s[5]=u=>q.name=u),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,q.name]])]),e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catégorie *",-1)),w(e("select",{"onUpdate:modelValue":s[6]||(s[6]=u=>q.category_id=u),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[s[23]||(s[23]=e("option",{value:""},"Sélectionner une catégorie",-1)),(i(!0),r(J,null,K(V.value,u=>(i(),r("option",{key:u.id,value:u.id},a(u.name),9,go))),128))],512),[[ee,q.category_id]])])]),e("div",null,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description",-1)),w(e("textarea",{"onUpdate:modelValue":s[7]||(s[7]=u=>q.description=u),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,q.description]])]),e("div",fo,[e("div",null,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prix du produit (FCFA) *",-1)),w(e("input",{"onUpdate:modelValue":s[8]||(s[8]=u=>q.price=u),type:"number",required:"",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,q.price,void 0,{number:!0}]])]),q.sale_mode==="lottery"?(i(),r("div",vo,[s[27]||(s[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prix par ticket (FCFA)",-1)),w(e("input",{"onUpdate:modelValue":s[9]||(s[9]=u=>q.ticket_price=u),type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,q.ticket_price,void 0,{number:!0}]])])):z("",!0)]),e("div",xo,[e("div",null,[s[29]||(s[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),w(e("select",{"onUpdate:modelValue":s[10]||(s[10]=u=>q.status=u),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},s[28]||(s[28]=[e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"completed"},"Terminé",-1),e("option",{value:"cancelled"},"Annulé",-1)]),512),[[ee,q.status]])]),e("div",bo,[w(e("input",{"onUpdate:modelValue":s[11]||(s[11]=u=>q.is_featured=u),type:"checkbox",class:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[re,q.is_featured]]),s[30]||(s[30]=e("label",{class:"ml-2 text-sm text-gray-700"},"Produit en vedette",-1))])])]),e("div",yo,[e("button",{type:"button",onClick:b,class:"px-4 py-2 text-gray-600 hover:text-gray-900"}," Annuler "),e("button",{type:"submit",disabled:p.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"},[p.value?(i(),r("span",wo,"Enregistrement...")):(i(),r("span",ho,"Modifier"))],8,_o)])],32)])])):z("",!0)]))}},Ep=Ke($o,[["__scopeId","data-v-3bfa4d60"]]),ko={class:"mb-8"},Co={class:"flex justify-between items-center"},Eo=["disabled"],Ao={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},So={class:"flex items-center"},jo={class:"ml-4"},Po={class:"text-sm font-medium text-gray-600"},Do={class:"text-2xl font-bold text-gray-900"},Uo={class:"mb-8"},Mo={class:"border-b border-gray-200"},Vo={class:"flex space-x-8"},To=["onClick"],Lo={key:0,class:"ml-2 bg-gray-100 text-gray-600 py-1 px-2 rounded-full text-xs"},Ro={class:"mt-4 flex justify-between items-center"},Fo={class:"flex space-x-3"},Io={class:"text-sm text-gray-500"},No={key:0,class:"text-center py-12"},qo={key:1},zo={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Bo={key:0,class:"text-center py-12"},Oo={key:1,class:"divide-y divide-gray-200"},Go={class:"flex items-center justify-between"},Xo={class:"flex items-center space-x-4"},Ho=["src","alt"],Jo={class:"text-lg font-semibold text-gray-900"},Ko={class:"text-sm text-gray-600"},Wo={class:"flex items-center space-x-4 mt-2"},Yo={class:"text-sm font-medium text-blue-600"},Qo={class:"text-sm text-gray-500"},Zo={class:"flex space-x-3"},en=["onClick"],tn=["onClick","disabled"],sn={key:0},an={key:1},on={class:"mt-4"},nn={class:"w-full bg-gray-200 rounded-full h-2"},rn={key:2},ln={class:"bg-white rounded-lg shadow-sm border border-gray-200"},dn={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},un={class:"flex space-x-2"},cn={class:"overflow-x-auto"},mn={class:"min-w-full divide-y divide-gray-200"},pn={class:"bg-white divide-y divide-gray-200"},gn={class:"px-6 py-4 whitespace-nowrap"},fn={class:"flex items-center"},vn=["src","alt"],xn={class:"ml-4"},bn={class:"text-sm font-medium text-gray-900"},yn={class:"text-sm text-gray-500"},_n={class:"px-6 py-4 whitespace-nowrap"},wn={class:"text-sm text-gray-900"},hn={class:"w-full bg-gray-200 rounded-full h-2 mt-1"},$n={class:"text-xs text-gray-500 mt-1"},kn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Cn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},En={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},An={class:"flex space-x-2"},Sn=["onClick"],jn=["onClick"],Pn={key:3},Dn={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Un={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},Mn={class:"flex space-x-2"},Vn={class:"divide-y divide-gray-200"},Tn={class:"flex items-start justify-between"},Ln={class:"flex items-start space-x-4"},Rn=["src","alt"],Fn={class:"text-lg font-semibold text-gray-900"},In={class:"text-sm text-gray-600"},Nn={class:"flex items-center space-x-4 mt-2"},qn={class:"text-sm text-gray-500"},zn={class:"text-sm font-medium text-blue-600"},Bn={class:"text-right"},On={class:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800"},Gn={class:"mt-2 text-sm text-gray-600"},Xn={key:0,class:"mt-4 bg-green-50 p-4 rounded-lg"},Hn={class:"flex items-center justify-between"},Jn={class:"flex items-center"},Kn={class:"font-semibold text-green-900"},Wn={class:"text-sm text-green-800"},Yn={class:"text-right"},Qn={class:"text-sm text-green-800"},Zn={class:"text-sm text-green-600"},ei={class:"flex justify-end space-x-2 mt-4"},ti=["onClick"],si=["onClick"],ai={key:4,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},oi={class:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto"},ni={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},ii={class:"text-lg font-semibold text-gray-900"},ri={class:"px-6 py-4"},li={class:"mb-4"},di={class:"overflow-x-auto"},ui={class:"min-w-full divide-y divide-gray-200"},ci={class:"bg-white divide-y divide-gray-200"},mi={class:"px-6 py-4 whitespace-nowrap"},pi={class:"text-sm font-medium text-gray-900"},gi={class:"text-sm text-gray-500"},fi={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},vi={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},xi={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},bi={key:5,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},yi={class:"bg-white rounded-lg max-w-md w-full mx-4"},_i={class:"px-6 py-4"},wi={class:"text-gray-600 mb-4"},hi={class:"font-semibold"},$i={class:"bg-gray-50 p-4 rounded-lg mb-4"},ki={class:"text-sm text-gray-600"},Ci={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},Ei=["disabled"],Ai={key:0},Si={key:1},Ap={__name:"LotteryManagement",setup(x){const{get:E,post:I}=pe(),P=$(!1),f=$("pending"),S=$(!1),p=$(!1),h=$(!1),M=$(null),D=$(""),V=$({}),U=$([]),O=$(1),G=$(1),N=$(20),H=W(()=>[{key:"pending",label:"Tirages en attente",count:V.value.pending_draws||0},{key:"active",label:"Tombolas actives",count:V.value.active_lotteries||0},{key:"completed",label:"Historique",count:V.value.completed_lotteries||0}]),q=W(()=>[{label:"Tirages en attente",value:V.value.pending_draws||"0",color:"bg-yellow-500",icon:ye},{label:"Actives",value:V.value.active_lotteries||"0",color:"bg-blue-500",icon:Ue},{label:"Revenus totaux",value:y(V.value.total_revenue||0)+" FCFA",color:"bg-green-500",icon:_e},{label:"Taux de participation",value:Math.round(V.value.average_participation_rate||0)+"%",color:"bg-purple-500",icon:Ae}]),Q=se({search:""}),X=se({search:"",period:""}),Z=W(()=>U.value.filter(C=>C.status==="active"&&!C.is_drawn&&new Date(C.end_date)<=new Date)),T=W(()=>U.value.filter(C=>C.status==="active"&&new Date(C.end_date)>new Date)),v=W(()=>U.value.filter(C=>C.status==="completed"||C.is_drawn)),m=W(()=>{let C=T.value;if(Q.search){const g=Q.search.toLowerCase();C=C.filter(c=>c.product?.title?.toLowerCase().includes(g)||c.product?.name?.toLowerCase().includes(g)||c.product?.description?.toLowerCase().includes(g)||c.lottery_number?.toLowerCase().includes(g))}return C}),b=W(()=>{let C=v.value;if(X.search){const g=X.search.toLowerCase();C=C.filter(c=>c.product?.title?.toLowerCase().includes(g)||c.product?.name?.toLowerCase().includes(g)||c.winner?.first_name?.toLowerCase().includes(g)||c.winner?.last_name?.toLowerCase().includes(g)||c.winner?.email?.toLowerCase().includes(g)||c.lottery_number?.toLowerCase().includes(g))}if(X.period){const g=new Date,c=X.period;C=C.filter(te=>{const oe=new Date(te.draw_date||te.created_at);if(c==="week"){const ge=new Date(g.getTime()-6048e5);return oe>=ge}else if(c==="month"){const ge=new Date(g.getFullYear(),g.getMonth()-1,g.getDate());return oe>=ge}else if(c==="quarter"){const ge=new Date(g.getFullYear(),g.getMonth()-3,g.getDate());return oe>=ge}return!0})}return C}),L=W(()=>{if(!M.value?.participants_list)return[];let C=M.value.participants_list;if(D.value){const g=D.value.toLowerCase();C=C.filter(c=>{const te=c.user;return`${te?.first_name||""} ${te?.last_name||""}`.toLowerCase().includes(g)||te?.email?.toLowerCase().includes(g)})}return C}),F=C=>new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(C)),y=C=>new Intl.NumberFormat("fr-FR").format(C||0);be(f,()=>{j()});const d=async()=>{try{const C=await E("/admin/lotteries/statistics");C&&(V.value=C)}catch(C){console.error("Erreur lors du chargement des statistiques:",C)}},j=async()=>{P.value=!0;try{const C=new URLSearchParams;C.append("per_page",N.value),C.append("page",O.value),f.value==="active"||f.value==="pending"?(C.append("status","active"),C.append("is_drawn","false")):f.value==="completed"&&C.append("is_drawn","true");const g=await E(`/admin/lotteries?${C.toString()}`);g&&g.data&&(U.value=g.data.map(c=>({...c,progress:c.sold_tickets&&c.total_tickets?Math.round(c.sold_tickets/c.total_tickets*100):0})),O.value=g.current_page||1,G.value=g.last_page||1)}catch(C){console.error("Erreur lors du chargement des tombolas:",C),U.value=[]}finally{P.value=!1}},_=async()=>{await Promise.all([d(),j()])},o=async C=>{try{const g=await E(`/admin/lotteries/${C.id}`);g&&(M.value=g,p.value=!0)}catch(g){console.error("Erreur lors du chargement des participants:",g),window.$toast&&window.$toast.error("Erreur lors du chargement des participants","✗ Erreur")}},s=C=>{M.value=C,h.value=!0},u=async()=>{S.value=!0;try{const C=await I(`/admin/lotteries/${M.value.id}/draw`);C&&C.success&&(window.$toast&&window.$toast.success("Tirage effectué avec succès","✓ Succès"),await _(),f.value="completed")}catch(C){if(console.error("Erreur lors du tirage:",C),window.$toast){const g=C.response?.data?.message||"Erreur lors du tirage";window.$toast.error(g,"✗ Erreur")}}finally{S.value=!1,h.value=!1,M.value=null}},ie=C=>{console.log("Edit lottery:",C.id)},de=async C=>{try{const g=await E(`/admin/lotteries/${C.id}`);g&&console.log("Draw details:",g)}catch(g){console.error("Erreur lors du chargement des détails:",g)}},Se=async C=>{try{const g=await E(`/admin/lotteries/${C.id}/export`);if(g){const c=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),te=URL.createObjectURL(c),oe=document.createElement("a");oe.href=te,oe.download=`lottery-${C.lottery_number}-export.json`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(te),window.$toast&&window.$toast.success("Export téléchargé avec succès","✓ Succès")}}catch(g){console.error("Erreur lors de l'export:",g),window.$toast&&window.$toast.error("Erreur lors de l'export","✗ Erreur")}},je=async()=>{try{const C=await E("/admin/lotteries/eligible-for-draw");C&&(console.log("Eligible draws:",C),window.$toast&&window.$toast.info(`${C.count} tirages disponibles`,"ℹ Info"))}catch(C){console.error("Erreur lors du chargement des tirages disponibles:",C)}};return me(()=>{d(),j()}),(C,g)=>(i(),r("div",null,[e("div",ko,[e("div",Co,[g[8]||(g[8]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion des tombolas"),e("p",{class:"mt-2 text-gray-600"},"Gérez les tirages et suivez les résultats des tombolas")],-1)),e("button",{onClick:_,disabled:P.value,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:bg-gray-400"},[(i(),r("svg",{class:Y(["w-4 h-4 mr-2",P.value?"animate-spin":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},g[6]||(g[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),g[7]||(g[7]=B(" Actualiser ",-1))],8,Eo)])]),e("div",Ao,[(i(!0),r(J,null,K(q.value,c=>(i(),r("div",{key:c.label,class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},[e("div",So,[e("div",{class:Y(["p-3 rounded-lg",c.color])},[(i(),ue(ce(c.icon),{class:"w-6 h-6 text-white"}))],2),e("div",jo,[e("p",Po,a(c.label),1),e("p",Do,a(c.value),1)])])]))),128))]),e("div",Uo,[e("div",Mo,[e("nav",Vo,[(i(!0),r(J,null,K(H.value,c=>(i(),r("button",{key:c.key,onClick:te=>f.value=c.key,class:Y(["py-2 px-1 border-b-2 font-medium text-sm",f.value===c.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[B(a(c.label)+" ",1),c.count!==void 0?(i(),r("span",Lo,a(c.count),1)):z("",!0)],10,To))),128))])]),e("div",Ro,[e("div",Fo,[e("button",{onClick:je,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700"},[g[9]||(g[9]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1)),B(" Tirages disponibles ("+a(V.value.pending_draws||0)+") ",1)])]),e("div",Io," Dernière mise à jour : "+a(new Date().toLocaleTimeString("fr-FR")),1)])]),P.value?(i(),r("div",No,g[10]||(g[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des tombolas...",-1)]))):f.value==="pending"?(i(),r("div",qo,[e("div",zo,[g[13]||(g[13]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Tirages en attente"),e("p",{class:"text-sm text-gray-600"},"Tombolas prêtes pour le tirage")],-1)),Z.value.length===0?(i(),r("div",Bo,[A(k(ye),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),g[11]||(g[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucun tirage en attente",-1)),g[12]||(g[12]=e("p",{class:"text-gray-600"},"Toutes les tombolas sont à jour",-1))])):(i(),r("div",Oo,[(i(!0),r(J,null,K(Z.value,c=>(i(),r("div",{key:c.id,class:"p-6 hover:bg-gray-50"},[e("div",Go,[e("div",Xo,[e("img",{src:c.product?.image_url||c.product?.main_image||"/images/placeholder.jpg",alt:c.product?.title||c.product?.name,class:"w-16 h-16 rounded-lg object-cover"},null,8,Ho),e("div",null,[e("h4",Jo,a(c.product?.title||c.product?.name),1),e("p",Ko,a(c.product?.description),1),e("div",Wo,[e("span",Yo,a(c.sold_tickets||0)+"/"+a(c.total_tickets)+" tickets vendus ",1),e("span",Qo," Tirage prévu: "+a(F(c.draw_date||c.end_date)),1)])])]),e("div",Zo,[e("button",{onClick:te=>o(c),class:"px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"}," Voir participants ",8,en),e("button",{onClick:te=>s(c),disabled:S.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400"},[S.value?(i(),r("span",sn,"Tirage...")):(i(),r("span",an,"Effectuer le tirage"))],8,tn)])]),e("div",on,[e("div",nn,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Me({width:c.progress+"%"})},null,4)])])]))),128))]))])])):f.value==="active"?(i(),r("div",rn,[e("div",ln,[e("div",dn,[g[14]||(g[14]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Tombolas actives"),e("p",{class:"text-sm text-gray-600"},"Tombolas en cours de vente")],-1)),e("div",un,[w(e("input",{"onUpdate:modelValue":g[0]||(g[0]=c=>Q.search=c),type:"text",placeholder:"Rechercher...",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,Q.search]])])]),e("div",cn,[e("table",mn,[g[15]||(g[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Produit "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Progression "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Revenus "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date de tirage "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",pn,[(i(!0),r(J,null,K(m.value,c=>(i(),r("tr",{key:c.id,class:"hover:bg-gray-50"},[e("td",gn,[e("div",fn,[e("img",{src:c.product?.image_url||c.product?.main_image||"/images/placeholder.jpg",alt:c.product?.title||c.product?.name,class:"w-12 h-12 rounded-lg object-cover"},null,8,vn),e("div",xn,[e("div",bn,a(c.product?.title||c.product?.name),1),e("div",yn,a(y(c.product?.price||0))+" FCFA",1)])])]),e("td",_n,[e("div",wn,a(c.progress)+"%",1),e("div",hn,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:Me({width:c.progress+"%"})},null,4)]),e("div",$n,a(c.sold_tickets||0)+"/"+a(c.total_tickets),1)]),e("td",kn,a(y((c.sold_tickets||0)*(c.ticket_price||0)))+" FCFA ",1),e("td",Cn,a(F(c.draw_date||c.end_date)),1),e("td",En,[e("div",An,[e("button",{onClick:te=>ie(c),class:"text-blue-600 hover:text-blue-900",title:"Modifier"},[A(k(Ce),{class:"w-4 h-4"})],8,Sn),e("button",{onClick:te=>o(c),class:"text-blue-600 hover:text-blue-900",title:"Voir participants"},[A(k(ze),{class:"w-4 h-4"})],8,jn)])])]))),128))])])])])])):f.value==="completed"?(i(),r("div",Pn,[e("div",Dn,[e("div",Un,[g[17]||(g[17]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Tirages terminés"),e("p",{class:"text-sm text-gray-600"},"Historique des tombolas terminées")],-1)),e("div",Mn,[w(e("input",{"onUpdate:modelValue":g[1]||(g[1]=c=>X.search=c),type:"text",placeholder:"Rechercher...",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,X.search]]),w(e("select",{"onUpdate:modelValue":g[2]||(g[2]=c=>X.period=c),class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},g[16]||(g[16]=[e("option",{value:""},"Toutes les périodes",-1),e("option",{value:"week"},"Cette semaine",-1),e("option",{value:"month"},"Ce mois",-1),e("option",{value:"quarter"},"Ce trimestre",-1)]),512),[[ee,X.period]])])]),e("div",Vn,[(i(!0),r(J,null,K(b.value,c=>(i(),r("div",{key:c.id,class:"p-6"},[e("div",Tn,[e("div",Ln,[e("img",{src:c.product?.image_url||c.product?.main_image||"/images/placeholder.jpg",alt:c.product?.title||c.product?.name,class:"w-16 h-16 rounded-lg object-cover"},null,8,Rn),e("div",null,[e("h4",Fn,a(c.product?.title||c.product?.name),1),e("p",In,a(c.product?.description),1),e("div",Nn,[e("span",qn," Tirage effectué: "+a(F(c.draw_date||c.updated_at)),1),e("span",zn," Revenus: "+a(y((c.sold_tickets||0)*(c.ticket_price||0)))+" FCFA ",1)])])]),e("div",Bn,[e("span",On,[A(k(Xe),{class:"w-4 h-4 mr-1"}),g[18]||(g[18]=B(" Terminé ",-1))]),e("div",Gn," Gagnant: "+a(c.winner?`${c.winner.first_name} ${c.winner.last_name}`:"Non réclamé"),1)])]),c.winner?(i(),r("div",Xn,[e("div",Hn,[e("div",Jn,[A(k(Ue),{class:"w-5 h-5 text-green-600 mr-2"}),e("div",null,[e("p",Kn,a(c.winner.first_name)+" "+a(c.winner.last_name),1),e("p",Wn,"Ticket gagnant: #"+a(c.winning_ticket_number||"N/A"),1)])]),e("div",Yn,[e("p",Qn,a(c.winner.email),1),e("p",Zn,a(c.winner.phone),1)])])])):z("",!0),e("div",ei,[e("button",{onClick:te=>de(c),class:"px-3 py-1 text-sm text-blue-600 hover:text-blue-800"}," Voir détails ",8,ti),e("button",{onClick:te=>Se(c),class:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800"}," Exporter ",8,si)])]))),128))])])])):z("",!0),p.value?(i(),r("div",ai,[e("div",oi,[e("div",ni,[e("h3",ii," Participants - "+a(M.value?.product?.title||M.value?.product?.name),1),e("button",{onClick:g[3]||(g[3]=c=>p.value=!1),class:"text-gray-400 hover:text-gray-600"},[A(k(Ee),{class:"w-6 h-6"})])]),e("div",ri,[e("div",li,[w(e("input",{"onUpdate:modelValue":g[4]||(g[4]=c=>D.value=c),type:"text",placeholder:"Rechercher un participant...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,D.value]])]),e("div",di,[e("table",ui,[g[19]||(g[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Participant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tickets "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total payé "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date d'achat ")])],-1)),e("tbody",ci,[(i(!0),r(J,null,K(L.value,c=>(i(),r("tr",{key:c.user?.id,class:"hover:bg-gray-50"},[e("td",mi,[e("div",null,[e("div",pi,a(c.user?.first_name)+" "+a(c.user?.last_name),1),e("div",gi,a(c.user?.email),1)])]),e("td",fi,a(c.tickets_count),1),e("td",vi,a(y(c.total_spent))+" FCFA ",1),e("td",xi,a(F(c.tickets?.[0]?.purchased_at||c.tickets?.[0]?.created_at)),1)]))),128))])])])])])])):z("",!0),h.value?(i(),r("div",bi,[e("div",yi,[g[25]||(g[25]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Confirmer le tirage")],-1)),e("div",_i,[e("p",wi,[g[20]||(g[20]=B(" Êtes-vous sûr de vouloir effectuer le tirage pour ",-1)),e("span",hi,a(M.value?.product?.title||M.value?.product?.name),1),g[21]||(g[21]=B(" ? ",-1))]),e("div",$i,[e("p",ki,[B(" • "+a(M.value?.sold_tickets||0)+" tickets vendus",1),g[22]||(g[22]=e("br",null,null,-1)),B(" • "+a(M.value?.participants_list?.length||0)+" participants",1),g[23]||(g[23]=e("br",null,null,-1)),B(" • Revenus: "+a(y((M.value?.sold_tickets||0)*(M.value?.ticket_price||0)))+" FCFA ",1)])]),g[24]||(g[24]=e("p",{class:"text-sm text-red-600"}," ⚠️ Cette action est irréversible. Le gagnant sera choisi aléatoirement. ",-1))]),e("div",Ci,[e("button",{onClick:g[5]||(g[5]=c=>h.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-900"}," Annuler "),e("button",{onClick:u,disabled:S.value,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400"},[S.value?(i(),r("span",Ai,"Tirage en cours...")):(i(),r("span",Si,"Effectuer le tirage"))],8,Ei)])])])):z("",!0)]))}},ji={name:"PhoneInputAdmin",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Numéro de téléphone"},preferredCountries:{type:Array,default:()=>["ga","cm","ci","cg","cf","td","gq","fr"]},initialCountry:{type:String,default:"ga"}},data(){return{phoneNumber:this.modelValue,iti:null}},watch:{phoneNumber(x){this.$emit("update:modelValue",x)},modelValue(x){x!==this.phoneNumber&&(this.phoneNumber=x,this.iti&&this.$refs.phoneInput&&x&&this.iti.setNumber(x))}},mounted(){this.initializeIntlTelInput()},beforeUnmount(){this.iti&&this.iti.destroy()},methods:{initializeIntlTelInput(){const x=this.$refs.phoneInput;this.iti=jt(x,{preferredCountries:this.preferredCountries,initialCountry:this.initialCountry,separateDialCode:!0,customPlaceholder:(E,I)=>E}),x.addEventListener("input",E=>{this.phoneNumber=E.target.value,this.emitAllData()}),x.addEventListener("countrychange",()=>{this.emitAllData()}),setTimeout(()=>{this.modelValue&&this.iti.setNumber(this.modelValue),this.emitAllData()},100)},emitAllData(){if(this.iti&&this.iti.getSelectedCountryData)try{const x=this.iti.getSelectedCountryData(),E=this.phoneNumber||"";let I="";E.trim()&&(E.startsWith("+")?I=E:I=`+${x.dialCode}${E}`);const P=this.validatePhoneNumber(E,x);this.$emit("update:modelValue",I),this.$emit("phone-change",{number:E,fullNumber:I,countryCode:x.dialCode,countryIso2:x.iso2,isValid:P})}catch(x){console.warn("PhoneInputAdmin: Error emitting data",x)}},validatePhoneNumber(x,E){if(!x||!x.trim())return!1;const P={ga:{min:7,max:8},cm:{min:8,max:9},ci:{min:8,max:10},fr:{min:9,max:10},ca:{min:10,max:10},cg:{min:8,max:9},cf:{min:8,max:8},td:{min:8,max:8},gq:{min:9,max:9}}[E.iso2]||{min:7,max:15},f=x.replace(/[^\d]/g,"");return f.length>=P.min&&f.length<=P.max},getNumber(){if(this.iti&&this.iti.getSelectedCountryData){const x=this.iti.getSelectedCountryData(),E=this.phoneNumber||"";if(E.trim())return E.startsWith("+")?E:`+${x.dialCode}${E}`}return""},isValidNumber(){if(this.iti&&this.iti.getSelectedCountryData){const x=this.iti.getSelectedCountryData();return this.validatePhoneNumber(this.phoneNumber,x)}return!1}}},Pi={class:"phone-input-wrapper"},Di=["placeholder"];function Ui(x,E,I,P,f,S){return i(),r("div",Pi,[e("input",{ref:"phoneInput",type:"tel",class:"admin-input",placeholder:I.placeholder},null,8,Di)])}const We=Ke(ji,[["render",Ui],["__scopeId","data-v-2c35b97e"]]),Mi={class:"space-y-6"},Vi={class:"flex justify-between items-center"},Ti={class:"flex space-x-3"},Li={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},Ri={class:"lg:col-span-1"},Fi={class:"admin-card space-y-1"},Ii=["onClick"],Ni={class:"lg:col-span-3"},qi={class:"admin-card"},zi={key:0,class:"p-6"},Bi={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Oi={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Gi={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Xi=["value"],Hi=["value"],Ji={class:"flex justify-end"},Ki=["disabled"],Wi={key:1,class:"p-6"},Yi={class:"admin-card-header mb-6"},Qi={class:"flex justify-between items-center"},Zi={class:"mb-6"},er={class:"w-full md:w-1/2 lg:w-1/3"},tr={class:"overflow-x-auto"},sr={class:"min-w-full divide-y divide-gray-200"},ar={class:"bg-white divide-y divide-gray-200"},or={class:"px-6 py-4 whitespace-nowrap"},nr={class:"flex items-center"},ir=["src","alt"],rr={class:"text-sm font-medium text-gray-900"},lr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},dr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ur={class:"px-6 py-4 whitespace-nowrap"},cr={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},mr={class:"flex space-x-2"},pr=["onClick"],gr=["onClick"],fr=["onClick"],vr={key:2,class:"p-6"},xr={class:"admin-card-header mb-6"},br={class:"flex justify-between items-center"},yr={class:"mb-6"},_r={class:"w-full md:w-1/2 lg:w-1/3"},wr={class:"overflow-x-auto"},hr={class:"min-w-full divide-y divide-gray-200"},$r={class:"bg-white divide-y divide-gray-200"},kr={class:"px-6 py-4 whitespace-nowrap"},Cr={class:"flex items-center"},Er={class:"text-2xl mr-3"},Ar={class:"text-sm font-medium text-gray-900"},Sr={class:"text-sm text-gray-500"},jr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Pr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Dr={class:"px-6 py-4 whitespace-nowrap"},Ur={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Mr={class:"flex space-x-2"},Vr=["onClick"],Tr=["onClick"],Lr=["onClick"],Rr={key:3,class:"p-6"},Fr={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ir={class:"space-y-4"},Nr={class:"space-y-3"},qr={class:"flex items-center"},zr={class:"flex items-center space-x-2"},Br={class:"font-medium text-gray-900"},Or={key:0,class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full"},Gr={key:1,class:"px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full"},Xr={class:"text-sm text-gray-600"},Hr={class:"flex items-center space-x-3"},Jr={class:"relative inline-flex items-center cursor-pointer"},Kr=["onUpdate:modelValue"],Wr=["onClick","disabled"],Yr={class:"flex justify-end"},Qr=["disabled"],Zr={key:4,class:"p-6"},el={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},tl={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},sl={class:"space-y-4"},al={class:"space-y-3"},ol={class:"flex items-center justify-between"},nl={class:"relative inline-flex items-center cursor-pointer"},il={class:"flex items-center justify-between"},rl={class:"relative inline-flex items-center cursor-pointer"},ll={class:"flex justify-end"},dl=["disabled"],ul={key:5,class:"p-6"},cl={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ml={class:"space-y-4"},pl={class:"space-y-3"},gl={class:"font-medium text-gray-900"},fl={class:"text-sm text-gray-600"},vl={class:"relative inline-flex items-center cursor-pointer"},xl=["onUpdate:modelValue"],bl={class:"flex justify-end"},yl=["disabled"],_l={key:6,class:"p-6"},wl={class:"space-y-6"},hl={class:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg"},$l={class:"flex items-center justify-between"},kl={class:"relative inline-flex items-center cursor-pointer"},Cl={key:0,class:"mt-4"},El={class:"space-y-4"},Al={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Sl=["disabled"],jl=["disabled"],Pl=["disabled"],Dl=["disabled"],Ul={class:"flex justify-end"},Ml=["disabled"],Vl={key:0,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},Tl={class:"bg-white rounded-lg max-w-md w-full mx-4"},Ll={class:"px-6 py-4 border-b border-gray-200"},Rl={class:"text-lg font-semibold text-gray-900"},Fl={class:"px-6 py-4 space-y-4"},Il={class:"flex items-center"},Nl={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},ql=["disabled"],zl={key:0},Bl={key:1},Ol={key:1,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},Gl={class:"bg-white rounded-lg max-w-md w-full mx-4"},Xl={class:"px-6 py-4 border-b border-gray-200"},Hl={class:"text-lg font-semibold text-gray-900"},Jl={class:"px-6 py-4 space-y-4"},Kl={class:"flex items-center"},Wl={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},Yl=["disabled"],Ql={key:0},Zl={key:1},ed={key:2,class:"fixed inset-0 bg-black/20 flex items-center justify-center z-50"},td={class:"bg-white rounded-lg max-w-2xl w-full mx-4"},sd={class:"px-6 py-4 border-b border-gray-200"},ad={class:"text-lg font-semibold text-gray-900"},od={class:"px-6 py-4 space-y-6"},nd={key:0},id={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},rd={key:1},ld={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},dd={key:2},ud={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},cd={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},md=["disabled"],pd={key:0},gd={key:1},Sp={__name:"Settings",setup(x){const{get:E,post:I,put:P}=pe(),f=$(!1),S=$("general"),p=[{id:"general",name:"Général",icon:fe},{id:"countries",name:"Pays",icon:vt},{id:"languages",name:"Langues",icon:xt},{id:"payment",name:"Paiements",icon:_e},{id:"lottery",name:"Tombolas",icon:Ne},{id:"notifications",name:"Notifications",icon:bt},{id:"maintenance",name:"Maintenance",icon:yt}],h=se({app_name:"",app_url:"",app_description:"",contact_email:"",contact_phone:"",default_language:"fr",default_country:"GA"}),M=se({default_currency:"XAF",platform_commission:0}),D=$([{id:"ebilling",name:"eBilling",description:"Passerelle eBilling (Airtel Money, Moov Money)",icon:$e,active:!0,type:"gateway",config:{merchant_id:"",api_key:"",secret_key:"",environment:"sandbox"}},{id:"airtel_money",name:"Airtel Money",description:"Paiement mobile via Airtel Money (eBilling)",icon:$e,active:!0,type:"mobile_money",gateway:"ebilling"},{id:"moov_money",name:"Moov Money",description:"Paiement mobile via Moov Money (eBilling)",icon:$e,active:!0,type:"mobile_money",gateway:"ebilling"},{id:"flutterwave",name:"Flutterwave",description:"Passerelle Flutterwave (Cards, Mobile Money, Bank Transfer)",icon:Ve,active:!1,type:"gateway",config:{public_key:"",secret_key:"",environment:"sandbox"}},{id:"paystack",name:"Paystack",description:"Passerelle Paystack (Cards, USSD, Bank Transfer)",icon:Ve,active:!1,type:"gateway",config:{public_key:"",secret_key:"",environment:"sandbox"}},{id:"bank_transfer",name:"Virement bancaire",description:"Paiement par virement bancaire local",icon:ke,active:!1,type:"bank_transfer"}]),V=se({min_ticket_price:0,max_ticket_price:0,min_participants:0,max_duration_days:0,auto_refund:!1,auto_draw:!1}),U=se({from_email:"",from_name:""}),O=$([]),G=se({maintenance_mode:!1,maintenance_message:""}),N=$([]),H=$([]),q=$(!1),Q=$(!1),X=$(!1),Z=$(!1),T=$(!1),v=$(null),m=$(null),b=$(null),L=se({name:"",code:"",currency:"",flag:"",is_active:!0}),F=se({name:"",native_name:"",code:"",flag:"",direction:"ltr",is_active:!0}),y=se({search:""}),d=se({search:""}),j=W(()=>N.value.filter(l=>l.is_active)),_=W(()=>H.value.filter(l=>l.is_active)),o=(l,t,n)=>{l.response?.status===404?(console.info(`API ${t} pas encore implémentée, simulation du succès`),window.$toast&&window.$toast.info(`${n} (API en développement)`,"ℹ️ Développement")):window.$toast&&window.$toast.error(`Erreur lors de ${t.toLowerCase()}`,"✗ Erreur")},s=async()=>{f.value=!0;try{const l=await E("/admin/settings");l&&l.success&&l.data&&(Object.assign(h,l.data.general||{}),Object.assign(M,l.data.payment||{}),Object.assign(V,l.data.lottery||{}),Object.assign(U,l.data.notifications||{}),Object.assign(G,l.data.maintenance||{}),l.data.payment_methods&&D.value.forEach(t=>{const n=l.data.payment_methods.find(ae=>ae.id===t.id);n&&(t.active=n.active)}),l.data.countries&&(N.value=l.data.countries),l.data.languages&&(H.value=l.data.languages),l.data.notification_types&&(O.value=l.data.notification_types))}catch(l){console.error("Error loading settings:",l),l.response?.status!==404?window.$toast&&window.$toast.error("Erreur lors du chargement des paramètres","✗ Erreur"):(console.info("API /admin/settings pas encore implémentée, chargement des données par défaut"),Object.assign(h,{app_name:"Koumbaya",app_url:"https://koumbaya.com",app_description:"Plateforme de tombolas en ligne",contact_email:"contact@koumbaya.com",contact_phone:"+241 XX XX XX XX",default_language:"fr",default_country:"GA"}),Object.assign(M,{default_currency:"XAF",platform_commission:5}),Object.assign(V,{min_ticket_price:1e3,max_ticket_price:1e5,min_participants:10,max_duration_days:30,auto_refund:!0,auto_draw:!1}),Object.assign(U,{from_email:"noreply@koumbaya.com",from_name:"Koumbaya"}),Object.assign(G,{maintenance_mode:!1,maintenance_message:"La plateforme est temporairement en maintenance. Nous reviendrons bientôt !"}),N.value=[{id:1,name:"Gabon",code:"GA",currency:"XAF",flag:"https://flagcdn.com/w40/ga.png",is_active:!0},{id:2,name:"France",code:"FR",currency:"EUR",flag:"https://flagcdn.com/w40/fr.png",is_active:!0}],H.value=[{id:1,name:"Français",native_name:"Français",code:"fr",flag:"🇫🇷",direction:"ltr",is_active:!0},{id:2,name:"English",native_name:"English",code:"en",flag:"🇺🇸",direction:"ltr",is_active:!0}],O.value=[{id:"new_user",name:"Nouvel utilisateur",description:"Email de bienvenue aux nouveaux utilisateurs",enabled:!0},{id:"lottery_winner",name:"Gagnant tombola",description:"Notification au gagnant d'une tombola",enabled:!0}])}finally{f.value=!1}},u=async()=>{f.value=!0;try{const l=await P("/admin/settings/general",h);l&&l.success&&window.$toast&&window.$toast.success("Paramètres généraux sauvegardés","✅ Succès")}catch(l){console.error("Error updating general settings:",l),o(l,"/admin/settings/general","Paramètres généraux sauvegardés")}finally{f.value=!1}},ie=async()=>{f.value=!0;try{const l=await P("/admin/settings/payment",{...M,payment_methods:D.value});l&&l.success&&window.$toast&&window.$toast.success("Paramètres de paiement sauvegardés","✅ Succès")}catch(l){console.error("Error updating payment settings:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde","✗ Erreur")}finally{f.value=!1}},de=async()=>{f.value=!0;try{const l=await P("/admin/settings/lottery",V);l&&l.success&&window.$toast&&window.$toast.success("Paramètres des tombolas sauvegardés","✅ Succès")}catch(l){console.error("Error updating lottery settings:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde","✗ Erreur")}finally{f.value=!1}},Se=async()=>{f.value=!0;try{const l=await P("/admin/settings/notifications",{...U,notification_types:O.value});l&&l.success&&window.$toast&&window.$toast.success("Paramètres de notifications sauvegardés","✅ Succès")}catch(l){console.error("Error updating notification settings:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde","✗ Erreur")}finally{f.value=!1}},je=async()=>{f.value=!0;try{const l=await P("/admin/settings/maintenance",G);l&&l.success&&window.$toast&&window.$toast.success("Paramètres de maintenance sauvegardés","✅ Succès")}catch(l){console.error("Error updating maintenance settings:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde","✗ Erreur")}finally{f.value=!1}},C=async()=>{await s(),window.$toast&&window.$toast.info("Paramètres rechargés","ℹ️ Information")},g=async()=>{f.value=!0;try{const l=await I("/admin/settings/backup");l&&l.success&&window.$toast&&window.$toast.success("Sauvegarde créée avec succès","✅ Sauvegarde")}catch(l){console.error("Error creating backup:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde","✗ Erreur")}finally{f.value=!1}},c=l=>{l.type==="gateway"&&l.config?(b.value=l,T.value=!0):window.$toast&&window.$toast.info(`Configuration non disponible pour ${l.name}`,"ℹ️ Information")},te=async()=>{if(confirm("Vider le cache de l'application ?")){f.value=!0;try{const l=await I("/admin/settings/cache/clear");l&&l.success&&window.$toast&&window.$toast.success("Cache vidé avec succès","✅ Maintenance")}catch(l){console.error("Error clearing cache:",l),window.$toast&&window.$toast.error("Erreur lors du vidage du cache","✗ Erreur")}finally{f.value=!1}}},oe=async()=>{if(confirm("Optimiser la base de données ? Cette opération peut prendre du temps.")){f.value=!0;try{const l=await I("/admin/settings/database/optimize");l&&l.success&&window.$toast&&window.$toast.success("Base de données optimisée","✅ Maintenance")}catch(l){console.error("Error optimizing database:",l),window.$toast&&window.$toast.error("Erreur lors de l'optimisation","✗ Erreur")}finally{f.value=!1}}},ge=async()=>{f.value=!0;try{const l=await I("/admin/settings/sitemap/generate");l&&l.success&&window.$toast&&window.$toast.success("Sitemap généré avec succès","✅ Maintenance")}catch(l){console.error("Error generating sitemap:",l),window.$toast&&window.$toast.error("Erreur lors de la génération du sitemap","✗ Erreur")}finally{f.value=!1}},Ye=async()=>{f.value=!0;try{const l=await I("/admin/settings/email/test");l&&l.success&&window.$toast&&window.$toast.success("Email de test envoyé","✅ Test")}catch(l){console.error("Error testing email:",l),window.$toast&&window.$toast.error("Erreur lors du test email","✗ Erreur")}finally{f.value=!1}},Qe=W(()=>{let l=N.value;if(y.search){const t=y.search.toLowerCase();l=l.filter(n=>n.name?.toLowerCase().includes(t)||n.iso_code_2?.toLowerCase().includes(t)||n.iso_code_3?.toLowerCase().includes(t))}return l}),Ze=W(()=>{let l=H.value;if(d.search){const t=d.search.toLowerCase();l=l.filter(n=>n.name.toLowerCase().includes(t)||n.native_name.toLowerCase().includes(t)||n.code.toLowerCase().includes(t))}return l}),et=l=>{v.value=l,Object.assign(L,{name:l.name,code:l.iso_code_2,currency:l.currency_code,flag:l.flag,is_active:l.is_active}),Q.value=!0},tt=async()=>{f.value=!0;try{const l=await I("/admin/countries",L);if(l&&l.success){const t={id:Date.now(),...L};N.value.unshift(t),Pe(),window.$toast&&window.$toast.success("Pays créé avec succès","✅ Création")}}catch(l){console.error("Error creating country:",l),window.$toast&&window.$toast.error("Erreur lors de la création du pays","✗ Erreur")}finally{f.value=!1}},st=async()=>{f.value=!0;try{const l=await P(`/admin/countries/${v.value.id}`,L);if(l&&l.success){const t=N.value.findIndex(n=>n.id===v.value.id);t!==-1&&(N.value[t]={...N.value[t],...L}),Pe(),window.$toast&&window.$toast.success("Pays modifié avec succès","✅ Modification")}}catch(l){console.error("Error updating country:",l),window.$toast&&window.$toast.error("Erreur lors de la modification du pays","✗ Erreur")}finally{f.value=!1}},at=async l=>{try{const t=await P(`/admin/countries/${l.id}/toggle-status`);t&&t.success&&(l.is_active=!l.is_active,window.$toast&&window.$toast.success(`Pays ${l.is_active?"activé":"désactivé"}`,"✅ Statut"))}catch(t){console.error("Error toggling country status:",t),window.$toast&&window.$toast.error("Erreur lors du changement de statut","✗ Erreur")}},ot=async l=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce pays ?"))try{const t=await I(`/admin/countries/${l}/delete`);t&&t.success&&(N.value=N.value.filter(n=>n.id!==l),window.$toast&&window.$toast.success("Pays supprimé avec succès","✅ Suppression"))}catch(t){console.error("Error deleting country:",t),window.$toast&&window.$toast.error("Erreur lors de la suppression du pays","✗ Erreur")}},Pe=()=>{q.value=!1,Q.value=!1,v.value=null,Object.assign(L,{name:"",code:"",currency:"",flag:"",is_active:!0})},nt=l=>{m.value=l,Object.assign(F,{name:l.name,native_name:l.native_name,code:l.code,flag:l.flag,direction:l.direction,is_active:l.is_active}),Z.value=!0},it=async()=>{f.value=!0;try{const l=await I("/admin/languages",F);if(l&&l.success){const t={id:Date.now(),...F};H.value.unshift(t),De(),window.$toast&&window.$toast.success("Langue créée avec succès","✅ Création")}}catch(l){console.error("Error creating language:",l),window.$toast&&window.$toast.error("Erreur lors de la création de la langue","✗ Erreur")}finally{f.value=!1}},rt=async()=>{f.value=!0;try{const l=await P(`/admin/languages/${m.value.id}`,F);if(l&&l.success){const t=H.value.findIndex(n=>n.id===m.value.id);t!==-1&&(H.value[t]={...H.value[t],...F}),De(),window.$toast&&window.$toast.success("Langue modifiée avec succès","✅ Modification")}}catch(l){console.error("Error updating language:",l),window.$toast&&window.$toast.error("Erreur lors de la modification de la langue","✗ Erreur")}finally{f.value=!1}},lt=async l=>{try{const t=await P(`/admin/languages/${l.id}/toggle-status`);t&&t.success&&(l.is_active=!l.is_active,window.$toast&&window.$toast.success(`Langue ${l.is_active?"activée":"désactivée"}`,"✅ Statut"))}catch(t){console.error("Error toggling language status:",t),window.$toast&&window.$toast.error("Erreur lors du changement de statut","✗ Erreur")}},dt=async l=>{if(confirm("Êtes-vous sûr de vouloir supprimer cette langue ?"))try{const t=await I(`/admin/languages/${l}/delete`);t&&t.success&&(H.value=H.value.filter(n=>n.id!==l),window.$toast&&window.$toast.success("Langue supprimée avec succès","✅ Suppression"))}catch(t){console.error("Error deleting language:",t),window.$toast&&window.$toast.error("Erreur lors de la suppression de la langue","✗ Erreur")}},De=()=>{X.value=!1,Z.value=!1,m.value=null,Object.assign(F,{name:"",native_name:"",code:"",flag:"",direction:"ltr",is_active:!0})},ut=async()=>{f.value=!0;try{const l=await P(`/admin/settings/payment-methods/${b.value.id}`,{config:b.value.config,active:b.value.active});l&&l.success&&(window.$toast&&window.$toast.success(`Configuration ${b.value.name} sauvegardée`,"✅ Configuration"),Fe())}catch(l){console.error("Error updating payment method config:",l),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde de la configuration","✗ Erreur")}finally{f.value=!1}},Fe=()=>{T.value=!1,b.value=null};return me(()=>{s()}),(l,t)=>(i(),r("div",Mi,[e("div",Vi,[t[48]||(t[48]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Paramètres système"),e("p",{class:"mt-2 text-gray-600"},"Configuration et paramètres généraux de la plateforme")],-1)),e("div",Ti,[e("button",{onClick:C,class:"admin-btn-secondary"},[A(k(ve),{class:"w-4 h-4 mr-2"}),t[46]||(t[46]=B(" Actualiser ",-1))]),e("button",{onClick:g,class:"admin-btn-accent"},[A(k(Re),{class:"w-4 h-4 mr-2"}),t[47]||(t[47]=B(" Sauvegarder ",-1))])])]),e("div",Li,[e("div",Ri,[e("nav",Fi,[(i(),r(J,null,K(p,n=>e("button",{key:n.id,onClick:ae=>S.value=n.id,class:Y(["w-full text-left px-4 py-3 rounded-lg text-sm font-medium transition-colors flex items-center",S.value===n.id?"bg-[#0099cc]/10 text-[#0099cc] border border-[#0099cc]/20":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"])},[(i(),ue(ce(n.icon),{class:"w-5 h-5 mr-3"})),B(" "+a(n.name),1)],10,Ii)),64))])]),e("div",Ni,[e("div",qi,[S.value==="general"?(i(),r("div",zi,[t[56]||(t[56]=e("div",{class:"admin-card-header mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Paramètres généraux")],-1)),e("form",{onSubmit:le(u,["prevent"]),class:"space-y-6"},[e("div",Bi,[e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom de la plateforme",-1)),w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>h.app_name=n),type:"text",class:"admin-input",placeholder:"Koumbaya"},null,512),[[R,h.app_name]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"URL de base",-1)),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>h.app_url=n),type:"url",class:"admin-input",placeholder:"https://koumbaya.com"},null,512),[[R,h.app_url]])])]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description de la plateforme",-1)),w(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>h.app_description=n),rows:"3",class:"admin-input",placeholder:"Description de votre plateforme..."},null,512),[[R,h.app_description]])]),e("div",Oi,[e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email de contact",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>h.contact_email=n),type:"email",class:"admin-input",placeholder:"contact@koumbaya.com"},null,512),[[R,h.contact_email]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Téléphone de contact",-1)),A(We,{modelValue:h.contact_phone,"onUpdate:modelValue":t[4]||(t[4]=n=>h.contact_phone=n),placeholder:"Téléphone de contact","initial-country":"ga"},null,8,["modelValue"])])]),e("div",Gi,[e("div",null,[t[54]||(t[54]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Langue par défaut",-1)),w(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>h.default_language=n),class:"admin-input"},[(i(!0),r(J,null,K(_.value,n=>(i(),r("option",{key:n.id,value:n.code},a(n.name),9,Xi))),128))],512),[[ee,h.default_language]])]),e("div",null,[t[55]||(t[55]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pays par défaut",-1)),w(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>h.default_country=n),class:"admin-input"},[(i(!0),r(J,null,K(j.value,n=>(i(),r("option",{key:n.id,value:n.iso_code_2},a(n.name),9,Hi))),128))],512),[[ee,h.default_country]])])]),e("div",Ji,[e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},a(f.value?"Sauvegarde...":"Sauvegarder"),9,Ki)])],32)])):z("",!0),S.value==="countries"?(i(),r("div",Wi,[e("div",Yi,[e("div",Qi,[t[58]||(t[58]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Gestion des pays"),e("p",{class:"text-sm text-gray-600"},"Configurez les pays disponibles sur la plateforme")],-1)),e("button",{onClick:t[7]||(t[7]=n=>q.value=!0),class:"admin-btn-primary flex items-center"},[A(k(Ie),{class:"w-4 h-4 mr-2"}),t[57]||(t[57]=B(" Ajouter un pays ",-1))])])]),e("div",Zi,[e("div",er,[w(e("input",{"onUpdate:modelValue":t[8]||(t[8]=n=>y.search=n),type:"text",placeholder:"Rechercher un pays...",class:"admin-input"},null,512),[[R,y.search]])])]),e("div",tr,[e("table",sr,[t[59]||(t[59]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Pays "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Code "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Devise "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ar,[(i(!0),r(J,null,K(Qe.value,n=>(i(),r("tr",{key:n.id,class:"hover:bg-gray-50"},[e("td",or,[e("div",nr,[n.flag?(i(),r("img",{key:0,src:n.flag,alt:n.name,class:"w-6 h-4 rounded object-cover mr-3"},null,8,ir)):z("",!0),e("div",rr,a(n.name),1)])]),e("td",lr,a(n.iso_code_2),1),e("td",dr,a(n.currency_code),1),e("td",ur,[e("span",{class:Y(["px-2 py-1 text-xs font-medium rounded-full",n.is_active?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},a(n.is_active?"Actif":"Inactif"),3)]),e("td",cr,[e("div",mr,[e("button",{onClick:ae=>et(n),class:"text-blue-600 hover:text-blue-900"},[A(k(Ce),{class:"w-4 h-4"})],8,pr),e("button",{onClick:ae=>at(n),class:"text-blue-600 hover:text-blue-900 text-xs"},a(n.is_active?"Désactiver":"Activer"),9,gr),e("button",{onClick:ae=>ot(n.id),class:"text-red-600 hover:text-red-900"},[A(k(he),{class:"w-4 h-4"})],8,fr)])])]))),128))])])])])):z("",!0),S.value==="languages"?(i(),r("div",vr,[e("div",xr,[e("div",br,[t[61]||(t[61]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Gestion des langues"),e("p",{class:"text-sm text-gray-600"},"Configurez les langues disponibles sur la plateforme")],-1)),e("button",{onClick:t[9]||(t[9]=n=>X.value=!0),class:"admin-btn-primary flex items-center"},[A(k(Ie),{class:"w-4 h-4 mr-2"}),t[60]||(t[60]=B(" Ajouter une langue ",-1))])])]),e("div",yr,[e("div",_r,[w(e("input",{"onUpdate:modelValue":t[10]||(t[10]=n=>d.search=n),type:"text",placeholder:"Rechercher une langue...",class:"admin-input"},null,512),[[R,d.search]])])]),e("div",wr,[e("table",hr,[t[62]||(t[62]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Langue "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Code "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Direction "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",$r,[(i(!0),r(J,null,K(Ze.value,n=>(i(),r("tr",{key:n.id,class:"hover:bg-gray-50"},[e("td",kr,[e("div",Cr,[e("span",Er,a(n.flag),1),e("div",null,[e("div",Ar,a(n.name),1),e("div",Sr,a(n.native_name),1)])])]),e("td",jr,a(n.code),1),e("td",Pr,a(n.direction==="rtl"?"Droite à gauche":"Gauche à droite"),1),e("td",Dr,[e("span",{class:Y(["px-2 py-1 text-xs font-medium rounded-full",n.is_active?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},a(n.is_active?"Actif":"Inactif"),3)]),e("td",Ur,[e("div",Mr,[e("button",{onClick:ae=>nt(n),class:"text-blue-600 hover:text-blue-900"},[A(k(Ce),{class:"w-4 h-4"})],8,Vr),e("button",{onClick:ae=>lt(n),class:"text-blue-600 hover:text-blue-900 text-xs"},a(n.is_active?"Désactiver":"Activer"),9,Tr),e("button",{onClick:ae=>dt(n.id),class:"text-red-600 hover:text-red-900"},[A(k(he),{class:"w-4 h-4"})],8,Lr)])])]))),128))])])])])):z("",!0),S.value==="payment"?(i(),r("div",Rr,[t[68]||(t[68]=e("div",{class:"admin-card-header mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Paramètres de paiement")],-1)),e("form",{onSubmit:le(ie,["prevent"]),class:"space-y-6"},[e("div",Fr,[e("div",null,[t[64]||(t[64]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Devise par défaut",-1)),w(e("select",{"onUpdate:modelValue":t[11]||(t[11]=n=>M.default_currency=n),class:"admin-input"},t[63]||(t[63]=[e("option",{value:"XAF"},"Franc CFA Afrique Centrale (XAF)",-1),e("option",{value:"XOF"},"Franc CFA Afrique de l'Ouest (XOF)",-1),e("option",{value:"EUR"},"Euro (EUR)",-1),e("option",{value:"USD"},"Dollar US (USD)",-1)]),512),[[ee,M.default_currency]])]),e("div",null,[t[65]||(t[65]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Commission plateforme (%)",-1)),w(e("input",{"onUpdate:modelValue":t[12]||(t[12]=n=>M.platform_commission=n),type:"number",min:"0",max:"100",step:"0.1",class:"admin-input",placeholder:"5.0"},null,512),[[R,M.platform_commission,void 0,{number:!0}]])])]),e("div",Ir,[t[67]||(t[67]=e("h4",{class:"font-medium text-gray-900"},"Méthodes de paiement actives",-1)),e("div",Nr,[(i(!0),r(J,null,K(D.value,n=>(i(),r("div",{key:n.id,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"},[e("div",qr,[(i(),ue(ce(n.icon),{class:Y(["w-6 h-6 mr-3",{"text-green-500":n.active,"text-gray-400":!n.active}])},null,8,["class"])),e("div",null,[e("div",zr,[e("p",Br,a(n.name),1),n.type==="gateway"?(i(),r("span",Or," Passerelle ")):n.gateway?(i(),r("span",Gr," via "+a(n.gateway),1)):z("",!0)]),e("p",Xr,a(n.description),1)])]),e("div",Hr,[e("label",Jr,[w(e("input",{"onUpdate:modelValue":ae=>n.active=ae,type:"checkbox",class:"sr-only peer"},null,8,Kr),[[re,n.active]]),t[66]||(t[66]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))]),e("button",{onClick:ae=>c(n),class:Y([{"text-[#0099cc] hover:text-[#0088bb]":n.type==="gateway"||n.config,"text-gray-300 cursor-not-allowed":n.type!=="gateway"&&!n.config},"text-sm transition-colors"]),disabled:n.type!=="gateway"&&!n.config},[A(k(fe),{class:"w-4 h-4"})],10,Wr)])]))),128))])]),e("div",Yr,[e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},a(f.value?"Sauvegarde...":"Sauvegarder"),9,Qr)])],32)])):z("",!0),S.value==="lottery"?(i(),r("div",Zr,[t[78]||(t[78]=e("div",{class:"admin-card-header mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Paramètres des tombolas")],-1)),e("form",{onSubmit:le(de,["prevent"]),class:"space-y-6"},[e("div",el,[e("div",null,[t[69]||(t[69]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prix minimum ticket (FCFA)",-1)),w(e("input",{"onUpdate:modelValue":t[13]||(t[13]=n=>V.min_ticket_price=n),type:"number",min:"100",class:"admin-input",placeholder:"1000"},null,512),[[R,V.min_ticket_price,void 0,{number:!0}]])]),e("div",null,[t[70]||(t[70]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prix maximum ticket (FCFA)",-1)),w(e("input",{"onUpdate:modelValue":t[14]||(t[14]=n=>V.max_ticket_price=n),type:"number",min:"1000",class:"admin-input",placeholder:"100000"},null,512),[[R,V.max_ticket_price,void 0,{number:!0}]])])]),e("div",tl,[e("div",null,[t[71]||(t[71]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Participants minimum par tombola",-1)),w(e("input",{"onUpdate:modelValue":t[15]||(t[15]=n=>V.min_participants=n),type:"number",min:"2",class:"admin-input",placeholder:"10"},null,512),[[R,V.min_participants,void 0,{number:!0}]])]),e("div",null,[t[72]||(t[72]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Durée maximum (jours)",-1)),w(e("input",{"onUpdate:modelValue":t[16]||(t[16]=n=>V.max_duration_days=n),type:"number",min:"1",class:"admin-input",placeholder:"30"},null,512),[[R,V.max_duration_days,void 0,{number:!0}]])])]),e("div",sl,[t[77]||(t[77]=e("h4",{class:"font-medium text-gray-900"},"Options automatiques",-1)),e("div",al,[e("div",ol,[t[74]||(t[74]=e("div",null,[e("h5",{class:"font-medium text-gray-900"},"Remboursement automatique"),e("p",{class:"text-sm text-gray-600"},"Rembourser automatiquement si pas assez de participants")],-1)),e("label",nl,[w(e("input",{"onUpdate:modelValue":t[17]||(t[17]=n=>V.auto_refund=n),type:"checkbox",class:"sr-only peer"},null,512),[[re,V.auto_refund]]),t[73]||(t[73]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))])]),e("div",il,[t[76]||(t[76]=e("div",null,[e("h5",{class:"font-medium text-gray-900"},"Tirage automatique"),e("p",{class:"text-sm text-gray-600"},"Effectuer le tirage automatiquement à la date de fin")],-1)),e("label",rl,[w(e("input",{"onUpdate:modelValue":t[18]||(t[18]=n=>V.auto_draw=n),type:"checkbox",class:"sr-only peer"},null,512),[[re,V.auto_draw]]),t[75]||(t[75]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))])])])]),e("div",ll,[e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},a(f.value?"Sauvegarde...":"Sauvegarder"),9,dl)])],32)])):z("",!0),S.value==="notifications"?(i(),r("div",ul,[t[83]||(t[83]=e("div",{class:"admin-card-header mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Paramètres de notifications")],-1)),e("form",{onSubmit:le(Se,["prevent"]),class:"space-y-6"},[e("div",cl,[e("div",null,[t[79]||(t[79]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email expéditeur",-1)),w(e("input",{"onUpdate:modelValue":t[19]||(t[19]=n=>U.from_email=n),type:"email",class:"admin-input",placeholder:"noreply@koumbaya.com"},null,512),[[R,U.from_email]])]),e("div",null,[t[80]||(t[80]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom expéditeur",-1)),w(e("input",{"onUpdate:modelValue":t[20]||(t[20]=n=>U.from_name=n),type:"text",class:"admin-input",placeholder:"Koumbaya"},null,512),[[R,U.from_name]])])]),e("div",ml,[t[82]||(t[82]=e("h4",{class:"font-medium text-gray-900"},"Types de notifications automatiques",-1)),e("div",pl,[(i(!0),r(J,null,K(O.value,n=>(i(),r("div",{key:n.id,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg"},[e("div",null,[e("p",gl,a(n.name),1),e("p",fl,a(n.description),1)]),e("label",vl,[w(e("input",{"onUpdate:modelValue":ae=>n.enabled=ae,type:"checkbox",class:"sr-only peer"},null,8,xl),[[re,n.enabled]]),t[81]||(t[81]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))])]))),128))])]),e("div",bl,[e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},a(f.value?"Sauvegarde...":"Sauvegarder"),9,yl)])],32)])):z("",!0),S.value==="maintenance"?(i(),r("div",_l,[t[92]||(t[92]=e("div",{class:"admin-card-header mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Maintenance et sécurité")],-1)),e("div",wl,[e("div",hl,[e("div",$l,[t[85]||(t[85]=e("div",null,[e("h4",{class:"font-medium text-yellow-800"},"Mode maintenance"),e("p",{class:"text-sm text-yellow-700"},"Désactiver temporairement l'accès public à la plateforme")],-1)),e("label",kl,[w(e("input",{"onUpdate:modelValue":t[21]||(t[21]=n=>G.maintenance_mode=n),type:"checkbox",class:"sr-only peer"},null,512),[[re,G.maintenance_mode]]),t[84]||(t[84]=e("div",{class:"w-11 h-6 bg-yellow-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-yellow-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-600"},null,-1))])]),G.maintenance_mode?(i(),r("div",Cl,[t[86]||(t[86]=e("label",{class:"block text-sm font-medium text-yellow-800 mb-2"},"Message de maintenance",-1)),w(e("textarea",{"onUpdate:modelValue":t[22]||(t[22]=n=>G.maintenance_message=n),rows:"2",class:"w-full border border-yellow-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-yellow-50",placeholder:"La plateforme est temporairement en maintenance..."},null,512),[[R,G.maintenance_message]])])):z("",!0)]),e("div",El,[t[91]||(t[91]=e("h4",{class:"font-medium text-gray-900"},"Actions de maintenance",-1)),e("div",Al,[e("button",{onClick:te,disabled:f.value,class:"admin-btn-secondary justify-center disabled:opacity-50"},[A(k(he),{class:"w-4 h-4 mr-2"}),t[87]||(t[87]=B(" Vider le cache ",-1))],8,Sl),e("button",{onClick:oe,disabled:f.value,class:"admin-btn-secondary justify-center disabled:opacity-50"},[A(k(fe),{class:"w-4 h-4 mr-2"}),t[88]||(t[88]=B(" Optimiser la BDD ",-1))],8,jl),e("button",{onClick:ge,disabled:f.value,class:"admin-btn-secondary justify-center disabled:opacity-50"},[A(k(gt),{class:"w-4 h-4 mr-2"}),t[89]||(t[89]=B(" Générer sitemap ",-1))],8,Pl),e("button",{onClick:Ye,disabled:f.value,class:"admin-btn-secondary justify-center disabled:opacity-50"},[A(k(ft),{class:"w-4 h-4 mr-2"}),t[90]||(t[90]=B(" Tester les emails ",-1))],8,Dl)])]),e("div",Ul,[e("button",{onClick:je,disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},a(f.value?"Sauvegarde...":"Sauvegarder"),9,Ml)])])])):z("",!0)])])]),q.value||Q.value?(i(),r("div",Vl,[e("div",Tl,[e("div",Ll,[e("h3",Rl,a(q.value?"Ajouter un pays":"Modifier le pays"),1)]),e("form",{onSubmit:t[28]||(t[28]=le(n=>q.value?tt():st(),["prevent"]))},[e("div",Fl,[e("div",null,[t[93]||(t[93]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom *",-1)),w(e("input",{"onUpdate:modelValue":t[23]||(t[23]=n=>L.name=n),type:"text",required:"",class:"admin-input"},null,512),[[R,L.name]])]),e("div",null,[t[94]||(t[94]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Code *",-1)),w(e("input",{"onUpdate:modelValue":t[24]||(t[24]=n=>L.code=n),type:"text",required:"",maxlength:"2",class:"admin-input"},null,512),[[R,L.code]])]),e("div",null,[t[95]||(t[95]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Devise",-1)),w(e("input",{"onUpdate:modelValue":t[25]||(t[25]=n=>L.currency=n),type:"text",class:"admin-input"},null,512),[[R,L.currency]])]),e("div",null,[t[96]||(t[96]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"URL du drapeau",-1)),w(e("input",{"onUpdate:modelValue":t[26]||(t[26]=n=>L.flag=n),type:"url",class:"admin-input"},null,512),[[R,L.flag]])]),e("div",Il,[w(e("input",{"onUpdate:modelValue":t[27]||(t[27]=n=>L.is_active=n),type:"checkbox",class:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[re,L.is_active]]),t[97]||(t[97]=e("label",{class:"ml-2 text-sm text-gray-700"},"Actif",-1))])]),e("div",Nl,[e("button",{type:"button",onClick:Pe,class:"admin-btn-secondary"}," Annuler "),e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},[f.value?(i(),r("span",zl,"Enregistrement...")):(i(),r("span",Bl,a(q.value?"Créer":"Modifier"),1))],8,ql)])],32)])])):z("",!0),X.value||Z.value?(i(),r("div",Ol,[e("div",Gl,[e("div",Xl,[e("h3",Hl,a(X.value?"Ajouter une langue":"Modifier la langue"),1)]),e("form",{onSubmit:t[35]||(t[35]=le(n=>X.value?it():rt(),["prevent"]))},[e("div",Jl,[e("div",null,[t[98]||(t[98]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom *",-1)),w(e("input",{"onUpdate:modelValue":t[29]||(t[29]=n=>F.name=n),type:"text",required:"",class:"admin-input"},null,512),[[R,F.name]])]),e("div",null,[t[99]||(t[99]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom natif",-1)),w(e("input",{"onUpdate:modelValue":t[30]||(t[30]=n=>F.native_name=n),type:"text",class:"admin-input"},null,512),[[R,F.native_name]])]),e("div",null,[t[100]||(t[100]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Code *",-1)),w(e("input",{"onUpdate:modelValue":t[31]||(t[31]=n=>F.code=n),type:"text",required:"",maxlength:"2",class:"admin-input"},null,512),[[R,F.code]])]),e("div",null,[t[101]||(t[101]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Drapeau (emoji)",-1)),w(e("input",{"onUpdate:modelValue":t[32]||(t[32]=n=>F.flag=n),type:"text",maxlength:"2",class:"admin-input"},null,512),[[R,F.flag]])]),e("div",null,[t[103]||(t[103]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Direction",-1)),w(e("select",{"onUpdate:modelValue":t[33]||(t[33]=n=>F.direction=n),class:"admin-input"},t[102]||(t[102]=[e("option",{value:"ltr"},"Gauche à droite",-1),e("option",{value:"rtl"},"Droite à gauche",-1)]),512),[[ee,F.direction]])]),e("div",Kl,[w(e("input",{"onUpdate:modelValue":t[34]||(t[34]=n=>F.is_active=n),type:"checkbox",class:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[re,F.is_active]]),t[104]||(t[104]=e("label",{class:"ml-2 text-sm text-gray-700"},"Actif",-1))])]),e("div",Wl,[e("button",{type:"button",onClick:De,class:"admin-btn-secondary"}," Annuler "),e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},[f.value?(i(),r("span",Ql,"Enregistrement...")):(i(),r("span",Zl,a(X.value?"Créer":"Modifier"),1))],8,Yl)])],32)])])):z("",!0),T.value?(i(),r("div",ed,[e("div",td,[e("div",sd,[e("h3",ad," Configuration "+a(b.value?.name),1)]),e("form",{onSubmit:le(ut,["prevent"])},[e("div",od,[b.value?.id==="ebilling"?(i(),r("div",nd,[t[110]||(t[110]=ne('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"><div class="flex items-start"><div class="flex-shrink-0"><svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium text-blue-800">Configuration eBilling</h3><div class="mt-2 text-sm text-blue-700"><p>eBilling prend en charge Airtel Money et Moov Money au Gabon. Configurez vos identifiants API ci-dessous.</p></div></div></div></div>',1)),e("div",id,[e("div",null,[t[105]||(t[105]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Merchant ID *",-1)),w(e("input",{"onUpdate:modelValue":t[36]||(t[36]=n=>b.value.config.merchant_id=n),type:"text",required:"",class:"admin-input",placeholder:"Votre Merchant ID eBilling"},null,512),[[R,b.value.config.merchant_id]])]),e("div",null,[t[107]||(t[107]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Environnement",-1)),w(e("select",{"onUpdate:modelValue":t[37]||(t[37]=n=>b.value.config.environment=n),class:"admin-input"},t[106]||(t[106]=[e("option",{value:"sandbox"},"Test (Sandbox)",-1),e("option",{value:"production"},"Production",-1)]),512),[[ee,b.value.config.environment]])])]),e("div",null,[t[108]||(t[108]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé API *",-1)),w(e("input",{"onUpdate:modelValue":t[38]||(t[38]=n=>b.value.config.api_key=n),type:"text",required:"",class:"admin-input",placeholder:"Votre clé API eBilling"},null,512),[[R,b.value.config.api_key]])]),e("div",null,[t[109]||(t[109]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé secrète *",-1)),w(e("input",{"onUpdate:modelValue":t[39]||(t[39]=n=>b.value.config.secret_key=n),type:"password",required:"",class:"admin-input",placeholder:"Votre clé secrète eBilling"},null,512),[[R,b.value.config.secret_key]])]),t[111]||(t[111]=ne('<div class="bg-gray-50 rounded-lg p-4"><h4 class="text-sm font-medium text-gray-900 mb-2">Méthodes supportées via eBilling</h4><div class="flex flex-wrap gap-2"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Airtel Money </span><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Moov Money </span></div></div>',1))])):z("",!0),b.value?.id==="flutterwave"?(i(),r("div",rd,[t[116]||(t[116]=ne('<div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6"><div class="flex items-start"><div class="flex-shrink-0"><svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium text-purple-800">Configuration Flutterwave</h3><div class="mt-2 text-sm text-purple-700"><p>Flutterwave prend en charge les cartes, mobile money, et virements bancaires à travers l&#39;Afrique.</p></div></div></div></div>',1)),e("div",ld,[e("div",null,[t[112]||(t[112]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé publique *",-1)),w(e("input",{"onUpdate:modelValue":t[40]||(t[40]=n=>b.value.config.public_key=n),type:"text",required:"",class:"admin-input",placeholder:"FLWPUBK_TEST-..."},null,512),[[R,b.value.config.public_key]])]),e("div",null,[t[114]||(t[114]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Environnement",-1)),w(e("select",{"onUpdate:modelValue":t[41]||(t[41]=n=>b.value.config.environment=n),class:"admin-input"},t[113]||(t[113]=[e("option",{value:"sandbox"},"Test (Sandbox)",-1),e("option",{value:"live"},"Production (Live)",-1)]),512),[[ee,b.value.config.environment]])])]),e("div",null,[t[115]||(t[115]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé secrète *",-1)),w(e("input",{"onUpdate:modelValue":t[42]||(t[42]=n=>b.value.config.secret_key=n),type:"password",required:"",class:"admin-input",placeholder:"FLWSECK_TEST-..."},null,512),[[R,b.value.config.secret_key]])])])):z("",!0),b.value?.id==="paystack"?(i(),r("div",dd,[t[121]||(t[121]=ne('<div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6"><div class="flex items-start"><div class="flex-shrink-0"><svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium text-green-800">Configuration Paystack</h3><div class="mt-2 text-sm text-green-700"><p>Paystack prend en charge les cartes, USSD, et virements bancaires principalement au Nigeria et Ghana.</p></div></div></div></div>',1)),e("div",ud,[e("div",null,[t[117]||(t[117]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé publique *",-1)),w(e("input",{"onUpdate:modelValue":t[43]||(t[43]=n=>b.value.config.public_key=n),type:"text",required:"",class:"admin-input",placeholder:"pk_test_..."},null,512),[[R,b.value.config.public_key]])]),e("div",null,[t[119]||(t[119]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Environnement",-1)),w(e("select",{"onUpdate:modelValue":t[44]||(t[44]=n=>b.value.config.environment=n),class:"admin-input"},t[118]||(t[118]=[e("option",{value:"sandbox"},"Test (Sandbox)",-1),e("option",{value:"live"},"Production (Live)",-1)]),512),[[ee,b.value.config.environment]])])]),e("div",null,[t[120]||(t[120]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clé secrète *",-1)),w(e("input",{"onUpdate:modelValue":t[45]||(t[45]=n=>b.value.config.secret_key=n),type:"password",required:"",class:"admin-input",placeholder:"sk_test_..."},null,512),[[R,b.value.config.secret_key]])])])):z("",!0)]),e("div",cd,[e("button",{type:"button",onClick:Fe,class:"admin-btn-secondary"}," Annuler "),e("button",{type:"submit",disabled:f.value,class:"admin-btn-primary disabled:opacity-50"},[f.value?(i(),r("span",pd,"Sauvegarde...")):(i(),r("span",gd,"Sauvegarder la configuration"))],8,md)])],32)])])):z("",!0)]))}},fd={class:"space-y-6"},vd={class:"flex justify-between items-center"},xd={class:"flex space-x-3"},bd={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},yd={class:"lg:col-span-1"},_d={class:"admin-card text-center"},wd={class:"p-6"},hd={class:"text-xl font-bold text-gray-900 mb-1"},$d={class:"text-gray-600 mb-2"},kd={class:"border-t border-gray-200 px-6 py-4"},Cd={class:"grid grid-cols-2 gap-4 text-center"},Ed={class:"text-2xl font-bold text-gray-900"},Ad={class:"text-2xl font-bold text-gray-900"},Sd={class:"admin-card mt-6"},jd={class:"p-6 space-y-4"},Pd={class:"flex items-center justify-between"},Dd={class:"flex items-center"},Ud={class:"text-sm font-medium text-gray-900"},Md={class:"flex items-center justify-between"},Vd={class:"flex items-center"},Td={class:"flex items-center justify-between"},Ld={class:"flex items-center"},Rd={class:"text-sm font-medium text-gray-900"},Fd={class:"lg:col-span-2 space-y-6"},Id={class:"admin-card"},Nd={class:"p-6"},qd={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},zd={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Bd={class:"flex justify-end"},Od=["disabled"],Gd={class:"admin-card"},Xd={class:"p-6 space-y-6"},Hd={class:"border border-gray-200 rounded-lg p-4"},Jd={class:"font-medium text-gray-900 mb-3 flex items-center"},Kd={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Wd={class:"flex justify-end"},Yd=["disabled"],Qd={class:"border border-gray-200 rounded-lg p-4"},Zd={class:"flex items-center justify-between mb-3"},eu={class:"font-medium text-gray-900 flex items-center"},tu={class:"relative inline-flex items-center cursor-pointer"},su={class:"text-sm text-gray-600"},au={class:"border border-gray-200 rounded-lg p-4"},ou={class:"font-medium text-gray-900 mb-3 flex items-center"},nu={class:"space-y-3"},iu={class:"flex items-center"},ru={class:"text-sm font-medium text-gray-900"},lu={class:"text-xs text-gray-600"},du=["onClick"],uu={key:1,class:"text-xs text-blue-600 font-medium"},cu={class:"admin-card"},mu={class:"p-6 space-y-6"},pu={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},gu={class:"space-y-4"},fu={class:"space-y-3"},vu={class:"font-medium text-gray-900"},xu={class:"text-sm text-gray-600"},bu={class:"relative inline-flex items-center cursor-pointer"},yu=["onUpdate:modelValue"],_u={class:"flex justify-end"},wu=["disabled"],jp={__name:"Profile",setup(x){const E=Pt(),{get:I,post:P,put:f}=pe(),S=$(!1);$(!1),$(!1),$(null);const p=se({first_name:E.user?.first_name||"",last_name:E.user?.last_name||"",email:E.user?.email||"",phone:"",position:"",bio:"",timezone:"Africa/Libreville",language:"fr",two_factor_enabled:!1,avatar_url:E.user?.avatar_url||null}),h=se({current_password:"",new_password:"",confirm_password:""}),M=$({actions_count:0,login_streak:0,last_login:null,created_at:null}),D=$([]),V=$([]),U=(y,d,j)=>{y.response?.status===404?(console.info(`API ${d} pas encore implémentée, simulation du succès`),window.$toast&&window.$toast.info(`${j} (API en développement)`,"ℹ️ Développement")):window.$toast&&window.$toast.error(`Erreur lors de ${d.toLowerCase()}`,"✗ Erreur")},O=async()=>{S.value=!0;try{const y=await I("/admin/profile");y&&y.success&&y.data&&(Object.assign(p,y.data.profile),M.value=y.data.stats||{},y.data.sessions&&(D.value=y.data.sessions))}catch(y){console.error("Error loading profile:",y),y.response?.status!==404?window.$toast&&window.$toast.error("Erreur lors du chargement du profil","✗ Erreur"):(console.info("API /admin/profile pas encore implémentée, utilisation des données par défaut"),E.user&&Object.assign(p,{first_name:E.user.first_name||"",last_name:E.user.last_name||"",email:E.user.email||"",phone:p.phone,position:p.position,bio:p.bio,timezone:p.timezone,language:p.language,two_factor_enabled:p.two_factor_enabled,avatar_url:E.user.avatar_url||null}),M.value={actions_count:127,login_streak:12,last_login:new Date(Date.now()-1e3*60*30).toISOString(),created_at:new Date(Date.now()-1e3*60*60*24*90).toISOString()},D.value=[{id:1,device:"Chrome sur Mac",location:"Libreville, Gabon",last_activity:new Date,current:!0}],V.value=[{id:"new_user_registration",name:"Nouveaux utilisateurs",description:"Notification lors de l'inscription d'un nouvel utilisateur",enabled:!0},{id:"suspicious_activity",name:"Activité suspecte",description:"Alertes de sécurité et activités inhabituelles",enabled:!0}])}finally{S.value=!1}},G=async()=>{S.value=!0;try{const y=await f("/admin/profile",p);y&&y.success&&(await E.refreshUser(),window.$toast&&window.$toast.success("Informations mises à jour avec succès","✅ Profil"))}catch(y){console.error("Error updating profile:",y),U(y,"/admin/profile","Informations mises à jour avec succès")}finally{S.value=!1}},N=async()=>{if(h.new_password!==h.confirm_password){window.$toast&&window.$toast.error("Les mots de passe ne correspondent pas","✗ Validation");return}if(h.new_password.length<8){window.$toast&&window.$toast.error("Le mot de passe doit contenir au moins 8 caractères","✗ Validation");return}S.value=!0;try{const y=await f("/admin/profile/password",{current_password:h.current_password,new_password:h.new_password});y&&y.success&&(h.current_password="",h.new_password="",h.confirm_password="",window.$toast&&window.$toast.success("Mot de passe mis à jour avec succès","✅ Sécurité"))}catch(y){if(console.error("Error updating password:",y),window.$toast){const d=y.response?.data?.message||"Erreur lors du changement de mot de passe";window.$toast.error(d,"✗ Erreur")}}finally{S.value=!1}},H=async()=>{S.value=!0;try{const y=await f("/admin/profile/preferences",{timezone:p.timezone,language:p.language,notifications:V.value});y&&y.success&&window.$toast&&window.$toast.success("Préférences sauvegardées avec succès","✅ Préférences")}catch(y){console.error("Error updating preferences:",y),window.$toast&&window.$toast.error("Erreur lors de la sauvegarde des préférences","✗ Erreur")}finally{S.value=!1}},q=async()=>{S.value=!0;try{const y=await P("/admin/profile/2fa/toggle",{enabled:p.two_factor_enabled});if(y&&y.success){const d=p.two_factor_enabled?"Authentification 2FA activée":"Authentification 2FA désactivée";window.$toast&&window.$toast.success(d,"✅ Sécurité")}}catch(y){console.error("Error toggling 2FA:",y),p.two_factor_enabled=!p.two_factor_enabled,window.$toast&&window.$toast.error("Erreur lors de la modification 2FA","✗ Erreur")}finally{S.value=!1}},Q=async y=>{if(confirm("Voulez-vous vraiment déconnecter cette session ?"))try{const d=await P("/admin/profile/sessions/terminate",{session_id:y});d&&d.success&&(D.value=D.value.filter(j=>j.id!==y),window.$toast&&window.$toast.success("Session déconnectée","✅ Sécurité"))}catch(d){console.error("Error terminating session:",d),window.$toast&&window.$toast.error("Erreur lors de la déconnexion","✗ Erreur")}},X=async()=>{if(confirm("Voulez-vous vraiment déconnecter toutes les autres sessions ?"))try{const y=await P("/admin/profile/sessions/terminate-all");y&&y.success&&(D.value=D.value.filter(d=>d.current),window.$toast&&window.$toast.success("Toutes les sessions ont été déconnectées","✅ Sécurité"))}catch(y){console.error("Error terminating sessions:",y),window.$toast&&window.$toast.error("Erreur lors de la déconnexion","✗ Erreur")}},Z=y=>{p.avatar_url=y.avatar_url,E.updateUser({avatar_url:y.avatar_url}),window.$toast&&window.$toast.success("Photo de profil mise à jour avec succès","✅ Profil")},T=y=>{console.error("Avatar upload error:",y),window.$toast&&window.$toast.error("Erreur lors de l'upload de l'avatar","✗ Erreur")},v=async()=>{await O(),window.$toast&&window.$toast.info("Profil rechargé","ℹ️ Information")},m=async()=>{try{const y=await I("/admin/profile/activity-log/export");if(y&&y.success){const d=new Blob([JSON.stringify(y.data,null,2)],{type:"application/json"}),j=URL.createObjectURL(d),_=document.createElement("a");_.href=j,_.download=`admin-activity-log-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(j),window.$toast&&window.$toast.success("Journal d'activité téléchargé","✅ Export")}}catch(y){console.error("Error downloading activity log:",y),U(y,"/admin/profile/activity-log/export","Journal d'activité téléchargé")}},b=()=>M.value.last_login?new Date(M.value.last_login).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Jamais",L=()=>M.value.created_at?new Date(M.value.created_at).toLocaleDateString("fr-FR",{month:"long",year:"numeric"}):"N/A",F=y=>{const j=Math.floor((new Date-y)/1e3);return j<60?"À l'instant":j<3600?`il y a ${Math.floor(j/60)} min`:j<86400?`il y a ${Math.floor(j/3600)} h`:`il y a ${Math.floor(j/86400)} j`};return me(()=>{O()}),(y,d)=>(i(),r("div",fd,[e("div",vd,[d[14]||(d[14]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Profil Administrateur"),e("p",{class:"mt-2 text-gray-600"},"Gérez vos informations personnelles et paramètres de compte")],-1)),e("div",xd,[e("button",{onClick:v,class:"admin-btn-secondary"},[A(k(ve),{class:"w-4 h-4 mr-2"}),d[12]||(d[12]=B(" Actualiser ",-1))]),e("button",{onClick:m,class:"admin-btn-accent"},[A(k(Re),{class:"w-4 h-4 mr-2"}),d[13]||(d[13]=B(" Journal d'activité ",-1))])])]),e("div",bd,[e("div",yd,[e("div",_d,[e("div",wd,[A(At,{"current-avatar-url":p.avatar_url,"upload-endpoint":"/admin/profile/image","field-name":"avatar","alt-text":"Photo de profil administrateur","help-text":"Cliquez pour modifier votre photo de profil",onSuccess:Z,onError:T},null,8,["current-avatar-url"]),e("h2",hd,a(p.first_name)+" "+a(p.last_name),1),e("p",$d,a(p.email),1),d[15]||(d[15]=e("span",{class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},[e("div",{class:"w-2 h-2 bg-green-500 rounded-full mr-2"}),B(" Administrateur actif ")],-1))]),e("div",kd,[e("div",Cd,[e("div",null,[e("p",Ed,a(M.value.actions_count||0),1),d[16]||(d[16]=e("p",{class:"text-sm text-gray-600"},"Actions ce mois",-1))]),e("div",null,[e("p",Ad,a(M.value.login_streak||0),1),d[17]||(d[17]=e("p",{class:"text-sm text-gray-600"},"Jours consécutifs",-1))])])])]),e("div",Sd,[d[22]||(d[22]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Statistiques rapides")],-1)),e("div",jd,[e("div",Pd,[e("div",Dd,[A(k(ye),{class:"w-5 h-5 text-blue-500 mr-3"}),d[18]||(d[18]=e("span",{class:"text-sm text-gray-700"},"Dernière connexion",-1))]),e("span",Ud,a(b()),1)]),e("div",Md,[e("div",Vd,[A(k(_t),{class:"w-5 h-5 text-green-500 mr-3"}),d[19]||(d[19]=e("span",{class:"text-sm text-gray-700"},"Privilèges",-1))]),d[20]||(d[20]=e("span",{class:"text-sm font-medium text-gray-900"},"Super Admin",-1))]),e("div",Td,[e("div",Ld,[A(k(wt),{class:"w-5 h-5 text-purple-500 mr-3"}),d[21]||(d[21]=e("span",{class:"text-sm text-gray-700"},"Membre depuis",-1))]),e("span",Rd,a(L()),1)])])])]),e("div",Fd,[e("div",Id,[d[29]||(d[29]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Informations personnelles")],-1)),e("div",Nd,[e("form",{onSubmit:le(G,["prevent"]),class:"space-y-6"},[e("div",qd,[e("div",null,[d[23]||(d[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prénom",-1)),w(e("input",{"onUpdate:modelValue":d[0]||(d[0]=j=>p.first_name=j),type:"text",class:"admin-input",required:""},null,512),[[R,p.first_name]])]),e("div",null,[d[24]||(d[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom",-1)),w(e("input",{"onUpdate:modelValue":d[1]||(d[1]=j=>p.last_name=j),type:"text",class:"admin-input",required:""},null,512),[[R,p.last_name]])])]),e("div",null,[d[25]||(d[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),w(e("input",{"onUpdate:modelValue":d[2]||(d[2]=j=>p.email=j),type:"email",class:"admin-input",required:""},null,512),[[R,p.email]])]),e("div",zd,[e("div",null,[d[26]||(d[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Téléphone",-1)),A(We,{modelValue:p.phone,"onUpdate:modelValue":d[3]||(d[3]=j=>p.phone=j),placeholder:"Numéro de téléphone","initial-country":"ga"},null,8,["modelValue"])]),e("div",null,[d[27]||(d[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Poste/Fonction",-1)),w(e("input",{"onUpdate:modelValue":d[4]||(d[4]=j=>p.position=j),type:"text",class:"admin-input",placeholder:"Administrateur système"},null,512),[[R,p.position]])])]),e("div",null,[d[28]||(d[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bio",-1)),w(e("textarea",{"onUpdate:modelValue":d[5]||(d[5]=j=>p.bio=j),rows:"3",class:"admin-input",placeholder:"Présentez-vous en quelques mots..."},null,512),[[R,p.bio]])]),e("div",Bd,[e("button",{type:"submit",disabled:S.value,class:"admin-btn-primary disabled:opacity-50"},a(S.value?"Sauvegarde...":"Sauvegarder les modifications"),9,Od)])],32)])]),e("div",Gd,[d[38]||(d[38]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Sécurité et confidentialité")],-1)),e("div",Xd,[e("div",Hd,[e("h4",Jd,[A(k(ht),{class:"w-5 h-5 mr-2 text-red-500"}),d[30]||(d[30]=B(" Changer le mot de passe ",-1))]),e("form",{onSubmit:le(N,["prevent"]),class:"space-y-4"},[e("div",null,[d[31]||(d[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Mot de passe actuel",-1)),w(e("input",{"onUpdate:modelValue":d[6]||(d[6]=j=>h.current_password=j),type:"password",class:"admin-input",required:""},null,512),[[R,h.current_password]])]),e("div",Kd,[e("div",null,[d[32]||(d[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nouveau mot de passe",-1)),w(e("input",{"onUpdate:modelValue":d[7]||(d[7]=j=>h.new_password=j),type:"password",class:"admin-input",minlength:"8",required:""},null,512),[[R,h.new_password]])]),e("div",null,[d[33]||(d[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Confirmer le mot de passe",-1)),w(e("input",{"onUpdate:modelValue":d[8]||(d[8]=j=>h.confirm_password=j),type:"password",class:"admin-input",required:""},null,512),[[R,h.confirm_password]])])]),e("div",Wd,[e("button",{type:"submit",disabled:S.value,class:"admin-btn-danger disabled:opacity-50"},a(S.value?"Mise à jour...":"Mettre à jour le mot de passe"),9,Yd)])],32)]),e("div",Qd,[e("div",Zd,[e("h4",eu,[A(k($e),{class:"w-5 h-5 mr-2 text-blue-500"}),d[34]||(d[34]=B(" Authentification à deux facteurs (2FA) ",-1))]),e("label",tu,[w(e("input",{"onUpdate:modelValue":d[9]||(d[9]=j=>p.two_factor_enabled=j),type:"checkbox",class:"sr-only peer",onChange:q},null,544),[[re,p.two_factor_enabled]]),d[35]||(d[35]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))])]),e("p",su,a(p.two_factor_enabled?"L'authentification à deux facteurs est activée pour votre compte.":"Activez l'authentification à deux facteurs pour renforcer la sécurité de votre compte."),1)]),e("div",au,[e("h4",ou,[A(k($t),{class:"w-5 h-5 mr-2 text-yellow-500"}),d[36]||(d[36]=B(" Sessions actives ",-1))]),e("div",nu,[(i(!0),r(J,null,K(D.value,j=>(i(),r("div",{key:j.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",iu,[d[37]||(d[37]=e("div",{class:"w-2 h-2 bg-green-500 rounded-full mr-3"},null,-1)),e("div",null,[e("p",ru,a(j.device),1),e("p",lu,a(j.location)+" • "+a(F(j.last_activity)),1)])]),j.current?(i(),r("span",uu,"Session actuelle")):(i(),r("button",{key:0,onClick:_=>Q(j.id),class:"text-red-600 hover:text-red-900 text-sm"}," Déconnecter ",8,du))]))),128))]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:X,class:"admin-btn-danger text-sm"}," Déconnecter toutes les autres sessions ")])])])]),e("div",cu,[d[45]||(d[45]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Préférences d'administration")],-1)),e("div",mu,[e("div",pu,[e("div",null,[d[40]||(d[40]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fuseau horaire",-1)),w(e("select",{"onUpdate:modelValue":d[10]||(d[10]=j=>p.timezone=j),class:"admin-input"},d[39]||(d[39]=[ne('<option value="Africa/Libreville">Afrique/Libreville (WAT)</option><option value="UTC">UTC (Temps universel)</option><option value="Africa/Abidjan">Afrique/Abidjan (GMT)</option><option value="Europe/Paris">Europe/Paris (CET)</option><option value="America/New_York">Amérique/New York (EST)</option>',5)]),512),[[ee,p.timezone]])]),e("div",null,[d[42]||(d[42]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Langue",-1)),w(e("select",{"onUpdate:modelValue":d[11]||(d[11]=j=>p.language=j),class:"admin-input"},d[41]||(d[41]=[e("option",{value:"fr"},"Français",-1),e("option",{value:"en"},"English",-1)]),512),[[ee,p.language]])])]),e("div",gu,[d[44]||(d[44]=e("h4",{class:"font-medium text-gray-900"},"Notifications d'administration",-1)),e("div",fu,[(i(!0),r(J,null,K(V.value,j=>(i(),r("div",{key:j.id,class:"flex items-center justify-between"},[e("div",null,[e("p",vu,a(j.name),1),e("p",xu,a(j.description),1)]),e("label",bu,[w(e("input",{"onUpdate:modelValue":_=>j.enabled=_,type:"checkbox",class:"sr-only peer"},null,8,yu),[[re,j.enabled]]),d[43]||(d[43]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#0099cc]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0099cc]"},null,-1))])]))),128))])]),e("div",_u,[e("button",{onClick:H,disabled:S.value,class:"admin-btn-primary disabled:opacity-50"},a(S.value?"Sauvegarde...":"Sauvegarder les préférences"),9,wu)])])])])])]))}},hu={class:"space-y-6"},$u={class:"flex justify-between items-center"},ku={class:"flex space-x-3"},Cu={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Eu={class:"admin-card hover:shadow-md transition-shadow duration-200"},Au={class:"flex items-center"},Su={class:"p-3 rounded-lg bg-green-100"},ju={class:"ml-4"},Pu={class:"text-2xl font-bold text-gray-900"},Du={class:"admin-card hover:shadow-md transition-shadow duration-200"},Uu={class:"flex items-center"},Mu={class:"p-3 rounded-lg bg-blue-100"},Vu={class:"ml-4"},Tu={class:"text-2xl font-bold text-gray-900"},Lu={class:"admin-card hover:shadow-md transition-shadow duration-200"},Ru={class:"flex items-center"},Fu={class:"p-3 rounded-lg bg-yellow-100"},Iu={class:"ml-4"},Nu={class:"text-2xl font-bold text-gray-900"},qu={class:"admin-card hover:shadow-md transition-shadow duration-200"},zu={class:"flex items-center"},Bu={class:"p-3 rounded-lg bg-purple-100"},Ou={class:"ml-4"},Gu={class:"text-2xl font-bold text-gray-900"},Xu={key:0,class:"admin-card"},Hu={class:"p-6"},Ju={key:0,class:"mb-6"},Ku={class:"text-md font-medium text-orange-700 mb-3 flex items-center"},Wu={class:"space-y-3"},Yu={class:"font-medium"},Qu={class:"text-sm text-gray-600"},Zu={class:"text-sm"},ec={class:"text-right"},tc={class:"font-semibold text-orange-700"},sc=["onClick"],ac={key:1},oc={class:"text-md font-medium text-red-700 mb-3 flex items-center"},nc={class:"space-y-3"},ic={class:"font-medium"},rc={class:"text-sm text-gray-600"},lc={class:"text-sm"},dc={class:"text-right"},uc={class:"font-semibold text-red-700"},cc=["onClick"],mc={class:"admin-card"},pc={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},gc={class:"flex flex-wrap items-center space-x-4"},fc={class:"text-sm text-gray-500"},vc={key:1,class:"text-center py-12"},xc={key:2,class:"text-center py-12"},bc={key:3,class:"admin-card"},yc={class:"overflow-x-auto"},_c={class:"min-w-full divide-y divide-gray-200"},wc={class:"bg-white divide-y divide-gray-200"},hc={class:"px-6 py-4 whitespace-nowrap"},$c={class:"font-mono text-sm font-medium text-gray-900"},kc={class:"text-sm text-gray-500"},Cc={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 mt-1"},Ec={class:"px-6 py-4 whitespace-nowrap"},Ac={class:"text-sm font-medium text-gray-900"},Sc={class:"text-sm text-gray-500"},jc={class:"px-6 py-4 whitespace-nowrap"},Pc={class:"text-sm font-semibold text-gray-900"},Dc={class:"text-xs text-gray-500"},Uc={class:"px-6 py-4 whitespace-nowrap"},Mc={class:"text-sm text-gray-900"},Vc={key:0,class:"text-xs text-gray-500"},Tc={key:1,class:"text-xs text-gray-500"},Lc={class:"px-6 py-4 whitespace-nowrap"},Rc={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fc={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Ic={class:"flex space-x-2"},Nc=["onClick"],qc=["onClick"],zc=["onClick"],Bc={key:4,class:"fixed inset-0 z-50 overflow-y-auto"},Oc={class:"flex items-center justify-center min-h-screen px-4"},Gc={class:"relative bg-white rounded-lg max-w-md w-full"},Xc={class:"p-6"},Hc={class:"flex items-center justify-between mb-4"},Jc={class:"text-lg font-semibold flex items-center"},Kc={class:"space-y-4"},Wc={class:"flex items-center"},Yc={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},Qc={class:"text-sm text-yellow-800"},Zc={class:"font-medium mb-1 flex items-center"},em={class:"flex justify-end space-x-3 mt-6"},tm=["disabled"],sm={key:5,class:"fixed inset-0 z-50 overflow-y-auto"},am={class:"flex items-center justify-center min-h-screen px-4"},om={class:"relative bg-white rounded-lg max-w-md w-full"},nm={class:"p-6"},im={class:"flex items-center justify-between mb-4"},rm={class:"space-y-4"},lm={class:"flex justify-end space-x-3 mt-6"},dm=["disabled"],Pp={__name:"RefundManagement",setup(x){const{get:E,post:I}=pe(),P=$([]),f=$({}),S=$(!1),p=$(!1),h=$({}),M=$(!1),D=$(null),V=$(""),U=$({status:"",type:"",reason:""}),O=$({dryRun:!1}),G=async()=>{S.value=!0;try{const _=new URLSearchParams({limit:100});Object.keys(U.value).forEach(s=>{U.value[s]&&_.append(s,U.value[s])});const o=await E(`/admin/refunds?${_}`);o&&o.success&&o.data&&(P.value=o.data.refunds||[])}catch(_){console.error("Error loading refunds:",_),window.$toast&&window.$toast.error("Erreur lors du chargement des remboursements","✗ Erreur"),P.value=[]}finally{S.value=!1}},N=async()=>{try{const _=await E("/admin/refunds/stats");_&&_.success&&_.data&&(f.value=_.data)}catch(_){console.error("Error loading stats:",_),window.$toast&&window.$toast.error("Erreur lors du chargement des statistiques","✗ Erreur"),f.value={total_refunds:0,total_amount_refunded:0,pending_refunds:0,auto_processed:0}}},H=async()=>{try{const _=await E("/admin/refunds/eligible-lotteries");_&&_.success&&_.data&&(h.value=_.data)}catch(_){console.error("Error loading eligible lotteries:",_),window.$toast&&window.$toast.error("Erreur lors du chargement des tombolas éligibles","✗ Erreur"),h.value={expired_insufficient:[],cancelled:[],summary:{expired_count:0,expired_estimated_refund:0,cancelled_count:0,cancelled_estimated_refund:0}}}},q=async()=>{p.value=!0;try{const _=await I("/admin/refunds/process-automatic",{dry_run:O.value.dryRun});if(_&&_.success&&window.$toast){const o=_.data.message||"Traitement automatique terminé";window.$toast.success(o,"✅ Traitement")}await Promise.all([G(),N(),H()]),M.value=!1}catch(_){if(console.error("Error processing automatic refunds:",_),window.$toast){const o=_.response?.data?.message||"Erreur lors du traitement automatique";window.$toast.error(o,"✗ Erreur")}}finally{p.value=!1}},Q=async(_,o=!1)=>{if(confirm("Traiter les remboursements pour cette tombola ?")){p.value=!0;try{const s=await I("/admin/refunds/process-automatic",{lottery_id:_,dry_run:o});if(s&&s.success&&window.$toast){const u=s.data.message||"Traitement terminé";window.$toast.success(u,"✅ Traitement")}await Promise.all([G(),N(),H()])}catch(s){if(console.error("Error processing lottery refunds:",s),window.$toast){const u=s.response?.data?.message||"Erreur lors du traitement";window.$toast.error(u,"✗ Erreur")}}finally{p.value=!1}}},X=async _=>{if(confirm("Approuver ce remboursement ?")){p.value=!0;try{const o=await I(`/admin/refunds/${_.id}/approve`);if(o&&o.success){if(window.$toast){const u=o.data.message||"Remboursement approuvé et traité";window.$toast.success(u,"✅ Approbation")}const s=P.value.findIndex(u=>u.id===_.id);s!==-1&&o.data.refund&&(P.value[s]=o.data.refund),await N()}}catch(o){if(console.error("Error approving refund:",o),window.$toast){const s=o.response?.data?.message||"Erreur lors de l'approbation";window.$toast.error(s,"✗ Erreur")}}finally{p.value=!1}}},Z=_=>{D.value=_,V.value=""},T=async()=>{if(V.value.trim()){p.value=!0;try{const _=await I(`/admin/refunds/${D.value.id}/reject`,{reason:V.value});if(_&&_.success){if(window.$toast){const s=_.data.message||"Remboursement rejeté";window.$toast.warning(s,"⚠️ Rejet")}const o=P.value.findIndex(s=>s.id===D.value.id);o!==-1&&_.data.refund&&(P.value[o]=_.data.refund),await N()}D.value=null,V.value=""}catch(_){if(console.error("Error rejecting refund:",_),window.$toast){const o=_.response?.data?.message||"Erreur lors du rejet";window.$toast.error(o,"✗ Erreur")}D.value=null,V.value=""}finally{p.value=!1}}},v=_=>{window.$toast&&window.$toast.info("Détails du remboursement : "+_.refund_number,"📝 Détails")},m=()=>{U.value={status:"",type:"",reason:""},G()},b=_=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(_||0)+" FCFA",L=_=>_?_>=1e6?(_/1e6).toFixed(1)+"M":_>=1e3?(_/1e3).toFixed(0)+"K":_.toString():"0",F=_=>new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(_)),y=_=>({pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",processed:"bg-purple-100 text-purple-800",completed:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800",failed:"bg-red-100 text-red-800"})[_]||"bg-gray-100 text-gray-800",d=_=>({pending:"En attente",approved:"Approuvé",processed:"Traité",completed:"Terminé",rejected:"Rejeté",failed:"Échec"})[_]||_,j=_=>({insufficient_participants:"Participants insuffisants",lottery_cancelled:"Tombola annulée",accidental_purchase:"Achat accidentel",changed_mind:"Changement d'avis",duplicate_purchase:"Achat en double",technical_issue:"Problème technique",system_error:"Erreur système",other:"Autre"})[_]||_;return me(async()=>{await Promise.all([G(),N(),H()])}),(_,o)=>(i(),r("div",hu,[e("div",$u,[o[14]||(o[14]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion des Remboursements"),e("p",{class:"mt-2 text-gray-600"},"Administration des remboursements automatiques et manuels")],-1)),e("div",ku,[e("button",{onClick:H,class:"admin-btn-secondary"},[A(k(He),{class:"w-4 h-4 mr-2"}),o[12]||(o[12]=B(" Vérifier les tombolas ",-1))]),e("button",{onClick:o[0]||(o[0]=s=>M.value=!0),class:"admin-btn-primary"},[A(k(fe),{class:"w-4 h-4 mr-2"}),o[13]||(o[13]=B(" Traiter automatique ",-1))])])]),e("div",Cu,[e("div",Eu,[e("div",Au,[e("div",Su,[A(k(ke),{class:"w-6 h-6 text-green-600"})]),e("div",ju,[o[15]||(o[15]=e("p",{class:"text-sm font-medium text-gray-600"},"Total remboursements",-1)),e("p",Pu,a(f.value.total_refunds||0),1)])])]),e("div",Du,[e("div",Uu,[e("div",Mu,[A(k(Xe),{class:"w-6 h-6 text-[#0099cc]"})]),e("div",Vu,[o[16]||(o[16]=e("p",{class:"text-sm font-medium text-gray-600"},"Montant remboursé",-1)),e("p",Tu,a(L(f.value.total_amount_refunded)),1)])])]),e("div",Lu,[e("div",Ru,[e("div",Fu,[A(k(ye),{class:"w-6 h-6 text-yellow-600"})]),e("div",Iu,[o[17]||(o[17]=e("p",{class:"text-sm font-medium text-gray-600"},"En attente",-1)),e("p",Nu,a(f.value.pending_refunds||0),1)])])]),e("div",qu,[e("div",zu,[e("div",Bu,[A(k(fe),{class:"w-6 h-6 text-purple-600"})]),e("div",Ou,[o[18]||(o[18]=e("p",{class:"text-sm font-medium text-gray-600"},"Auto-traités",-1)),e("p",Gu,a(f.value.auto_processed||0),1)])])])]),h.value.expired_insufficient?.length||h.value.cancelled?.length?(i(),r("div",Xu,[o[21]||(o[21]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Tombolas éligibles aux remboursements")],-1)),e("div",Hu,[h.value.expired_insufficient?.length?(i(),r("div",Ju,[e("h4",Ku,[A(k(ye),{class:"w-4 h-4 mr-1"}),o[19]||(o[19]=B(" Expirées - Participants insuffisants ",-1))]),e("div",Wu,[(i(!0),r(J,null,K(h.value.expired_insufficient,s=>(i(),r("div",{key:s.id,class:"flex items-center justify-between bg-orange-50 border border-orange-200 rounded-lg p-4"},[e("div",null,[e("div",Yu,a(s.lottery_number),1),e("div",Qu,a(s.product_title),1),e("div",Zu,a(s.participants)+"/"+a(s.min_participants)+" participants",1)]),e("div",ec,[e("div",tc,a(b(s.estimated_refund)),1),e("button",{onClick:u=>Q(s.id,!1),class:"admin-btn-accent text-sm"}," Rembourser ",8,sc)])]))),128))])])):z("",!0),h.value.cancelled?.length?(i(),r("div",ac,[e("h4",oc,[A(k(kt),{class:"w-4 h-4 mr-1"}),o[20]||(o[20]=B(" Tombolas annulées ",-1))]),e("div",nc,[(i(!0),r(J,null,K(h.value.cancelled,s=>(i(),r("div",{key:s.id,class:"flex items-center justify-between bg-red-50 border border-red-200 rounded-lg p-4"},[e("div",null,[e("div",ic,a(s.lottery_number),1),e("div",rc,a(s.product_title),1),e("div",lc,a(s.participants)+" participants",1)]),e("div",dc,[e("div",uc,a(b(s.estimated_refund)),1),e("button",{onClick:u=>Q(s.id,!1),class:"admin-btn-danger text-sm"}," Rembourser ",8,cc)])]))),128))])])):z("",!0)])])):z("",!0),e("div",mc,[e("div",pc,[e("div",gc,[w(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>U.value.status=s),onChange:G,class:"admin-input"},o[22]||(o[22]=[ne('<option value="">Tous les statuts</option><option value="pending">En attente</option><option value="approved">Approuvé</option><option value="processed">Traité</option><option value="completed">Terminé</option><option value="rejected">Rejeté</option>',6)]),544),[[ee,U.value.status]]),w(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>U.value.type=s),onChange:G,class:"admin-input"},o[23]||(o[23]=[e("option",{value:""},"Tous les types",-1),e("option",{value:"automatic"},"Automatique",-1),e("option",{value:"manual"},"Manuel",-1),e("option",{value:"admin"},"Admin",-1)]),544),[[ee,U.value.type]]),w(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>U.value.reason=s),onChange:G,class:"admin-input"},o[24]||(o[24]=[ne('<option value="">Toutes les raisons</option><option value="insufficient_participants">Participants insuffisants</option><option value="lottery_cancelled">Tombola annulée</option><option value="accidental_purchase">Achat accidentel</option><option value="technical_issue">Problème technique</option>',5)]),544),[[ee,U.value.reason]]),e("button",{onClick:m,class:"admin-btn-secondary text-sm"}," Réinitialiser ")]),e("div",fc,a(P.value.length)+" remboursement(s) ",1)])]),S.value?(i(),r("div",vc,o[25]||(o[25]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des remboursements...",-1)]))):P.value.length===0?(i(),r("div",xc,[A(k(ke),{class:"mx-auto h-16 w-16 text-gray-400 mb-4"}),o[26]||(o[26]=e("h3",{class:"text-xl font-medium text-gray-900 mb-2"},"Aucun remboursement",-1)),o[27]||(o[27]=e("p",{class:"text-gray-600"},"Aucun remboursement ne correspond aux filtres sélectionnés.",-1))])):(i(),r("div",bc,[e("div",yc,[e("table",_c,[o[29]||(o[29]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Remboursement"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Utilisateur"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Montant"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Raison"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Statut"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",wc,[(i(!0),r(J,null,K(P.value,s=>(i(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",hc,[e("div",null,[e("div",$c,a(s.refund_number),1),e("div",kc,a(s.type),1),s.auto_processed?(i(),r("div",Cc,[A(k(fe),{class:"w-3 h-3 mr-1"}),o[28]||(o[28]=B(" Auto ",-1))])):z("",!0)])]),e("td",Ec,[e("div",null,[e("div",Ac,a(s.user?.full_name||`${s.user?.first_name||""} ${s.user?.last_name||""}`.trim()||"N/A"),1),e("div",Sc,a(s.user?.email||"N/A"),1)])]),e("td",jc,[e("div",Pc,a(b(s.amount)),1),e("div",Dc,a(s.currency),1)]),e("td",Uc,[e("div",Mc,a(j(s.reason)),1),s.lottery?(i(),r("div",Vc,a(s.lottery.lottery_number),1)):s.ticket?(i(),r("div",Tc," Ticket #"+a(s.ticket.ticket_number),1)):z("",!0)]),e("td",Lc,[e("span",{class:Y(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",y(s.status)])},a(d(s.status)),3)]),e("td",Rc,a(F(s.created_at)),1),e("td",Fc,[e("div",Ic,[s.status==="pending"?(i(),r("button",{key:0,onClick:u=>X(s),class:"text-blue-600 hover:text-blue-900"}," Approuver ",8,Nc)):z("",!0),s.status==="pending"?(i(),r("button",{key:1,onClick:u=>Z(s),class:"text-red-600 hover:text-red-900"}," Rejeter ",8,qc)):z("",!0),e("button",{onClick:u=>v(s),class:"text-[#0099cc] hover:text-[#0088bb] flex items-center",title:"Voir détails"},[A(k(Le),{class:"w-4 h-4"})],8,zc)])])]))),128))])])])])),M.value?(i(),r("div",Bc,[e("div",Oc,[e("div",{class:"fixed inset-0 bg-black/20",onClick:o[4]||(o[4]=s=>M.value=!1)}),e("div",Gc,[e("div",Xc,[e("div",Hc,[e("h3",Jc,[A(k(fe),{class:"w-5 h-5 mr-2"}),o[30]||(o[30]=B(" Traitement Automatique ",-1))]),e("button",{onClick:o[5]||(o[5]=s=>M.value=!1),class:"text-gray-400 hover:text-gray-600"},[A(k(Ee),{class:"w-6 h-6"})])]),e("div",Kc,[e("div",null,[e("label",Wc,[w(e("input",{type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=s=>O.value.dryRun=s),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,512),[[re,O.value.dryRun]]),o[31]||(o[31]=e("span",{class:"ml-2 text-sm text-gray-700"},"Mode test (pas de changements)",-1))])]),e("div",Yc,[e("div",Qc,[e("p",Zc,[A(k(Je),{class:"w-4 h-4 mr-1"}),o[32]||(o[32]=B(" Attention ",-1))]),o[33]||(o[33]=e("p",null,"Cette action va traiter automatiquement tous les remboursements éligibles.",-1))])])]),e("div",em,[e("button",{onClick:o[7]||(o[7]=s=>M.value=!1),class:"admin-btn-secondary"}," Annuler "),e("button",{onClick:q,disabled:p.value,class:"admin-btn-primary disabled:opacity-50"},a(p.value?"Traitement...":"Traiter"),9,tm)])])])])])):z("",!0),D.value?(i(),r("div",sm,[e("div",am,[e("div",{class:"fixed inset-0 bg-black/20",onClick:o[8]||(o[8]=s=>D.value=null)}),e("div",om,[e("div",nm,[e("div",im,[o[34]||(o[34]=e("h3",{class:"text-lg font-semibold"},"Rejeter le remboursement",-1)),e("button",{onClick:o[9]||(o[9]=s=>D.value=null),class:"text-gray-400 hover:text-gray-600"},[A(k(Ee),{class:"w-6 h-6"})])]),e("div",rm,[e("div",null,[o[35]||(o[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Raison du rejet *",-1)),w(e("textarea",{"onUpdate:modelValue":o[10]||(o[10]=s=>V.value=s),rows:"3",required:"",class:"admin-input focus:border-red-500 focus:ring-red-500",placeholder:"Expliquez pourquoi ce remboursement est rejeté..."},null,512),[[R,V.value]])])]),e("div",lm,[e("button",{onClick:o[11]||(o[11]=s=>{D.value=null,V.value=""}),class:"admin-btn-secondary"}," Annuler "),e("button",{onClick:T,disabled:p.value||!V.value.trim(),class:"admin-btn-danger disabled:opacity-50"},a(p.value?"Rejet...":"Rejeter"),9,dm)])])])])])):z("",!0)]))}},um={class:"space-y-6"},cm={class:"flex justify-between items-center"},mm={class:"flex space-x-3"},pm={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},gm={class:"flex items-center"},fm={class:"ml-4"},vm={class:"text-sm font-medium text-gray-600"},xm={class:"text-2xl font-bold text-gray-900"},bm={class:"mt-4 pt-4 border-t border-gray-100"},ym={class:"flex items-center text-sm"},_m={class:"admin-card"},wm={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},hm={class:"flex flex-col"},$m={class:"relative"},km={class:"flex flex-col"},Cm={class:"flex flex-col"},Em={class:"flex flex-col"},Am={class:"admin-card"},Sm={key:0,class:"flex justify-center py-12"},jm={key:1,class:"overflow-x-auto"},Pm={class:"min-w-full"},Dm={class:"bg-white divide-y divide-gray-200"},Um={class:"px-6 py-4 whitespace-nowrap"},Mm={class:"text-sm font-medium text-gray-900"},Vm={class:"text-sm text-gray-500"},Tm={class:"px-6 py-4 whitespace-nowrap"},Lm={class:"flex items-center"},Rm={class:"flex-shrink-0 h-8 w-8"},Fm={class:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center"},Im={class:"ml-3"},Nm={class:"text-sm font-medium text-gray-900"},qm={class:"text-sm text-gray-500"},zm={class:"px-6 py-4 whitespace-nowrap"},Bm={class:"text-sm text-gray-900"},Om={class:"text-sm text-gray-500"},Gm={class:"px-6 py-4 whitespace-nowrap"},Xm={class:"text-sm font-medium text-gray-900"},Hm={class:"text-sm text-gray-500"},Jm={class:"px-6 py-4 whitespace-nowrap"},Km={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Wm={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ym={class:"flex items-center space-x-2"},Qm=["onClick"],Zm=["onClick"],ep={class:"bg-white px-6 py-3 border-t border-gray-200 flex items-center justify-between"},tp={class:"text-sm text-gray-700"},sp={class:"font-medium"},ap={class:"font-medium"},op={class:"font-medium"},np={class:"flex space-x-2"},ip=["disabled"],rp=["disabled"],lp={key:0,class:"fixed inset-0 bg-black/20 overflow-y-auto h-full w-full z-50"},dp={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white"},up={class:"mt-3"},cp={class:"flex justify-between items-center mb-4"},mp={key:0,class:"space-y-4"},pp={class:"grid grid-cols-2 gap-4"},gp={class:"text-sm text-gray-900"},fp={class:"text-sm text-gray-900"},vp={class:"text-sm text-gray-900"},xp={class:"text-sm text-gray-900"},bp={class:"text-sm text-gray-900"},yp={class:"mt-6 flex justify-end space-x-3"},Dp={__name:"PaymentManagement",setup(x){const{get:E,post:I}=pe(),P=$(!1),f=$([]),S=W(()=>[{label:"Total des revenus",value:Z(O.value.total_revenue)+" FCFA",change:O.value.revenue_change,icon:_e,bgColor:"bg-green-100",iconColor:"text-green-600"},{label:"Transactions réussies",value:O.value.successful_transactions.toString(),change:O.value.transactions_change,icon:Ve,bgColor:"bg-blue-100",iconColor:"text-[#0099cc]"},{label:"Taux de réussite",value:O.value.success_rate+"%",change:O.value.success_rate_change,icon:Ae,bgColor:"bg-purple-100",iconColor:"text-purple-600"},{label:"Transactions échouées",value:O.value.failed_transactions.toString(),change:-Math.abs(O.value.failed_transactions/Math.max(O.value.successful_transactions,1)*100),icon:Je,bgColor:"bg-red-100",iconColor:"text-red-600"}]),p=se({search:"",status:"",startDate:"",endDate:""}),h=$(1),M=$(20),D=$(0),V=$(!1),U=$(null),O=$({total_revenue:0,current_month_revenue:0,revenue_change:0,successful_transactions:0,current_month_transactions:0,transactions_change:0,success_rate:0,success_rate_change:0,failed_transactions:0,pending_transactions:0}),G=W(()=>Math.ceil(D.value/M.value)),N=W(()=>(h.value-1)*M.value+1),H=W(()=>Math.min(h.value*M.value,D.value)),q=async()=>{P.value=!0;try{const o=new URLSearchParams;o.append("page",h.value),o.append("per_page",M.value),p.search&&o.append("search",p.search),p.status&&o.append("status",p.status),p.startDate&&o.append("start_date",p.startDate),p.endDate&&o.append("end_date",p.endDate);const s=await E(`/admin/payments?${o.toString()}`);s&&s.success&&s.data&&(f.value=s.data.payments||[],D.value=s.data.pagination?.total||0,s.data.stats&&(O.value=s.data.stats))}catch(o){console.error("Error loading payments:",o),window.$toast&&window.$toast.error("Erreur lors du chargement des paiements","✗ Erreur"),f.value=[],D.value=0}finally{P.value=!1}},Q=()=>{h.value=1,q()},X=async()=>{try{const o=await E("/admin/payments/stats");o&&o.success&&o.data&&(O.value=o.data)}catch(o){console.error("Error loading payment stats:",o)}},Z=o=>new Intl.NumberFormat("fr-FR").format(o),T=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),v=o=>({pending:"admin-badge-warning",completed:"admin-badge-success",failed:"admin-badge-danger",refunded:"bg-gray-100 text-gray-800 px-2 py-1 text-xs font-medium rounded-full"})[o]||"bg-gray-100 text-gray-800 px-2 py-1 text-xs font-medium rounded-full",m=o=>({pending:"En attente",completed:"Complété",failed:"Échoué",refunded:"Remboursé"})[o]||o,b=o=>{U.value=o,V.value=!0},L=()=>{V.value=!1,U.value=null},F=async o=>{if(confirm("Êtes-vous sûr de vouloir initier un remboursement pour cette transaction ?"))try{const s=await I(`/admin/payments/${o.id}/refund`,{reason:"admin_initiated"});s&&s.success&&(window.$toast&&window.$toast.success("Remboursement initié avec succès","✅ Remboursement"),q(),L())}catch(s){if(console.error("Error initiating refund:",s),window.$toast){const u=s.response?.data?.message||"Erreur lors de l'initiation du remboursement";window.$toast.error(u,"✗ Erreur")}}},y=async()=>{try{const o=new URLSearchParams;p.search&&o.append("search",p.search),p.status&&o.append("status",p.status),p.startDate&&o.append("start_date",p.startDate),p.endDate&&o.append("end_date",p.endDate);const s=await E(`/admin/payments/export?${o.toString()}`);if(s&&s.success&&s.data){const u=new Blob([JSON.stringify(s.data,null,2)],{type:"application/json"}),ie=URL.createObjectURL(u),de=document.createElement("a");de.href=ie,de.download=`payments-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ie),window.$toast&&window.$toast.success("Export téléchargé avec succès","✅ Export")}}catch(o){console.error("Error exporting payments:",o),window.$toast&&window.$toast.error("Erreur lors de l'export","✗ Erreur")}},d=async()=>{await Promise.all([q(),X()])},j=()=>{h.value>1&&(h.value--,q())},_=()=>{h.value<G.value&&(h.value++,q())};return me(()=>{q(),X()}),(o,s)=>(i(),r("div",um,[e("div",cm,[s[7]||(s[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestion des Paiements"),e("p",{class:"mt-2 text-gray-600"},"Suivez et gérez toutes les transactions financières")],-1)),e("div",mm,[e("button",{onClick:y,class:"admin-btn-secondary"},[A(k(Re),{class:"w-4 h-4 mr-2"}),s[5]||(s[5]=B(" Exporter ",-1))]),e("button",{onClick:d,class:"admin-btn-primary"},[A(k(ve),{class:"w-4 h-4 mr-2"}),s[6]||(s[6]=B(" Actualiser ",-1))])])]),e("div",pm,[(i(!0),r(J,null,K(S.value,u=>(i(),r("div",{key:u.label,class:"admin-card hover:shadow-md transition-shadow duration-200"},[e("div",gm,[e("div",{class:Y(["p-3 rounded-lg",u.bgColor])},[(i(),ue(ce(u.icon),{class:Y(["w-6 h-6",u.iconColor])},null,8,["class"]))],2),e("div",fm,[e("p",vm,a(u.label),1),e("p",xm,a(u.value),1)])]),e("div",bm,[e("div",ym,[e("span",{class:Y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",u.change>=0?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},[(i(),ue(ce(u.change>=0?k(Oe):k(Ge)),{class:"w-3 h-3 mr-1"})),B(" "+a(Math.abs(u.change))+"% ",1)],2),s[8]||(s[8]=e("span",{class:"ml-2 text-gray-500"},"vs mois dernier",-1))])])]))),128))]),e("div",_m,[e("div",wm,[e("div",hm,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Recherche",-1)),e("div",$m,[A(k(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>p.search=u),type:"text",placeholder:"Transaction ID, utilisateur...",class:"admin-input pl-10 w-full",onInput:Q},null,544),[[R,p.search]])])]),e("div",km,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=u=>p.status=u),onChange:Q,class:"admin-input w-full"},s[10]||(s[10]=[ne('<option value="">Tous les statuts</option><option value="pending">En attente</option><option value="completed">Complété</option><option value="failed">Échoué</option><option value="refunded">Remboursé</option>',5)]),544),[[ee,p.status]])]),e("div",Cm,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date début",-1)),w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>p.startDate=u),type:"date",class:"admin-input w-full",onChange:Q},null,544),[[R,p.startDate]])]),e("div",Em,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date fin",-1)),w(e("input",{"onUpdate:modelValue":s[3]||(s[3]=u=>p.endDate=u),type:"date",class:"admin-input w-full",onChange:Q},null,544),[[R,p.endDate]])])])]),e("div",Am,[s[20]||(s[20]=e("div",{class:"admin-card-header"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Transactions récentes")],-1)),P.value?(i(),r("div",Sm,s[14]||(s[14]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0099cc]"},null,-1)]))):(i(),r("div",jm,[e("table",Pm,[s[15]||(s[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Transaction "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Utilisateur "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Produit/Tombola "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Montant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Dm,[(i(!0),r(J,null,K(f.value,u=>(i(),r("tr",{key:u.id,class:"hover:bg-gray-50"},[e("td",Um,[e("div",Mm,"#"+a(u.transaction_id),1),e("div",Vm,a(u.payment_method),1)]),e("td",Tm,[e("div",Lm,[e("div",Rm,[e("div",Fm,[A(k(Ct),{class:"h-4 w-4 text-gray-600"})])]),e("div",Im,[e("div",Nm,a(u.user_name),1),e("div",qm,a(u.user_email),1)])])]),e("td",zm,[e("div",Bm,a(u.product_name),1),e("div",Om,a(u.tickets_count)+" tickets",1)]),e("td",Gm,[e("div",Xm,a(Z(u.amount)),1),e("div",Hm,a(u.currency),1)]),e("td",Jm,[e("span",{class:Y(v(u.status))},a(m(u.status)),3)]),e("td",Km,a(T(u.created_at)),1),e("td",Wm,[e("div",Ym,[e("button",{onClick:ie=>b(u),class:"text-[#0099cc] hover:text-[#0088bb]",title:"Voir détails"},[A(k(Le),{class:"w-4 h-4"})],8,Qm),u.status==="completed"?(i(),r("button",{key:0,onClick:ie=>F(u),class:"text-orange-600 hover:text-orange-900",title:"Initier remboursement"},[A(k(Et),{class:"w-4 h-4"})],8,Zm)):z("",!0)])])]))),128))])])])),e("div",ep,[e("div",tp,[s[16]||(s[16]=B(" Affichage de ",-1)),e("span",sp,a(N.value),1),s[17]||(s[17]=B(" à ",-1)),e("span",ap,a(H.value),1),s[18]||(s[18]=B(" sur ",-1)),e("span",op,a(D.value),1),s[19]||(s[19]=B(" résultats ",-1))]),e("div",np,[e("button",{onClick:j,disabled:h.value===1,class:"admin-btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"}," Précédent ",8,ip),e("button",{onClick:_,disabled:h.value===G.value,class:"admin-btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"}," Suivant ",8,rp)])])]),V.value?(i(),r("div",lp,[e("div",dp,[e("div",up,[e("div",cp,[s[21]||(s[21]=e("h3",{class:"text-lg font-medium text-gray-900"},"Détails du paiement",-1)),e("button",{onClick:L,class:"text-gray-400 hover:text-gray-600"},[A(k(Ee),{class:"w-6 h-6"})])]),U.value?(i(),r("div",mp,[e("div",pp,[e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700"},"ID Transaction",-1)),e("p",gp,a(U.value.transaction_id),1)]),e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Montant",-1)),e("p",fp,a(Z(U.value.amount))+" "+a(U.value.currency),1)]),e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm font-medium text-gray-700"},"Statut",-1)),e("span",{class:Y(v(U.value.status))},a(m(U.value.status)),3)]),e("div",null,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"Méthode",-1)),e("p",vp,a(U.value.payment_method),1)]),e("div",null,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"Date",-1)),e("p",xp,a(T(U.value.created_at)),1)]),e("div",null,[s[27]||(s[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Utilisateur",-1)),e("p",bp,a(U.value.user_name),1)])])])):z("",!0),e("div",yp,[e("button",{onClick:L,class:"admin-btn-secondary"}," Fermer "),U.value?.status==="completed"?(i(),r("button",{key:0,onClick:s[4]||(s[4]=u=>F(U.value)),class:"admin-btn-accent"}," Initier remboursement ")):z("",!0)])])])])):z("",!0)]))}};export{Ep as P,Ke as _,kp as a,Cp as b,Ap as c,Sp as d,jp as e,Pp as f,Dp as g,Pt as u};
