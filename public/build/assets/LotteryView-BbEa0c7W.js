import{r as h,c as D,Z as H,A as I,g as r,w as N,b as d,l as x,e,T as z,i as y,u as m,N as R,t as a,aq as K,az as Q,a8 as O,ao as ce,a9 as W,an as X,a$ as ee,o as i,Y as me,y as ve,V as B,a1 as J,a7 as pe,R as ge,j as xe,h as ye,x as fe,ad as be,aW as _e,G as we,P as he,C as ke,ar as $e,n as Z,v as De,au as Ce,aL as Te,b8 as je,F as Me,z as Pe,aC as Ee}from"./vendor-DnFm82Vn.js";import{_ as Fe,a as Y}from"./app-Dzpx6Epi.js";const Ne={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Ae={class:"flex items-center justify-center min-h-screen px-4 text-center sm:block sm:p-0"},Le={key:0,"data-modal-content":"",class:"inline-block w-full max-w-lg p-6 my-8 overflow-hidden text-left align-middle bg-white shadow-xl transform transition-all rounded-xl relative"},qe={class:"flex items-center justify-between mb-6"},Ve={class:"text-lg font-semibold text-gray-900 flex items-center"},ze={key:0,class:"text-center py-8"},Re={class:"text-sm text-gray-500"},Se={key:1,class:"text-center py-6"},Ue={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},Ie={class:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4"},Oe={class:"text-lg font-bold text-green-900"},Be={class:"text-sm text-green-700"},Ge={key:2,class:"text-center py-6"},We={class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},Je={class:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4"},Ye={class:"text-red-800"},Ze={key:3,class:"space-y-4"},He={class:"bg-gray-50 rounded-lg p-4"},Ke={class:"font-semibold text-gray-900 mb-2"},Qe={class:"grid grid-cols-2 gap-4 text-sm"},Xe={class:"font-medium ml-1"},et={class:"font-medium ml-1"},tt={class:"font-medium ml-1"},st={class:"font-medium ml-1"},at={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ot={class:"font-medium text-blue-900 mb-2 flex items-center"},lt={class:"text-sm text-blue-800 space-y-1"},nt={key:0,class:"flex items-center"},rt={key:1,class:"flex items-center"},it={key:2,class:"flex items-center"},dt={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},ut={class:"flex"},ct={key:4,class:"flex justify-end gap-3 mt-6"},mt=["disabled"],vt={__name:"LotteryDrawModal",props:{show:{type:Boolean,default:!1},lottery:{type:Object,required:!0}},emits:["close","drawn"],setup(p,{emit:M}){const k=p,s=M,{post:C}=Y(),g=h(!1),u=h(null),w=h(""),c=D(()=>k.lottery.sold_tickets===k.lottery.max_tickets),b=D(()=>k.lottery.min_participants||1),F=D(()=>c.value&&k.lottery.participants_count>=b.value),P=()=>{g.value||(s("close"),setTimeout(()=>{u.value=null,w.value=""},300))},E=f=>new Intl.NumberFormat("fr-FR").format(f||0)+" FCFA",A=async()=>{if(F.value){g.value=!0,u.value=null;try{w.value="Vérification des conditions...",await new Promise(l=>setTimeout(l,500)),w.value="Récupération des tickets éligibles...",await new Promise(l=>setTimeout(l,500)),w.value="Sélection aléatoire du gagnant...",await new Promise(l=>setTimeout(l,1e3));const f=await C(`/lotteries/${k.lottery.id}/draw`);f.success!==!1?(u.value={success:!0,lottery:f.lottery,winning_ticket:f.winning_ticket,verification_hash:f.verification_hash},w.value="Tirage terminé avec succès !",s("drawn",u.value)):u.value={success:!1,error:f.error||"Une erreur est survenue lors du tirage"}}catch(f){u.value={success:!1,error:f.response?.data?.error||f.message||"Une erreur inattendue s'est produite"}}finally{g.value=!1}}};return H(()=>k.show,f=>{f||setTimeout(()=>{u.value=null,w.value=""},300)}),(f,l)=>(i(),I(ee,{to:"body"},[r(z,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:N(()=>[p.show?(i(),d("div",Ne,[e("div",Ae,[r(z,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:N(()=>[p.show?(i(),d("div",{key:0,"data-modal-backdrop":"",class:"fixed inset-0 bg-black/40 transition-opacity",onClick:l[0]||(l[0]=$=>!g.value&&P())})):x("",!0)]),_:1}),l[15]||(l[15]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),r(z,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to-class":"opacity-100 translate-y-0 sm:scale-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100 translate-y-0 sm:scale-100","leave-to-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[p.show?(i(),d("div",Le,[e("div",qe,[e("h3",Ve,[r(m(R),{class:"w-6 h-6 text-purple-600 mr-2"}),y(" "+a(g.value?"Tirage en cours...":"Effectuer le tirage"),1)]),g.value?x("",!0):(i(),d("button",{key:0,onClick:P,class:"text-gray-400 hover:text-gray-600"},[r(m(K),{class:"w-6 h-6"})]))]),g.value?(i(),d("div",ze,[l[1]||(l[1]=e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"},null,-1)),l[2]||(l[2]=e("p",{class:"text-gray-600 mb-2"},"Sélection du gagnant en cours...",-1)),e("p",Re,a(w.value),1)])):u.value&&u.value.success?(i(),d("div",Se,[e("div",Ue,[r(m(Q),{class:"w-8 h-8 text-green-600"})]),l[4]||(l[4]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-2"},"🎉 Tirage terminé !",-1)),e("div",Ie,[l[3]||(l[3]=e("p",{class:"text-green-800 font-medium"},"Gagnant :",-1)),e("p",Oe,a(u.value.winning_ticket.user.first_name)+" "+a(u.value.winning_ticket.user.last_name),1),e("p",Be,"Ticket N° "+a(u.value.winning_ticket.ticket_number),1)]),l[5]||(l[5]=e("p",{class:"text-sm text-gray-600 mb-4"},"Le gagnant a été automatiquement notifié par email.",-1))])):u.value&&!u.value.success?(i(),d("div",Ge,[e("div",We,[r(m(O),{class:"w-8 h-8 text-red-600"})]),l[6]||(l[6]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-2"},"Erreur lors du tirage",-1)),e("div",Je,[e("p",Ye,a(u.value.error||"Une erreur inattendue s'est produite"),1)])])):(i(),d("div",Ze,[e("div",He,[e("h4",Ke,a(p.lottery.title),1),e("div",Qe,[e("div",null,[l[7]||(l[7]=e("span",{class:"text-gray-600"},"Participants :",-1)),e("span",Xe,a(p.lottery.participants_count),1)]),e("div",null,[l[8]||(l[8]=e("span",{class:"text-gray-600"},"Tickets vendus :",-1)),e("span",et,a(p.lottery.sold_tickets)+"/"+a(p.lottery.max_tickets),1)]),e("div",null,[l[9]||(l[9]=e("span",{class:"text-gray-600"},"Valeur du lot :",-1)),e("span",tt,a(E(p.lottery.product_value)),1)]),e("div",null,[l[10]||(l[10]=e("span",{class:"text-gray-600"},"Revenus générés :",-1)),e("span",st,a(E(p.lottery.total_revenue)),1)])])]),e("div",at,[e("h5",ot,[r(m(ce),{class:"w-5 h-5 mr-2"}),l[11]||(l[11]=y(" Conditions de tirage ",-1))]),e("ul",lt,[c.value?(i(),d("li",nt,[r(m(W),{class:"w-4 h-4 text-green-600 mr-2"}),l[12]||(l[12]=y(" Tous les tickets sont vendus ",-1))])):x("",!0),p.lottery.participants_count>=b.value?(i(),d("li",rt,[r(m(W),{class:"w-4 h-4 text-green-600 mr-2"}),y(" Minimum de participants atteint ("+a(p.lottery.participants_count)+"/"+a(b.value)+") ",1)])):(i(),d("li",it,[r(m(X),{class:"w-4 h-4 text-red-600 mr-2"}),y(" Participants insuffisants ("+a(p.lottery.participants_count)+"/"+a(b.value)+") ",1)]))])]),e("div",dt,[e("div",ut,[r(m(O),{class:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),l[13]||(l[13]=e("div",{class:"text-sm text-yellow-800"},[e("p",{class:"font-medium mb-1"},"⚠️ Action irréversible"),e("p",null,"Une fois le tirage effectué, il ne pourra plus être modifié. Le gagnant sera automatiquement notifié et le produit sera marqué comme vendu.")],-1))])])])),g.value?x("",!0):(i(),d("div",ct,[e("button",{onClick:P,class:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},a(u.value?"Fermer":"Annuler"),1),u.value?x("",!0):(i(),d("button",{key:0,onClick:A,disabled:!F.value,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center"},[r(m(R),{class:"w-4 h-4 mr-2"}),l[14]||(l[14]=y(" Effectuer le tirage ",-1))],8,mt))]))])):x("",!0)]),_:1})])])):x("",!0)]),_:1})]))}},pt=Fe(vt,[["__scopeId","data-v-36f4d6f8"]]),gt={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},xt={class:"flex items-center justify-center min-h-screen px-4 text-center"},yt={class:"koumbaya-card inline-block w-full max-w-md my-8 overflow-hidden text-left align-middle bg-white shadow-xl transform transition-all"},ft={class:"koumbaya-form-group"},bt={class:"koumbaya-form-group"},_t={__name:"LotteryExtendModal",props:{show:{type:Boolean,default:!1},lottery:{type:Object,default:()=>({})}},emits:["close","submit"],setup(p,{emit:M}){const k=p,s=M,C=me({newDrawDate:"",reason:""}),g=()=>{s("close")},u=()=>{s("submit",{lotteryId:k.lottery.id,...C})};return(w,c)=>p.show?(i(),d("div",gt,[e("div",xt,[e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-40 transition-opacity",onClick:g}),e("div",yt,[c[5]||(c[5]=e("div",{class:"koumbaya-card-header"},[e("h3",{class:"koumbaya-heading-4"},"Prolonger la tombola")],-1)),e("form",{onSubmit:ve(u,["prevent"]),class:"koumbaya-card-body space-y-4"},[e("div",ft,[c[2]||(c[2]=e("label",{class:"koumbaya-label"},"Nouvelle date de tirage",-1)),B(e("input",{"onUpdate:modelValue":c[0]||(c[0]=b=>C.newDrawDate=b),type:"datetime-local",required:"",class:"koumbaya-input"},null,512),[[J,C.newDrawDate]])]),e("div",bt,[c[3]||(c[3]=e("label",{class:"koumbaya-label"},"Raison de la prolongation",-1)),B(e("textarea",{"onUpdate:modelValue":c[1]||(c[1]=b=>C.reason=b),rows:"3",class:"koumbaya-input",placeholder:"Expliquez pourquoi vous prolongez cette tombola...",required:""},null,512),[[J,C.reason]])]),e("div",{class:"koumbaya-card-footer"},[e("div",{class:"flex gap-4"},[e("button",{type:"button",onClick:g,class:"koumbaya-btn koumbaya-btn-outline flex-1"}," Annuler "),c[4]||(c[4]=e("button",{type:"submit",class:"koumbaya-btn koumbaya-btn-primary flex-1"}," Prolonger ",-1))])])],32)])])])):x("",!0)}},wt={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ht={class:"relative min-h-full flex items-center justify-center p-4"},kt={key:0,class:"relative bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},$t={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center rounded-xl z-10"},Dt={key:1,class:"p-6"},Ct={class:"flex items-center mb-4"},Tt={class:"flex-shrink-0"},jt={class:"mb-4"},Mt={class:"text-sm text-gray-600"},Pt={key:2,class:"p-6"},Et={class:"flex items-center mb-4"},Ft={class:"flex-shrink-0"},Nt={key:3,class:"p-6"},At={class:"flex items-center mb-4"},Lt={class:"flex-shrink-0"},qt={class:"mb-6"},Vt={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4"},zt={class:"flex"},Rt={class:"flex-shrink-0"},St={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},Ut={class:"text-sm text-gray-600 space-y-1"},It={class:"mb-6"},Ot={key:0,class:"mb-6"},Bt={class:"flex justify-end space-x-3"},Gt=["disabled"],Wt=["disabled"],Jt={__name:"LotteryCancelModal",props:{show:{type:Boolean,default:!1},lottery:{type:Object,required:!0}},emits:["close","cancelled"],setup(p,{emit:M}){const k=p,s=M,{post:C}=Y(),g=h(!1),u=h(""),w=h(!1),c=h(""),b=h(""),F=D(()=>!(!c.value||c.value==="other"&&!b.value.trim())),P=$=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0}).format($||0)+" FCFA",E=()=>{w.value?s("cancelled"):s("close"),A()},A=()=>{c.value="",b.value="",u.value="",w.value=!1,g.value=!1},f=async()=>{if(F.value){g.value=!0,u.value="";try{const $=c.value==="other"?b.value:c.value,n=await C(`/lotteries/${k.lottery.id}/cancel`,{reason:$,reason_type:c.value});if(n.success)w.value=!0,window.$toast&&window.$toast.success("Tombola annulée avec succès. Demande de remboursement créée.");else throw new Error(n.message||"Erreur lors de l'annulation")}catch($){console.error("Erreur lors de l'annulation:",$),u.value=$.response?.data?.message||$.message||"Une erreur est survenue lors de l'annulation",window.$toast&&window.$toast.error(u.value)}finally{g.value=!1}}},l=()=>{u.value="",f()};return H(()=>k.show,$=>{$&&A()}),($,n)=>(i(),I(ee,{to:"body"},[r(z,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:N(()=>[p.show?(i(),d("div",wt,[n[17]||(n[17]=e("div",{class:"fixed inset-0 bg-black/40"},null,-1)),e("div",ht,[r(z,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to-class":"opacity-100 translate-y-0 sm:scale-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100 translate-y-0 sm:scale-100","leave-to-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[p.show?(i(),d("div",kt,[g.value?(i(),d("div",$t,n[2]||(n[2]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),e("p",{class:"text-gray-600"},"Annulation en cours...")],-1)]))):x("",!0),u.value?(i(),d("div",Dt,[e("div",Ct,[e("div",Tt,[r(m(X),{class:"h-6 w-6 text-red-600"})]),n[3]||(n[3]=e("div",{class:"ml-3"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Erreur")],-1))]),e("div",jt,[e("p",Mt,a(u.value),1)]),e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:E,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"}," Fermer "),e("button",{onClick:l,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"}," Réessayer ")])])):w.value?(i(),d("div",Pt,[e("div",Et,[e("div",Ft,[r(m(W),{class:"h-6 w-6 text-green-600"})]),n[4]||(n[4]=e("div",{class:"ml-3"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Annulation réussie")],-1))]),n[5]||(n[5]=e("div",{class:"mb-4"},[e("p",{class:"text-sm text-gray-600"}," La tombola a été annulée avec succès. Une demande de remboursement manuel a été créée et nécessite une validation par un administrateur. ")],-1)),e("div",{class:"flex justify-end"},[e("button",{onClick:E,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"}," Fermer ")])])):(i(),d("div",Nt,[e("div",At,[e("div",Lt,[r(m(O),{class:"h-6 w-6 text-red-600"})]),n[6]||(n[6]=e("div",{class:"ml-3"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Annuler la tombola")],-1))]),e("div",qt,[n[13]||(n[13]=e("p",{class:"text-sm text-gray-600 mb-4"}," Êtes-vous sûr de vouloir annuler cette tombola ? Cette action est irréversible. ",-1)),e("div",Vt,[e("div",zt,[e("div",Rt,[r(m(O),{class:"h-5 w-5 text-yellow-400"})]),n[7]||(n[7]=e("div",{class:"ml-3"},[e("h4",{class:"text-sm font-medium text-yellow-800 mb-2"},"Conséquences de l'annulation :"),e("ul",{class:"text-sm text-yellow-700 space-y-1"},[e("li",null,"• La tombola sera marquée comme annulée"),e("li",null,"• Une demande de remboursement manuel sera créée"),e("li",null,"• Les participants seront remboursés après validation admin"),e("li",null,"• Aucun nouveau ticket ne pourra être vendu")])],-1))])]),e("div",St,[n[12]||(n[12]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Informations de la tombola :",-1)),e("div",Ut,[e("p",null,[n[8]||(n[8]=e("span",{class:"font-medium"},"Titre :",-1)),y(" "+a(p.lottery.title),1)]),e("p",null,[n[9]||(n[9]=e("span",{class:"font-medium"},"Tickets vendus :",-1)),y(" "+a(p.lottery.sold_tickets||0),1)]),e("p",null,[n[10]||(n[10]=e("span",{class:"font-medium"},"Participants :",-1)),y(" "+a(p.lottery.participants_count||0),1)]),e("p",null,[n[11]||(n[11]=e("span",{class:"font-medium"},"Revenus générés :",-1)),y(" "+a(P(p.lottery.total_revenue||0)),1)])])])]),e("div",It,[n[15]||(n[15]=e("label",{for:"cancellation-reason",class:"block text-sm font-medium text-gray-700 mb-2"},[y(" Motif d'annulation "),e("span",{class:"text-red-500"},"*")],-1)),B(e("select",{id:"cancellation-reason","onUpdate:modelValue":n[0]||(n[0]=V=>c.value=V),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",required:""},n[14]||(n[14]=[e("option",{value:""},"Sélectionnez un motif",-1),e("option",{value:"technical_issue"},"Problème technique",-1),e("option",{value:"insufficient_participation"},"Participation insuffisante",-1),e("option",{value:"merchant_request"},"Demande du marchand",-1),e("option",{value:"product_unavailable"},"Produit non disponible",-1),e("option",{value:"other"},"Autre",-1)]),512),[[pe,c.value]])]),c.value==="other"?(i(),d("div",Ot,[n[16]||(n[16]=e("label",{for:"custom-reason",class:"block text-sm font-medium text-gray-700 mb-2"},[y(" Motif personnalisé "),e("span",{class:"text-red-500"},"*")],-1)),B(e("textarea",{id:"custom-reason","onUpdate:modelValue":n[1]||(n[1]=V=>b.value=V),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Veuillez préciser le motif d'annulation...",required:""},null,512),[[J,b.value]])])):x("",!0),e("div",Bt,[e("button",{onClick:E,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",disabled:g.value}," Annuler ",8,Gt),e("button",{onClick:f,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",disabled:g.value||!F.value}," Confirmer l'annulation ",8,Wt)])]))])):x("",!0)]),_:1})])])):x("",!0)]),_:1})]))}},Yt={class:"space-y-6"},Zt={class:"flex justify-between items-start"},Ht={class:"flex items-center space-x-3 mb-2"},Kt={class:"text-3xl font-bold text-gray-900"},Qt={class:"flex space-x-3"},Xt={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},es={class:"bg-white p-6 rounded-xl shadow-sm border"},ts={class:"flex items-center"},ss={class:"p-3 bg-blue-100 rounded-lg"},as={class:"ml-4"},os={class:"text-2xl font-bold text-gray-900"},ls={class:"bg-white p-6 rounded-xl shadow-sm border"},ns={class:"flex items-center"},rs={class:"p-3 bg-blue-100 rounded-lg"},is={class:"ml-4"},ds={class:"text-2xl font-bold text-gray-900"},us={class:"bg-white p-6 rounded-xl shadow-sm border"},cs={class:"flex items-center"},ms={class:"p-3 bg-purple-100 rounded-lg"},vs={class:"ml-4"},ps={class:"text-2xl font-bold text-gray-900"},gs={class:"bg-white p-6 rounded-xl shadow-sm border"},xs={class:"flex items-center"},ys={class:"p-3 bg-yellow-100 rounded-lg"},fs={class:"ml-4"},bs={class:"text-2xl font-bold text-gray-900"},_s={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ws={class:"lg:col-span-2 space-y-6"},hs={class:"bg-white rounded-xl shadow-sm border overflow-hidden"},ks={class:"p-6"},$s={class:"flex space-x-6"},Ds={class:"flex-shrink-0"},Cs=["src","alt"],Ts={class:"flex-1"},js={class:"text-xl font-semibold text-gray-900 mb-2"},Ms={class:"text-gray-600 mb-4"},Ps={class:"grid grid-cols-2 gap-4"},Es={class:"text-lg font-semibold text-gray-900"},Fs={class:"text-lg font-semibold text-gray-900"},Ns={class:"text-lg font-semibold text-gray-900"},As={class:"text-lg font-semibold text-gray-900"},Ls={class:"bg-white rounded-xl shadow-sm border"},qs={class:"p-6"},Vs={class:"space-y-4"},zs={class:"flex justify-between items-center mb-2"},Rs={class:"text-sm text-gray-500"},Ss={class:"w-full bg-gray-200 rounded-full h-2"},Us={class:"flex justify-between items-center mb-2"},Is={class:"text-sm text-gray-500"},Os={class:"text-xs text-gray-600"},Bs={key:0},Gs={class:"flex justify-between items-center mb-2"},Ws={class:"text-sm text-gray-500"},Js={class:"w-full bg-gray-200 rounded-full h-2"},Ys={class:"mt-6 grid grid-cols-3 gap-4 text-center"},Zs={class:"p-4 bg-blue-50 rounded-lg"},Hs={class:"text-2xl font-bold text-blue-600"},Ks={class:"p-4 bg-blue-50 rounded-lg"},Qs={class:"text-2xl font-bold text-blue-600"},Xs={class:"p-4 bg-yellow-50 rounded-lg"},ea={class:"text-2xl font-bold text-yellow-600"},ta={key:0,class:"bg-green-50 border border-green-200 rounded-xl p-4"},sa={class:"flex items-center space-x-3"},aa={class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},oa={class:"text-sm text-green-600"},la={key:1,class:"bg-white rounded-xl shadow-sm border"},na={class:"px-6 py-4 border-b border-gray-200"},ra={class:"text-lg font-semibold text-gray-900 flex items-center"},ia={class:"p-6"},da={class:"flex items-center space-x-4"},ua={class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center"},ca={class:"flex-1"},ma={class:"font-semibold text-gray-900"},va={class:"text-sm font-medium text-green-600"},pa={class:"text-sm text-gray-600"},ga={class:"space-y-6"},xa={class:"bg-white rounded-xl shadow-sm border"},ya={class:"p-6 space-y-3"},fa={class:"bg-white rounded-xl shadow-sm border"},ba={class:"px-6 py-4 border-b border-gray-200"},_a={class:"flex justify-between items-center"},wa={class:"p-6"},ha={class:"space-y-3"},ka={class:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"},$a={class:"text-sm font-medium text-gray-600"},Da={class:"flex-1 min-w-0"},Ca={class:"text-sm font-medium text-gray-900 truncate"},Ta={class:"text-xs text-gray-500"},ja={class:"text-sm text-gray-500"},Ma={class:"bg-white rounded-xl shadow-sm border"},Pa={class:"p-6"},Ea={class:"space-y-4"},Fa={class:"flex justify-between"},Na={class:"text-sm font-medium text-gray-900"},Aa={class:"flex justify-between"},La={class:"text-sm font-medium text-gray-900"},qa={class:"flex justify-between"},Va={class:"text-sm font-medium text-gray-900"},za={class:"flex justify-between"},Ra={class:"text-sm font-medium text-blue-600"},Ia={__name:"LotteryView",setup(p){const M=ge(),{get:k}=Y(),s=h({id:M.params.id,title:"",description:"",status:"",product_value:0,ticket_price:0,category:"",participants_count:0,tickets_sold:0,total_revenue:0,max_participants:0,revenue_target:0,end_date:"",created_at:"",views_count:0,winner:null,draw_date:null,product:null,lottery_number:"",max_tickets:0,sold_tickets:0,progress_percentage:0}),C=h([]),g=h(!1),u=h(!1),w=h(!1),c=h(!1),b=D(()=>s.value.max_tickets?Math.min(s.value.sold_tickets/s.value.max_tickets*100,100):0),F=D(()=>s.value.revenue_target?Math.min(s.value.total_revenue/s.value.revenue_target*100,100):0),P=D(()=>!s.value.views_count||s.value.views_count===0?0:(s.value.participants_count/s.value.views_count*100).toFixed(1)),E=D(()=>s.value.participants_count===0?0:s.value.total_revenue/s.value.participants_count),A=D(()=>{const o=s.value.product_value;return((s.value.total_revenue-o)/o*100).toFixed(1)}),f=D(()=>{if(!s.value.end_date)return"Non définie";try{const o=new Date,t=new Date(s.value.end_date);if(isNaN(t.getTime()))return"Date invalide";const _=t-o;if(_<=0)return"Terminée";const v=Math.floor(_/(1e3*60*60*24)),T=Math.floor(_%(1e3*60*60*24)/(1e3*60*60));return v>0?`${v}j ${T}h`:`${T}h`}catch(o){return console.error("Error calculating time remaining:",o),"Erreur de calcul"}}),l=D(()=>{if(!s.value.end_date)return 0;try{const o=new Date,t=new Date(s.value.end_date);if(isNaN(t.getTime()))return 0;const _=t-o;return _<=0?0:Math.ceil(_/(1e3*60*60*24))}catch(o){return console.error("Error calculating days remaining:",o),0}}),$=D(()=>{try{const o=s.value.status==="active",t=!s.value.winning_ticket_number,_=s.value.sold_tickets>=s.value.max_tickets;let v=!1;if(s.value.draw_date){const T=new Date(s.value.draw_date);isNaN(T.getTime())||(v=T<=new Date)}return o&&t&&(_||v)}catch(o){return console.error("Error calculating canDraw:",o),!1}}),n=D(()=>{try{const o=s.value.status==="active",t=!s.value.winning_ticket_number,_=s.value.sold_tickets>=s.value.max_tickets;let v=!1;if(s.value.draw_date){const T=new Date(s.value.draw_date);isNaN(T.getTime())||(v=T>new Date)}return o&&t&&_&&v}catch(o){return console.error("Error calculating canDrawManually:",o),!1}}),V=o=>({active:"Active",completed:"Terminée",pending:"En attente",paused:"En pause",cancelled:"Annulée"})[o]||o,L=o=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o||0)+" FCFA",G=o=>{if(!o)return"Non définie";try{const t=new Date(o);return isNaN(t.getTime())?"Date invalide":new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return console.error("Error formatting date:",t),"Erreur de format"}},te=()=>{const o=`${window.location.origin}/lottery/${s.value.id}`;navigator.clipboard.writeText(o),window.$toast&&window.$toast.success("Lien de partage copié dans le presse-papiers!","✅ Partage")},se=()=>{window.$toast&&window.$toast.info("Fonctionnalité de téléchargement en cours de développement","🚀 En développement")},ae=()=>{window.$toast&&window.$toast.info("Mise en pause de la tombola...","⏸️ Pause")},oe=()=>{g.value=!0},le=o=>{console.log("Tirage terminé:",o),o&&o.success&&o.lottery&&(s.value={...s.value,...o.lottery,status:"completed",is_drawn:!0,winner_user_id:o.winning_ticket?.user_id,winning_ticket_number:o.winning_ticket?.ticket_number,winner:o.winning_ticket?.user,draw_date:new Date().toISOString()}),setTimeout(()=>{S()},1e3),setTimeout(()=>{g.value=!1},3e3)},ne=()=>{u.value=!1,S()},re=()=>{c.value=!1,S()},S=async()=>{try{const o=await k(`/lotteries/${M.params.id}`);if(o?.lottery){const t=o.lottery;console.log("LotteryData:",t),console.log("Available keys:",Object.keys(t));const _=new Set,v=t.paid_tickets||t.paidTickets||t.tickets||[];console.log("PaidTickets:",v),console.log("PaidTickets length:",v.length),v.forEach(j=>{j.user?.id&&_.add(j.user.id)});const T=_.size,ie=(t.sold_tickets||0)*(t.ticket_price||0),U=new Map;v.forEach(j=>{if(j.user?.id){const q=j.user.id,ue=`${j.user.first_name||""} ${j.user.last_name||""}`.trim();U.has(q)?U.get(q).tickets_count++:U.set(q,{id:q,name:ue||"Utilisateur anonyme",participated_at:j.created_at||new Date().toISOString(),tickets_count:1})}});const de=Array.from(U.values()).sort((j,q)=>new Date(q.participated_at)-new Date(j.participated_at)).slice(0,5);s.value={...s.value,id:t.id,title:t.title,description:t.description||"",status:t.status,lottery_number:t.lottery_number,ticket_price:t.ticket_price||0,max_tickets:t.max_tickets||0,sold_tickets:t.sold_tickets||0,progress_percentage:t.progress_percentage||0,draw_date:t.draw_date,created_at:t.created_at,tickets_sold:t.sold_tickets||0,participants_count:T,total_revenue:ie,max_participants:t.max_tickets||0,end_date:t.draw_date,revenue_target:t.revenue_target||null,views_count:t.views_count||0,product:t.product,product_value:t.product?.price||0,category:t.product?.category?.name||"",winner:t.winner||null,winning_ticket_number:t.winning_ticket_number||null},C.value=de}}catch(o){console.error("Erreur lors du chargement de la tombola:",o),window.$toast&&window.$toast.error("Erreur lors du chargement des données de la tombola")}};return xe(()=>{S()}),(o,t)=>{const _=ye("router-link");return i(),d("div",Yt,[e("div",Zt,[e("div",null,[e("div",Ht,[r(_,{to:"/merchant/lotteries",class:"text-gray-500 hover:text-gray-700"},{default:N(()=>[r(m(Ee),{class:"w-5 h-5"})]),_:1}),e("h1",Kt,a(s.value.title),1),e("span",{class:fe(["px-3 py-1 rounded-full text-sm font-medium",s.value.status==="active"||s.value.status==="completed"?"bg-blue-100 text-blue-800":s.value.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},a(V(s.value.status)),3)]),t[7]||(t[7]=e("p",{class:"text-gray-600"},"Gérez votre tombola et suivez les participations",-1))]),e("div",Qt,[s.value.status==="active"?(i(),d("button",{key:0,onClick:t[0]||(t[0]=v=>u.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 whitespace-nowrap"},[r(m(be),{class:"w-4 h-4 flex-shrink-0"}),t[8]||(t[8]=y(" Prolonger ",-1))])):x("",!0),s.value.status==="active"&&$.value?(i(),d("button",{key:1,onClick:t[1]||(t[1]=v=>g.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 whitespace-nowrap"},[r(m(R),{class:"w-4 h-4 flex-shrink-0"}),t[9]||(t[9]=y(" Effectuer le tirage ",-1))])):x("",!0),s.value.status==="active"?(i(),d("button",{key:2,onClick:t[2]||(t[2]=v=>c.value=!0),class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2 whitespace-nowrap"},[r(m(K),{class:"w-4 h-4 flex-shrink-0"}),t[10]||(t[10]=y(" Annuler ",-1))])):x("",!0),s.value.status!=="completed"?(i(),d("button",{key:3,onClick:t[3]||(t[3]=v=>w.value=!0),class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center gap-2 whitespace-nowrap"},[r(m(_e),{class:"w-4 h-4 flex-shrink-0"}),t[11]||(t[11]=y(" Modifier ",-1))])):x("",!0)])]),e("div",Xt,[e("div",es,[e("div",ts,[e("div",ss,[r(m(we),{class:"w-6 h-6 text-blue-600"})]),e("div",as,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Participants",-1)),e("p",os,a(s.value.participants_count),1)])])]),e("div",ls,[e("div",ns,[e("div",rs,[r(m(he),{class:"w-6 h-6 text-blue-600"})]),e("div",is,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Revenus générés",-1)),e("p",ds,a(L(s.value.total_revenue)),1)])])]),e("div",us,[e("div",cs,[e("div",ms,[r(m(ke),{class:"w-6 h-6 text-purple-600"})]),e("div",vs,[t[14]||(t[14]=e("p",{class:"text-sm font-medium text-gray-600"},"Tickets vendus",-1)),e("p",ps,a(s.value.tickets_sold),1)])])]),e("div",gs,[e("div",xs,[e("div",ys,[r(m($e),{class:"w-6 h-6 text-yellow-600"})]),e("div",fs,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-600"},"Temps restant",-1)),e("p",bs,a(f.value),1)])])])]),e("div",_s,[e("div",ws,[e("div",hs,[t[20]||(t[20]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Informations du produit")],-1)),e("div",ks,[e("div",$s,[e("div",Ds,[e("img",{src:s.value.product?.image_url||s.value.product?.main_image||s.value.product?.image||"/images/products/placeholder.jpg",alt:s.value.title,class:"w-32 h-32 object-cover rounded-lg"},null,8,Cs)]),e("div",Ts,[e("h4",js,a(s.value.title),1),e("p",Ms,a(s.value.description),1),e("div",Ps,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-500"},"Valeur du produit",-1)),e("p",Es,a(L(s.value.product_value)),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-500"},"Prix du ticket",-1)),e("p",Fs,a(L(s.value.ticket_price)),1)]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-500"},"Catégorie",-1)),e("p",Ns,a(s.value.category?.name||s.value.category||"Sans catégorie"),1)]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-500"},"Date de fin",-1)),e("p",As,a(G(s.value.end_date)),1)])])])])])]),e("div",Ls,[t[27]||(t[27]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Progression")],-1)),e("div",qs,[e("div",Vs,[e("div",null,[e("div",zs,[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-gray-700"},"Objectif de tickets",-1)),e("span",Rs,a(s.value.sold_tickets)+" / "+a(s.value.max_tickets),1)]),e("div",Ss,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Z({width:b.value+"%"})},null,4)])]),e("div",null,[e("div",Us,[t[22]||(t[22]=e("span",{class:"text-sm font-medium text-gray-700"},"Participants uniques",-1)),e("span",Is,a(s.value.participants_count)+" personnes",1)]),e("div",Os," Moyenne: "+a(s.value.participants_count>0?(s.value.sold_tickets/s.value.participants_count).toFixed(1):0)+" tickets/personne ",1)]),s.value.revenue_target?(i(),d("div",Bs,[e("div",Gs,[t[23]||(t[23]=e("span",{class:"text-sm font-medium text-gray-700"},"Objectif de revenus",-1)),e("span",Ws,a(L(s.value.total_revenue))+" / "+a(L(s.value.revenue_target)),1)]),e("div",Js,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Z({width:F.value+"%"})},null,4)])])):x("",!0)]),e("div",Ys,[e("div",Zs,[e("p",Hs,a(b.value)+"%",1),t[24]||(t[24]=e("p",{class:"text-sm text-blue-600"},"Tickets vendus",-1))]),e("div",Ks,[e("p",Qs,a(P.value)+"%",1),t[25]||(t[25]=e("p",{class:"text-sm text-blue-600"},"Conversion",-1))]),e("div",Xs,[e("p",ea,a(l.value),1),t[26]||(t[26]=e("p",{class:"text-sm text-yellow-600"},"Jours restants",-1))])])])]),n.value?(i(),d("div",ta,[e("div",sa,[e("div",aa,[r(m(R),{class:"w-5 h-5 text-green-600"})]),e("div",null,[t[28]||(t[28]=e("h4",{class:"text-md font-semibold text-green-800"},"Tirage possible !",-1)),e("p",oa," Tous les tickets sont vendus ("+a(s.value.sold_tickets)+"/"+a(s.value.max_tickets)+'). Vous pouvez effectuer le tirage maintenant dans "Actions rapides". ',1)])])])):x("",!0),s.value.winner?(i(),d("div",la,[e("div",na,[e("h3",ra,[r(m(Q),{class:"w-5 h-5 text-yellow-500 mr-2"}),t[29]||(t[29]=y(" Gagnant ",-1))])]),e("div",ia,[e("div",da,[e("div",ua,[r(m(De),{class:"w-6 h-6 text-yellow-600"})]),e("div",ca,[e("p",ma,a(s.value.winner.first_name)+" "+a(s.value.winner.last_name),1),e("p",va,"Ticket N° "+a(s.value.winning_ticket_number),1),e("p",pa,"Tirage effectué le "+a(G(s.value.draw_date)),1)])]),t[30]||(t[30]=e("div",{class:"mt-4 p-4 bg-yellow-50 rounded-lg"},[e("p",{class:"text-sm text-yellow-800"}," Félicitations ! Le gagnant a été contacté automatiquement par email. ")],-1))])])):x("",!0)]),e("div",ga,[e("div",xa,[t[35]||(t[35]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Actions rapides")],-1)),e("div",ya,[e("button",{onClick:te,class:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},[r(m(Ce),{class:"w-4 h-4"}),t[31]||(t[31]=y(" Partager la tombola ",-1))]),e("button",{onClick:se,class:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"},[r(m(Te),{class:"w-4 h-4"}),t[32]||(t[32]=y(" Télécharger le rapport ",-1))]),n.value?(i(),d("button",{key:0,onClick:oe,class:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"},[r(m(R),{class:"w-4 h-4"}),t[33]||(t[33]=y(" Effectuer le tirage maintenant ",-1))])):x("",!0),s.value.status==="active"?(i(),d("button",{key:1,onClick:ae,class:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"},[r(m(je),{class:"w-4 h-4"}),t[34]||(t[34]=y(" Mettre en pause ",-1))])):x("",!0)])]),e("div",fa,[e("div",ba,[e("div",_a,[t[37]||(t[37]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Participants récents",-1)),r(_,{to:`/merchant/lotteries/${s.value.id}/participants`,class:"text-sm text-blue-600 hover:text-blue-700"},{default:N(()=>t[36]||(t[36]=[y(" Voir tout ",-1)])),_:1,__:[36]},8,["to"])])]),e("div",wa,[e("div",ha,[(i(!0),d(Me,null,Pe(C.value,v=>(i(),d("div",{key:v.id,class:"flex items-center space-x-3"},[e("div",ka,[e("span",$a,a(v.name.charAt(0)),1)]),e("div",Da,[e("p",Ca,a(v.name),1),e("p",Ta,a(G(v.participated_at)),1)]),e("div",ja,a(v.tickets_count)+" ticket"+a(v.tickets_count>1?"s":""),1)]))),128))])])]),e("div",Ma,[t[42]||(t[42]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Statistiques")],-1)),e("div",Pa,[e("div",Ea,[e("div",Fa,[t[38]||(t[38]=e("span",{class:"text-sm text-gray-600"},"Vues de la tombola",-1)),e("span",Na,a(s.value.views_count||"N/A"),1)]),e("div",Aa,[t[39]||(t[39]=e("span",{class:"text-sm text-gray-600"},"Taux de conversion",-1)),e("span",La,a(P.value)+"%",1)]),e("div",qa,[t[40]||(t[40]=e("span",{class:"text-sm text-gray-600"},"Panier moyen",-1)),e("span",Va,a(L(E.value)),1)]),e("div",za,[t[41]||(t[41]=e("span",{class:"text-sm text-gray-600"},"Retour sur investissement",-1)),e("span",Ra,"+"+a(A.value)+"%",1)])])])])])]),r(pt,{show:g.value,lottery:s.value,onClose:t[4]||(t[4]=v=>g.value=!1),onDrawn:le},null,8,["show","lottery"]),u.value?(i(),I(_t,{key:0,lottery:s.value,onClose:t[5]||(t[5]=v=>u.value=!1),onExtended:ne},null,8,["lottery"])):x("",!0),c.value?(i(),I(Jt,{key:1,show:c.value,lottery:s.value,onClose:t[6]||(t[6]=v=>c.value=!1),onCancelled:re},null,8,["show","lottery"])):x("",!0)])}}};export{Ia as default};
