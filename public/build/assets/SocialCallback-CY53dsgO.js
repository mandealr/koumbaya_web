import{r as d,j as f,L as h,s as k,b as l,e as t,l as v,g as b,t as x,w as y,h as w,o as c,i as g}from"./vendor-dZUSqucC.js";import{u as _}from"./app-COGsnlno.js";const j={class:"min-h-screen bg-gradient-to-br from-koumbaya-primary/5 via-white to-koumbaya-primary/10 flex items-center justify-center"},B={class:"text-center"},C={key:0,class:"mb-4"},S={key:1,class:"max-w-md mx-auto p-8 bg-white rounded-xl shadow-lg"},R={class:"text-gray-600 mb-6"},E={__name:"SocialCallback",setup(T){const i=h(),m=k(),u=_(),n=d(!0),o=d(null);return f(async()=>{const s=i.query.token,e=i.query.error;if(i.query.provider,e){o.value=e,n.value=!1;return}if(!s){o.value="Token manquant",n.value=!1;return}try{localStorage.setItem("token",s);const r=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}});if(!r.ok)throw new Error("Impossible de récupérer les informations utilisateur");const a=await r.json();if(a.success&&a.user)u.setUser(a.user),u.setToken(s),window.$toast&&window.$toast.success(`Bienvenue ${a.user.first_name||a.user.name} !`,"✅ Connexion réussie"),setTimeout(()=>{const p=u.getDefaultRedirect();m.push({name:p})},1e3);else throw new Error("Réponse invalide du serveur")}catch(r){console.error("Social auth callback error:",r),o.value=r.message||"Une erreur est survenue",n.value=!1}}),(s,e)=>{const r=w("router-link");return c(),l("div",j,[t("div",B,[n.value?(c(),l("div",C,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-4 border-koumbaya-primary border-t-transparent mx-auto"},null,-1),t("p",{class:"mt-4 text-lg text-gray-700"},"Authentification en cours...",-1)]))):o.value?(c(),l("div",S,[e[2]||(e[2]=t("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[3]||(e[3]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Erreur d'authentification",-1)),t("p",R,x(o.value),1),b(r,{to:"/login",class:"inline-block px-6 py-3 bg-koumbaya-primary text-white rounded-lg hover:bg-koumbaya-primary-dark transition-colors"},{default:y(()=>e[1]||(e[1]=[g(" Retour à la connexion ",-1)])),_:1,__:[1]})])):v("",!0)])])}}};export{E as default};
