import{c as q,s as te,r as b,x as D,g as re,b as i,j as p,e as t,i as c,t as m,w as P,k as se,F as E,A as f,B as v,E as L,u as d,n as j,z,l as _,m as oe,o as a}from"./vendor-CTxEzfV9.js";import{a as ie,x as ae,y as le,A as ne,z as A,q as N}from"./app-CPHMr4Go.js";const de={class:"max-w-4xl mx-auto space-y-6"},ue={key:0,class:"flex justify-center items-center py-12"},ce={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-6 text-center"},pe={class:"text-red-600"},me={class:"flex items-center justify-between"},ge={class:"mt-2 text-gray-600"},xe={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},be={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ye={class:"lg:col-span-2"},fe={key:0,class:"mt-1 text-sm text-red-600"},ve={class:"lg:col-span-2"},_e={key:0,class:"mt-1 text-sm text-red-600"},he=["disabled"],we={key:0,disabled:""},ke=["value"],Ee={key:0,class:"mt-1 text-sm text-red-600"},Ce={key:0,class:"mt-1 text-sm text-red-600"},Fe={class:"lg:col-span-2"},$e={key:0,class:"mt-1 text-sm text-red-600"},Pe={key:1,class:"mt-1 text-sm text-orange-600"},je={key:2,class:"text-sm text-gray-700 mt-1"},ze={key:0},Ae={key:0,class:"mt-1 text-sm text-red-600"},Ie={key:1,class:"text-sm text-gray-700 mt-1"},Ve={key:0,class:"mt-1 text-sm text-red-600"},Me={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Se={key:0,class:"mb-6"},Ue={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},qe=["src","alt"],De=["onClick"],Le={class:"text-center"},Ne={key:1,class:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6"},Re=["src","alt"],Be=["onClick"],Te={class:"bg-blue-50 border border-blue-200 rounded-xl p-4 mt-6"},Ge={class:"flex items-start space-x-3"},Oe={class:"flex justify-between items-center bg-white rounded-xl shadow-lg border border-gray-100 p-6"},We=["disabled"],Je={key:0,class:"flex items-center"},He={key:1,class:"flex items-center"},Ye={__name:"EditProduct",setup(Ke){const R=oe(),B=te(),{get:I,put:T,loading:h}=ie(),V=q(()=>B.params.id),w=b(!1),C=b(!0),M=b(!1),g=b(""),y=b(null),k=b(null),S=b([]),x=b([]),r=D({name:"",description:"",category_id:"",condition:"",sale_mode:"direct",price:"",ticket_price:"",location:"",images:[]}),l=D({name:"",description:"",category_id:"",condition:"",price:"",ticket_price:"",location:"",images:""}),G=q(()=>r.name&&r.description&&r.category_id&&r.condition&&r.price&&parseFloat(r.price)>=1e3&&(!y.value||y.value.sale_mode!=="lottery"||r.ticket_price&&parseFloat(r.ticket_price)>=100)),O=async()=>{try{C.value=!0,g.value="";const s=await I("/products?my_products=1");if(s&&s.data&&s.data.products){const e=s.data.products.find(n=>n.id.toString()===V.value.toString());e?(y.value=e,r.name=e.name||"",r.description=e.description||"",r.category_id=e.category_id||"",r.condition=e.condition||"",r.sale_mode=e.sale_mode||"direct",r.price=e.price||"",r.ticket_price=e.ticket_price||"",r.location=e.location||"",e.images&&Array.isArray(e.images)?x.value=[...e.images]:e.main_image?x.value=[e.main_image]:e.image_url&&(x.value=[e.image_url]),M.value=!0):g.value="Ce produit n'existe pas ou ne vous appartient pas"}else g.value="Erreur lors du chargement des produits"}catch(s){console.error("Error loading product:",s),s.response?.status===404?g.value="Produit non trouvé":s.response?.status===403?g.value="Vous n'êtes pas autorisé à modifier ce produit":g.value=`Erreur lors du chargement du produit: ${s.message}`}finally{C.value=!1}},W=async()=>{try{const s=await I("/categories");s.categories&&(S.value=s.categories)}catch(s){console.error("Error loading categories:",s)}},J=()=>{k.value?.click()},H=s=>{const e=Array.from(s.target.files||[]);U(e)},K=s=>{const e=Array.from(s.dataTransfer.files||[]);U(e)},U=s=>{const e=s.filter(o=>o.type.startsWith("image/")?o.size>5242880?(console.error(`Le fichier ${o.name} est trop volumineux (max 5MB)`),!1):!0:(console.error(`Le fichier ${o.name} n'est pas une image valide`),!1));if(x.value.length+r.images.length+e.length>10){console.error("Maximum 10 images autorisées");return}e.forEach(o=>{const u=new FileReader;u.onload=$=>{r.images.push({file:o,preview:$.target?.result,name:o.name,size:o.size,type:o.type})},u.onerror=()=>{console.error(`Erreur lors de la lecture du fichier ${o.name}`)},u.readAsDataURL(o)}),k.value&&(k.value.value="")},Q=s=>{r.images.splice(s,1)},X=s=>{x.value.splice(s,1)},Y=async()=>{w.value=!0,Z();try{const s={name:r.name,description:r.description,category_id:parseInt(r.category_id),price:parseFloat(r.price),condition:r.condition,location:r.location};y.value.sale_mode==="lottery"&&r.ticket_price&&(s.ticket_price=parseFloat(r.ticket_price));const e=[...x.value,...r.images.map(o=>o.preview)];e.length>0&&(s.images=e);const n=await T(`/products/${V.value}`,s);n&&(n.product||n.success)&&(window.$toast&&window.$toast.success("Produit modifié avec succès !","✅ Succès"),setTimeout(()=>{R.push("/merchant/products")},1500))}catch(s){console.error("Error updating product:",s),ee(s)}finally{w.value=!1}},Z=()=>{Object.keys(l).forEach(s=>{l[s]=""})},ee=s=>{if(s.response?.data?.errors){const e=s.response.data.errors;Object.keys(e).forEach(n=>{l[n]!==void 0&&(l[n]=e[n][0])}),F("Veuillez corriger les erreurs dans le formulaire")}else s.response?.data?.message?F(s.response.data.message):F("Une erreur est survenue. Veuillez réessayer.")},F=s=>{window.$toast&&window.$toast.error(s,"❌ Erreur")};return re(async()=>{await Promise.all([O(),W()])}),(s,e)=>{const n=se("router-link");return a(),i("div",de,[C.value?(a(),i("div",ue,e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0099cc]"},null,-1),t("span",{class:"ml-3 text-gray-600"},"Chargement du produit...",-1)]))):g.value?(a(),i("div",ce,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Erreur",-1)),t("p",pe,m(g.value),1),c(n,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors mt-4"},{default:P(()=>[c(d(A),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=_(" Retour aux produits ",-1))]),_:1,__:[9]})])):M.value&&y.value?(a(),i(E,{key:2},[t("div",me,[t("div",null,[e[11]||(e[11]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Modifier le Produit",-1)),t("p",ge,'Modifiez les informations de "'+m(y.value.name)+'"',1)]),c(n,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},{default:P(()=>[c(d(A),{class:"w-4 h-4 mr-2"}),e[12]||(e[12]=_(" Retour aux produits ",-1))]),_:1,__:[12]})]),t("form",{onSubmit:z(Y,["prevent"]),class:"space-y-6"},[t("div",xe,[e[22]||(e[22]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Informations de base",-1)),t("div",be,[t("div",ye,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Nom du produit * ",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.name=o),type:"text",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: iPhone 15 Pro Max 256GB"},null,512),[[v,r.name]]),l.name?(a(),i("p",fe,m(l.name),1)):p("",!0)]),t("div",ve,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Description * ",-1)),f(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.description=o),rows:"4",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Décrivez votre produit en détail..."},null,512),[[v,r.description]]),l.description?(a(),i("p",_e,m(l.description),1)):p("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Catégorie * ",-1)),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.category_id=o),required:"",disabled:d(h),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all disabled:opacity-50 text-gray-900"},[e[15]||(e[15]=t("option",{value:""},"Sélectionner une catégorie",-1)),d(h)?(a(),i("option",we,"Chargement des catégories...")):p("",!0),(a(!0),i(E,null,j(S.value,o=>(a(),i("option",{key:o.id,value:o.id},m(o.name),9,ke))),128))],8,he),[[L,r.category_id]]),l.category_id?(a(),i("p",Ee,m(l.category_id),1)):p("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Condition * ",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.condition=o),required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900"},e[17]||(e[17]=[t("option",{value:""},"État du produit",-1),t("option",{value:"new"},"Neuf",-1),t("option",{value:"used"},"Occasion",-1),t("option",{value:"refurbished"},"Reconditionné",-1)]),512),[[L,r.condition]]),l.condition?(a(),i("p",Ce,m(l.condition),1)):p("",!0)]),t("div",Fe,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Valeur du produit (FCFA) * ",-1)),f(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.price=o),type:"number",required:"",min:"1000",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: 850000"},null,512),[[v,r.price]]),l.price?(a(),i("p",$e,m(l.price),1)):r.price&&parseFloat(r.price)<1e3?(a(),i("p",Pe,"Le prix minimum est de 1000 FCFA")):(a(),i("p",je,"Prix de vente ou valeur estimée du produit"))]),y.value.sale_mode==="lottery"?(a(),i("div",ze,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Prix par ticket (FCFA) * ",-1)),f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.ticket_price=o),type:"number",required:"",min:"100",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: 2500"},null,512),[[v,r.ticket_price]]),l.ticket_price?(a(),i("p",Ae,m(l.ticket_price),1)):(a(),i("p",Ie,"Prix que paieront les participants"))])):p("",!0),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-800 mb-2"}," Localisation ",-1)),f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.location=o),type:"text",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all text-gray-900",placeholder:"Ex: Abidjan, Cocody"},null,512),[[v,r.location]]),l.location?(a(),i("p",Ve,m(l.location),1)):p("",!0)])])]),t("div",Me,[e[28]||(e[28]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Images du produit",-1)),x.value.length>0?(a(),i("div",Se,[e[23]||(e[23]=t("h3",{class:"text-sm font-medium text-gray-800 mb-3"},"Images actuelles",-1)),t("div",Ue,[(a(!0),i(E,null,j(x.value,(o,u)=>(a(),i("div",{key:`existing-${u}`,class:"relative group"},[t("img",{src:(o.startsWith("data:"),o),alt:`Image ${u+1}`,class:"w-full h-32 object-cover rounded-xl border border-gray-200"},null,8,qe),t("button",{onClick:$=>X(u),type:"button",class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[c(d(N),{class:"w-4 h-4"})],8,De)]))),128))])])):p("",!0),t("div",Le,[t("div",{onClick:J,onDragover:e[7]||(e[7]=z(()=>{},["prevent"])),onDrop:z(K,["prevent"]),class:"border-2 border-dashed border-gray-300 rounded-xl p-8 hover:border-[#0099cc] transition-colors cursor-pointer"},[c(d(ae),{class:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e[24]||(e[24]=t("p",{class:"text-lg font-medium text-gray-700 mb-2"},"Ajouter de nouvelles photos",-1)),e[25]||(e[25]=t("p",{class:"text-sm text-gray-700 mb-4"},"Glissez-déposez ou cliquez pour sélectionner",-1)),e[26]||(e[26]=t("div",{class:"flex justify-center"},[t("span",{class:"bg-[#0099cc] text-white px-6 py-2 rounded-lg font-medium hover:bg-[#0088bb] transition-colors"}," Choisir des fichiers ")],-1))],32),t("input",{ref_key:"fileInput",ref:k,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:H,class:"hidden"},null,544)]),r.images.length>0?(a(),i("div",Ne,[(a(!0),i(E,null,j(r.images,(o,u)=>(a(),i("div",{key:`new-${u}`,class:"relative group"},[t("img",{src:o.preview,alt:`Nouvelle image ${u+1}`,class:"w-full h-32 object-cover rounded-xl border border-gray-200"},null,8,Re),t("button",{onClick:$=>Q(u),type:"button",class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[c(d(N),{class:"w-4 h-4"})],8,Be)]))),128))])):p("",!0),t("div",Te,[t("div",Ge,[c(d(le),{class:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e[27]||(e[27]=t("div",{class:"text-sm text-blue-700"},[t("p",{class:"font-medium mb-1"},"Conseils pour de bonnes photos :"),t("ul",{class:"space-y-1 text-sm"},[t("li",null,"• Les images existantes seront conservées si vous n'ajoutez pas de nouvelles images"),t("li",null,"• Utilisez un bon éclairage naturel"),t("li",null,"• Prenez plusieurs angles du produit"),t("li",null,"• Maximum 10 images par produit"),t("li",null,"• Formats acceptés : JPG, PNG, WebP"),t("li",null,"• Taille maximum : 5MB par image")])],-1))])])]),t("div",Oe,[c(n,{to:"/merchant/products",class:"inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},{default:P(()=>[c(d(A),{class:"w-4 h-4 mr-2"}),e[29]||(e[29]=_(" Annuler ",-1))]),_:1,__:[29]}),t("button",{type:"submit",disabled:w.value||!G.value||d(h),class:"inline-flex items-center px-6 py-3 bg-[#0099cc] hover:bg-[#0088bb] disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors"},[w.value||d(h)?(a(),i("span",Je,e[30]||(e[30]=[t("div",{class:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"},null,-1),_(" Modification... ",-1)]))):(a(),i("span",He,[c(d(ne),{class:"w-4 h-4 mr-2"}),e[31]||(e[31]=_(" Enregistrer les modifications ",-1))]))],8,We)])],32)],64)):p("",!0)])}}};export{Ye as default};
