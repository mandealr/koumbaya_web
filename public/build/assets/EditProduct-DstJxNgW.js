import{c as q,s as ue,r as f,x as B,g as ce,b as i,j as a,e as t,i as m,t as p,w as N,k as pe,F as C,n as P,A as y,B as $,E as R,u,q as x,Q as T,z as M,l as w,m as me,o as l,p as ge,v as be}from"./vendor-CTxEzfV9.js";import{a as fe,x as G,y as O,z as F,B as ye,A as xe,q as W}from"./app-BMePXE-1.js";const ve={class:"max-w-4xl mx-auto space-y-6"},he={key:0,class:"flex justify-center items-center py-12"},we={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-6 text-center"},_e={class:"text-red-600"},ke={class:"flex items-center justify-between"},Ee={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Ce={class:"flex items-center justify-between mb-8"},je={class:"flex items-center"},Pe={key:1},$e={class:"ml-3"},ze={class:"text-xs text-gray-700"},Ve={key:0,class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Ie={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Me={class:"lg:col-span-2"},Fe={key:0,class:"mt-1 text-sm text-red-600"},Se={class:"lg:col-span-2"},Ae={key:0,class:"mt-1 text-sm text-red-600"},De=["disabled"],Le={key:0,disabled:""},Ue=["value"],qe={key:0,class:"mt-1 text-sm text-red-600"},Be={class:"lg:col-span-2"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"flex items-center space-x-3"},Te={key:0,class:"w-2.5 h-2.5 bg-[#0099cc] rounded-full"},Ge={class:"flex items-center space-x-3"},Oe={key:0,class:"w-2.5 h-2.5 bg-purple-500 rounded-full"},We={key:0,class:"mt-1 text-sm text-red-600"},Je={key:1,class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Qe={class:"space-y-6"},He={key:0,class:"space-y-4"},Ke={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Xe=["src","alt"],Ye=["onClick"],Ze={key:0,class:"absolute bottom-2 left-2 bg-[#0099cc] text-white text-xs px-2 py-1 rounded-md"},et={class:"text-center"},tt={key:1,class:"space-y-4"},st={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},rt=["src","alt"],ot=["onClick"],lt={class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},it={class:"flex items-start space-x-3"},at={class:"flex justify-between items-center bg-white rounded-xl shadow-lg border border-gray-100 p-6"},nt={key:1},dt={class:"text-sm text-gray-700"},ut=["disabled"],ct=["disabled"],pt={key:0,class:"flex items-center"},mt={key:1,class:"flex items-center"},yt={__name:"EditProduct",setup(gt){const J=me(),Q=ue(),{get:S,put:H,loading:_}=fe(),A=q(()=>Q.params.id),n=f(1),k=f(!1),z=f(!0),D=f(!1),E=f(""),j=f(null),v=[{id:1,title:"Informations",description:"Détails du produit",icon:O},{id:2,title:"Photos",description:"Images du produit",icon:G}],L=f([]),h=f([]),s=B({name:"",description:"",category_id:"",condition:"",sale_mode:"direct",price:"",location:"",images:[]}),c=B({name:"",description:"",category_id:"",condition:"",price:"",location:"",images:""}),V=q(()=>{switch(n.value){case 1:return K();case 2:return!0;default:return!1}}),K=()=>s.name&&s.description&&s.category_id&&s.condition&&s.sale_mode&&s.price&&s.location&&parseFloat(s.price)>=1e3,X=()=>{V.value&&n.value<v.length&&n.value++},Y=()=>{n.value>1&&n.value--},Z=async()=>{try{z.value=!0,E.value="";const o=await S(`/products/${A.value}`);if(o&&o.product){const e=o.product;s.name=e.name||"",s.description=e.description||"",s.category_id=e.category_id||"",s.condition=e.condition||"",s.sale_mode=e.sale_mode||"direct",s.price=e.price||"",s.location=e.location||"",e.images&&Array.isArray(e.images)?h.value=[...e.images]:e.main_image&&(h.value=[e.main_image]),D.value=!0}else E.value="Produit non trouvé"}catch(o){console.error("Error loading product:",o),E.value="Erreur lors du chargement du produit"}finally{z.value=!1}},ee=async()=>{try{const o=await S("/categories");o.categories&&(L.value=o.categories)}catch(o){console.error("Error loading categories:",o),b("Erreur lors du chargement des catégories")}},te=()=>{j.value?.click()},se=o=>{const e=Array.from(o.target.files||[]);U(e)},re=o=>{const e=Array.from(o.dataTransfer.files||[]);U(e)},U=o=>{const e=o.filter(r=>r.type.startsWith("image/")?r.size>5242880?(b(`Le fichier ${r.name} est trop volumineux (max 5MB)`),!1):!0:(b(`Le fichier ${r.name} n'est pas une image valide`),!1));if(h.value.length+s.images.length+e.length>10){b("Maximum 10 images autorisées");return}e.forEach(r=>{const d=new FileReader;d.onload=I=>{s.images.push({file:r,preview:I.target?.result,name:r.name,size:r.size,type:r.type})},d.onerror=()=>{b(`Erreur lors de la lecture du fichier ${r.name}`)},d.readAsDataURL(r)}),j.value&&(j.value.value="")},oe=o=>{s.images.splice(o,1)},le=o=>{h.value.splice(o,1)},ie=async()=>{k.value=!0,ae();try{const o={name:s.name,description:s.description,category_id:parseInt(s.category_id),price:parseFloat(s.price),condition:s.condition,location:s.location,sale_mode:s.sale_mode},e=[...h.value,...s.images.map(r=>r.preview)];e.length>0&&(o.images=e);const g=await H(`/products/${A.value}`,o);(g.product||g.success)&&(de("Produit modifié avec succès !"),setTimeout(()=>{J.push("/merchant/products")},1500))}catch(o){console.error("Error updating product:",o),ne(o)}finally{k.value=!1}},ae=()=>{Object.keys(c).forEach(o=>{c[o]=""})},ne=o=>{if(o.response?.data?.errors){const e=o.response.data.errors;Object.keys(e).forEach(g=>{c[g]!==void 0&&(c[g]=e[g][0])}),b("Veuillez corriger les erreurs dans le formulaire")}else o.response?.data?.message?b(o.response.data.message):b("Une erreur est survenue. Veuillez réessayer.")},de=o=>{window.$toast&&window.$toast.success(o,"✅ Succès")},b=o=>{window.$toast&&window.$toast.error(o,"❌ Erreur")};return ce(async()=>{await Promise.all([Z(),ee()])}),(o,e)=>{const g=pe("router-link");return l(),i("div",ve,[z.value?(l(),i("div",he,e[9]||(e[9]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0099cc]"},null,-1),t("span",{class:"ml-3 text-gray-600"},"Chargement du produit...",-1)]))):E.value?(l(),i("div",we,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Erreur",-1)),t("p",_e,p(E.value),1),m(g,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors mt-4"},{default:N(()=>[m(u(F),{class:"w-4 h-4 mr-2"}),e[10]||(e[10]=w(" Retour aux produits ",-1))]),_:1,__:[10]})])):D.value?(l(),i(C,{key:2},[t("div",ke,[e[13]||(e[13]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Modifier le Produit"),t("p",{class:"mt-2 text-gray-600"},"Modifiez les informations de votre produit")],-1)),m(g,{to:"/merchant/products",class:"inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},{default:N(()=>[m(u(F),{class:"w-4 h-4 mr-2"}),e[12]||(e[12]=w(" Retour aux produits ",-1))]),_:1,__:[12]})]),t("div",Ee,[t("div",Ce,[(l(),i(C,null,P(v,(r,d)=>t("div",{key:r.id,class:x(["flex items-center",{"flex-1":d<v.length-1}])},[t("div",je,[t("div",{class:x(["flex items-center justify-center w-10 h-10 rounded-full border-2 font-medium text-sm transition-all",n.value>=r.id?"border-[#0099cc] bg-[#0099cc] text-white":"border-gray-300 bg-white text-gray-600"])},[n.value>=r.id?(l(),ge(be(r.icon),{key:0,class:"w-5 h-5"})):(l(),i("span",Pe,p(r.id),1))],2),t("div",$e,[t("p",{class:x(["text-sm font-medium",n.value>=r.id?"text-[#0099cc]":"text-gray-600"])},p(r.title),3),t("p",ze,p(r.description),1)])]),d<v.length-1?(l(),i("div",{key:0,class:x(["flex-1 h-0.5 mx-4 transition-all",n.value>r.id?"bg-[#0099cc]":"bg-gray-200"])},null,2)):a("",!0)],2)),64))])]),t("form",{onSubmit:M(ie,["prevent"]),class:"space-y-6"},[n.value===1?(l(),i("div",Ve,[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Informations de base",-1)),t("div",Ie,[t("div",Me,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nom du produit * ",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.name=r),type:"text",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all",style:{color:"#5f5f5f"},placeholder:"Ex: iPhone 15 Pro Max 256GB"},null,512),[[$,s.name]]),c.name?(l(),i("p",Fe,p(c.name),1)):a("",!0)]),t("div",Se,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Description * ",-1)),y(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.description=r),rows:"4",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all",style:{color:"#5f5f5f"},placeholder:"Décrivez votre produit en détail..."},null,512),[[$,s.description]]),c.description?(l(),i("p",Ae,p(c.description),1)):a("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Catégorie * ",-1)),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.category_id=r),required:"",disabled:u(_),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all disabled:opacity-50",style:{color:"#5f5f5f"}},[e[16]||(e[16]=t("option",{value:""},"Sélectionner une catégorie",-1)),u(_)?(l(),i("option",Le,"Chargement des catégories...")):a("",!0),(l(!0),i(C,null,P(L.value,r=>(l(),i("option",{key:r.id,value:r.id},p(r.name),9,Ue))),128))],8,De),[[R,s.category_id]]),c.category_id?(l(),i("p",qe,p(c.category_id),1)):a("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Condition * ",-1)),y(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.condition=r),required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all",style:{color:"#5f5f5f"}},e[18]||(e[18]=[t("option",{value:""},"État du produit",-1),t("option",{value:"new"},"Neuf",-1),t("option",{value:"used"},"Occasion",-1),t("option",{value:"refurbished"},"Reconditionné",-1)]),512),[[R,s.condition]])]),t("div",Be,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Mode de vente * ",-1)),t("div",Ne,[t("label",{class:x(["flex items-center p-4 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition-colors",{"border-[#0099cc] bg-blue-50":s.sale_mode==="direct"}])},[y(t("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=r=>s.sale_mode=r),value:"direct",class:"sr-only"},null,512),[[T,s.sale_mode]]),t("div",Re,[t("div",{class:x(["w-5 h-5 rounded-full border-2 flex items-center justify-center",s.sale_mode==="direct"?"border-[#0099cc]":"border-gray-300"])},[s.sale_mode==="direct"?(l(),i("div",Te)):a("",!0)],2),e[20]||(e[20]=t("div",null,[t("p",{class:"font-medium text-gray-900"},"Vente directe"),t("p",{class:"text-sm text-gray-700"},"Les clients achètent directement")],-1))])],2),t("label",{class:x(["flex items-center p-4 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition-colors",{"border-purple-500 bg-purple-50":s.sale_mode==="lottery"}])},[y(t("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=r=>s.sale_mode=r),value:"lottery",class:"sr-only"},null,512),[[T,s.sale_mode]]),t("div",Ge,[t("div",{class:x(["w-5 h-5 rounded-full border-2 flex items-center justify-center",s.sale_mode==="lottery"?"border-purple-500":"border-gray-300"])},[s.sale_mode==="lottery"?(l(),i("div",Oe)):a("",!0)],2),e[21]||(e[21]=t("div",null,[t("p",{class:"font-medium text-gray-900"},"Tombola"),t("p",{class:"text-sm text-gray-700"},"Les clients achètent des tickets")],-1))])],2)])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Valeur du produit (FCFA) * ",-1)),y(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s.price=r),type:"number",required:"",min:"0",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all",style:{color:"#5f5f5f"},placeholder:"Ex: 800000"},null,512),[[$,s.price]]),c.price?(l(),i("p",We,p(c.price),1)):a("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Localisation * ",-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s.location=r),type:"text",required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#0099cc] focus:border-transparent transition-all",style:{color:"#5f5f5f"},placeholder:"Ex: Libreville, Gabon"},null,512),[[$,s.location]])])])])):a("",!0),n.value===2?(l(),i("div",Je,[e[32]||(e[32]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Photos du produit",-1)),t("div",Qe,[h.value.length>0?(l(),i("div",He,[e[26]||(e[26]=t("h3",{class:"font-medium text-gray-900"},"Images actuelles",-1)),t("div",Ke,[(l(!0),i(C,null,P(h.value,(r,d)=>(l(),i("div",{key:"existing-"+d,class:"relative group"},[t("img",{src:r,alt:`Produit existant ${d+1}`,class:"w-full h-32 object-cover rounded-xl border border-gray-200"},null,8,Xe),t("button",{onClick:I=>le(d),type:"button",class:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[m(u(W),{class:"w-4 h-4"})],8,Ye),d===0?(l(),i("div",Ze," Photo principale ")):a("",!0)]))),128))])])):a("",!0),t("div",et,[t("div",{onClick:te,onDragover:e[8]||(e[8]=M(()=>{},["prevent"])),onDrop:M(re,["prevent"]),class:"border-2 border-dashed border-gray-300 rounded-xl p-8 hover:border-[#0099cc] transition-colors cursor-pointer"},[m(u(G),{class:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e[27]||(e[27]=t("p",{class:"text-lg font-medium text-gray-700 mb-2"},"Ajouter de nouvelles photos",-1)),e[28]||(e[28]=t("p",{class:"text-sm text-gray-700 mb-4"},"Glissez-déposez ou cliquez pour sélectionner",-1)),e[29]||(e[29]=t("div",{class:"flex justify-center"},[t("span",{class:"bg-[#0099cc] text-white px-6 py-2 rounded-lg font-medium hover:bg-[#0088bb] transition-colors"}," Choisir des fichiers ")],-1))],32),t("input",{ref_key:"fileInput",ref:j,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:se,class:"hidden"},null,544)]),s.images.length>0?(l(),i("div",tt,[e[30]||(e[30]=t("h3",{class:"font-medium text-gray-900"},"Nouvelles images",-1)),t("div",st,[(l(!0),i(C,null,P(s.images,(r,d)=>(l(),i("div",{key:"new-"+d,class:"relative group"},[t("img",{src:r.preview,alt:`Nouveau produit ${d+1}`,class:"w-full h-32 object-cover rounded-xl border border-gray-200"},null,8,rt),t("button",{onClick:I=>oe(d),type:"button",class:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[m(u(W),{class:"w-4 h-4"})],8,ot)]))),128))])])):a("",!0),t("div",lt,[t("div",it,[m(u(O),{class:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e[31]||(e[31]=t("div",{class:"text-sm text-blue-700"},[t("p",{class:"font-medium mb-1"},"Conseils pour de bonnes photos :"),t("ul",{class:"space-y-1 text-sm"},[t("li",null,"• Les images existantes seront conservées si vous n'ajoutez pas de nouvelles images"),t("li",null,"• Utilisez un bon éclairage naturel"),t("li",null,"• Prenez plusieurs angles du produit"),t("li",null,"• Maximum 10 images par produit"),t("li",null,"• Formats acceptés : JPG, PNG, WebP"),t("li",null,"• Taille maximum : 5MB par image")])],-1))])])])])):a("",!0),t("div",at,[n.value>1?(l(),i("button",{key:0,onClick:Y,type:"button",class:"inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},[m(u(F),{class:"w-4 h-4 mr-2"}),e[33]||(e[33]=w(" Précédent ",-1))])):(l(),i("div",nt)),t("div",dt," Étape "+p(n.value)+" sur "+p(v.length),1),n.value<v.length?(l(),i("button",{key:2,onClick:X,type:"button",class:"inline-flex items-center px-6 py-3 bg-[#0099cc] hover:bg-[#0088bb] text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!V.value||u(_)},[e[34]||(e[34]=w(" Suivant ",-1)),m(u(ye),{class:"w-4 h-4 ml-2"})],8,ut)):a("",!0),n.value===v.length?(l(),i("button",{key:3,type:"submit",disabled:k.value||!V.value||u(_),class:"inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors"},[k.value||u(_)?(l(),i("span",pt,[e[35]||(e[35]=t("div",{class:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"},null,-1)),w(" "+p(k.value?"Modification...":"Chargement..."),1)])):(l(),i("span",mt,[m(u(xe),{class:"w-4 h-4 mr-2"}),e[36]||(e[36]=w(" Modifier le produit ",-1))]))],8,ct)):a("",!0)])],32)],64)):a("",!0)])}}};export{yt as default};
