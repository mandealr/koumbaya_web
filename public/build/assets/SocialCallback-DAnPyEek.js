import{r as m,j as v,R as h,s as k,b as c,e as t,l as x,g as y,t as b,w,h as g,o as d,i as _}from"./vendor-HurWl8Tx.js";import{u as C}from"./app-Bc6yMBle.js";const j={class:"min-h-screen bg-gradient-to-br from-koumbaya-primary/5 via-white to-koumbaya-primary/10 flex items-center justify-center"},B={class:"text-center"},R={key:0,class:"mb-4"},S={key:1,class:"max-w-md mx-auto p-8 bg-white rounded-xl shadow-lg"},T={class:"text-gray-600 mb-6"},E={__name:"SocialCallback",setup(q){const n=h(),p=k(),u=C(),i=m(!0),r=m(null);return v(async()=>{const o=n.query.token,e=n.query.error;n.query.provider;const l=n.query.needs_profile;if(e){r.value=e,i.value=!1;return}if(!o){r.value="Token manquant",i.value=!1;return}try{localStorage.setItem("token",o);const s=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(!s.ok)throw new Error("Impossible de récupérer les informations utilisateur");const a=await s.json();if(a.success&&a.user)u.setUser(a.user),u.setToken(o),window.$toast&&(window.$toast.success(`Bienvenue ${a.user.first_name||a.user.name} !`,"✅ Connexion réussie"),l==="1"&&setTimeout(()=>{window.$toast.info("Pensez à compléter votre profil avec votre numéro de téléphone pour une meilleure expérience.","ℹ️ Complétez votre profil",{duration:8e3})},2e3)),setTimeout(()=>{const f=u.getDefaultRedirect();p.push({name:f})},1e3);else throw new Error("Réponse invalide du serveur")}catch(s){console.error("Social auth callback error:",s),r.value=s.message||"Une erreur est survenue",i.value=!1}}),(o,e)=>{const l=g("router-link");return d(),c("div",j,[t("div",B,[i.value?(d(),c("div",R,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-4 border-koumbaya-primary border-t-transparent mx-auto"},null,-1),t("p",{class:"mt-4 text-lg text-gray-700"},"Authentification en cours...",-1)]))):r.value?(d(),c("div",S,[e[2]||(e[2]=t("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[3]||(e[3]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Erreur d'authentification",-1)),t("p",T,b(r.value),1),y(l,{to:"/login",class:"inline-block px-6 py-3 bg-koumbaya-primary text-white rounded-lg hover:bg-koumbaya-primary-dark transition-colors"},{default:w(()=>e[1]||(e[1]=[_(" Retour à la connexion ",-1)])),_:1,__:[1]})])):x("",!0)])])}}};export{E as default};
