import{r as m,c as q,y as W,g as Y,b as d,e,j as w,i as R,w as G,k as Z,A as H,B as K,E as ee,f as te,t as n,u as l,F as U,n as I,l as k,q as T,o as c,G as se}from"./vendor-zwIjsTu0.js";import{a as oe}from"./app-CfVfiwST.js";function ae(){const{get:z,post:M,loading:_,error:P}=oe(),i=m([]),b=m({total:0,active:0,completed:0,pending:0,cancelled:0}),g=m({status:"all",search:"",sortBy:"end_date_asc"}),j=m({current_page:1,per_page:15,total:0,last_page:1}),y=async(o={})=>{try{const s={per_page:g.value.per_page||15,page:o.page||1,sort_by:g.value.sortBy,...o};g.value.status&&g.value.status!=="all"&&(s.status=g.value.status),g.value.search&&(s.search=g.value.search);const r=await z("/lotteries/my-lotteries",{params:s});return r.success&&(i.value=r.data.data||r.data,r.data.current_page&&(j.value={current_page:r.data.current_page,per_page:r.data.per_page,total:r.data.total,last_page:r.data.last_page}),r.stats?b.value=r.stats:x()),r}catch(s){throw console.error("Erreur lors du chargement des tombolas:",s),s}},x=()=>{const o=i.value.length,s=i.value.filter(p=>p.status==="active").length,r=i.value.filter(p=>p.status==="completed").length,v=i.value.filter(p=>p.status==="pending").length,h=i.value.filter(p=>p.status==="cancelled").length;b.value={total:o,active:s,completed:r,pending:v,cancelled:h}},V=async o=>{try{const s=await M(`/lotteries/${o}/draw`);if(s.success||s.message){const r=i.value.findIndex(v=>v.id===o);r!==-1&&(i.value[r]={...i.value[r],status:"completed",is_drawn:!0,winner_user_id:s.lottery?.winner_user_id,winner_ticket_number:s.lottery?.winner_ticket_number,draw_date:s.lottery?.draw_date}),x()}return s}catch(s){throw console.error("Erreur lors du tirage:",s),s}},D=async o=>{try{const s=await z(`/lotteries/${o}`);return s.lottery||s.data}catch(s){throw console.error("Erreur lors du chargement des détails:",s),s}},F=async o=>{g.value={...g.value,...o},await y()},$=async o=>{g.value.search=o,await y()},B=async o=>{await y({page:o})},C=q(()=>[{key:"all",label:"Toutes",count:b.value.total},{key:"active",label:"Actives",count:b.value.active},{key:"pending",label:"En attente",count:b.value.pending},{key:"completed",label:"Terminées",count:b.value.completed},{key:"cancelled",label:"Annulées",count:b.value.cancelled}]);return{lotteries:q(()=>{let o=[...i.value];if(g.value.search){const s=g.value.search.toLowerCase();o=o.filter(r=>r.lottery_number?.toLowerCase().includes(s)||r.product?.name?.toLowerCase().includes(s)||r.product?.description?.toLowerCase().includes(s))}return o}),stats:b,filters:g,pagination:j,tabs:C,loading:_,error:P,fetchLotteries:y,drawLottery:V,getLotteryDetails:D,updateFilters:F,searchLotteries:$,changePage:B,canDrawLottery:o=>o.status==="active"&&!o.is_drawn&&o.can_draw===!0&&new Date(o.end_date)<=new Date,getFormattedStatus:o=>({pending:{label:"En attente",class:"bg-yellow-100 text-yellow-800"},active:{label:"Active",class:"bg-green-100 text-green-800"},completed:{label:"Terminée",class:"bg-blue-100 text-blue-800"},cancelled:{label:"Annulée",class:"bg-red-100 text-red-800"}})[o]||{label:o,class:"bg-gray-100 text-gray-800"},getTimeRemaining:o=>{const s=new Date,v=new Date(o)-s;if(v<=0)return"Terminée";const h=Math.floor(v/(1e3*60*60*24)),p=Math.floor(v%(1e3*60*60*24)/(1e3*60*60)),A=Math.floor(v%(1e3*60*60)/(1e3*60));return h>0?`${h}j ${p}h`:p>0?`${p}h ${A}min`:`${A}min`}}}const re={class:"space-y-6"},le={class:"sm:flex sm:items-center sm:justify-between"},ne={class:"mt-4 sm:mt-0"},ie={class:"bg-white p-4 rounded-lg shadow"},de={class:"flex flex-col sm:flex-row gap-4"},ce={class:"flex-1"},ue={class:"relative"},ge={class:"sm:w-48"},ve={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},pe={class:"bg-white rounded-lg shadow p-4"},me={class:"text-2xl font-bold text-gray-900"},be={class:"bg-white rounded-lg shadow p-4"},_e={class:"text-2xl font-bold text-green-600"},xe={class:"bg-white rounded-lg shadow p-4"},fe={class:"text-2xl font-bold text-yellow-600"},he={class:"bg-white rounded-lg shadow p-4"},ye={class:"text-2xl font-bold text-blue-600"},we={class:"bg-white rounded-lg shadow p-4"},ke={class:"text-2xl font-bold text-red-600"},Ce={class:"border-b border-gray-200"},Le={class:"-mb-px flex space-x-8"},Te=["onClick"],Me={key:0,class:"ml-2 bg-gray-100 text-gray-600 py-1 px-2 rounded-full text-xs"},je={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},De={class:"flex"},$e={class:"ml-3"},Be={class:"text-sm text-red-800"},Ee={class:"bg-white rounded-lg shadow"},Se={class:"p-6"},Ae={key:0,class:"text-center py-12"},ze={key:1,class:"text-center py-12"},Pe={key:2},Ve={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Fe={class:"h-48 bg-gray-200 relative"},Ne=["src","alt"],Re={key:1,class:"w-full h-full flex items-center justify-center"},Ge={class:"absolute top-2 right-2"},qe={class:"p-4"},He={class:"flex justify-between items-start mb-2"},Ue={class:"font-semibold text-gray-900 truncate"},Ie={class:"text-sm text-gray-500 ml-2"},Qe={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Xe={class:"space-y-2 text-sm"},Je={class:"flex justify-between"},Oe={class:"font-medium"},We={class:"flex justify-between"},Ye={class:"font-medium"},Ze={class:"flex justify-between"},Ke={class:"w-full bg-gray-200 rounded-full h-2"},et={class:"flex gap-2 mt-4"},tt=["onClick","disabled"],st={key:0,class:"mt-6 flex justify-between items-center"},ot={class:"text-sm text-gray-700"},at={class:"flex gap-2"},rt=["disabled"],lt=["disabled"],nt={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},it={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},dt={class:"text-sm text-gray-600 mb-6"},ct={class:"flex gap-3 justify-end"},ut=["disabled"],gt={key:2,class:"fixed bottom-4 right-4 z-50"},vt={class:"flex"},pt={class:"flex-shrink-0"},mt={key:0,class:"h-5 w-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bt={key:1,class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_t={class:"ml-3"},ht={__name:"LotteriesSimple",setup(z){const{lotteries:M,stats:_,tabs:P,pagination:i,loading:b,error:g,fetchLotteries:j,drawLottery:y,updateFilters:x,searchLotteries:V,changePage:D,canDrawLottery:F,getFormattedStatus:$,getTimeRemaining:B}=ae(),C=m("all"),E=m(""),S=m("end_date_asc"),L=m(!1),f=m(null),o=m(null),s=m(!1),r=m(""),v=m("success");let h=null;const p=()=>{clearTimeout(h),h=setTimeout(()=>{V(E.value)},500)},A=u=>{C.value=u,x({status:u==="all"?null:u,page:1})},Q=()=>{x({sortBy:S.value,page:1})},X=u=>{f.value=u,L.value=!0},J=async()=>{if(f.value){o.value=f.value.id;try{const u=await y(f.value.id);s.value=!0,v.value="success",r.value=`Tirage effectué avec succès ! Gagnant : ${u.winning_ticket?.user?.first_name} ${u.winning_ticket?.user?.last_name}`,L.value=!1,f.value=null,setTimeout(()=>{s.value=!1},5e3)}catch(u){console.error("Erreur lors du tirage:",u),s.value=!0,v.value="error",r.value=u.response?.data?.error||"Erreur lors du tirage",setTimeout(()=>{s.value=!1},5e3)}finally{o.value=null}}};return W(()=>C.value,u=>{x(u!=="all"?{status:u}:{status:null})}),Y(async()=>{try{await j()}catch(u){console.error("Erreur lors du chargement initial:",u),s.value=!0,v.value="error",r.value="Erreur lors du chargement des tombolas",setTimeout(()=>{s.value=!1},5e3)}}),(u,t)=>{const N=Z("router-link");return c(),d("div",re,[e("div",le,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Mes Tombolas"),e("p",{class:"mt-2 text-gray-600"},"Gérez vos tombolas et effectuez les tirages")],-1)),e("div",ne,[R(N,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[5]||(t[5]=[k(" Nouvelle tombola ",-1)])),_:1,__:[5]})])]),e("div",ie,[e("div",de,[e("div",ce,[e("div",ue,[t[7]||(t[7]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),H(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>E.value=a),onInput:p,type:"text",placeholder:"Rechercher par numéro, nom ou description...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[K,E.value]])])]),e("div",ge,[H(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>S.value=a),onChange:Q,class:"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[8]||(t[8]=[te('<option value="end_date_asc">Date de fin (croissant)</option><option value="end_date_desc">Date de fin (décroissant)</option><option value="popularity">Popularité</option><option value="ticket_price_asc">Prix ticket (croissant)</option><option value="ticket_price_desc">Prix ticket (décroissant)</option>',5)]),544),[[ee,S.value]])])])]),e("div",ve,[e("div",pe,[e("div",me,n(l(_).total),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600"},"Total",-1))]),e("div",be,[e("div",_e,n(l(_).active),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-600"},"Actives",-1))]),e("div",xe,[e("div",fe,n(l(_).pending),1),t[11]||(t[11]=e("div",{class:"text-sm text-gray-600"},"En attente",-1))]),e("div",he,[e("div",ye,n(l(_).completed),1),t[12]||(t[12]=e("div",{class:"text-sm text-gray-600"},"Terminées",-1))]),e("div",we,[e("div",ke,n(l(_).cancelled),1),t[13]||(t[13]=e("div",{class:"text-sm text-gray-600"},"Annulées",-1))])]),e("div",Ce,[e("nav",Le,[(c(!0),d(U,null,I(l(P),a=>(c(),d("button",{key:a.key,onClick:O=>A(a.key),class:T(["py-2 px-1 border-b-2 font-medium text-sm",C.value===a.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[k(n(a.label)+" ",1),a.count!==null?(c(),d("span",Me,n(a.count),1)):w("",!0)],10,Te))),128))])]),l(g)?(c(),d("div",je,[e("div",De,[t[14]||(t[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",$e,[e("p",Be,n(l(g)),1)])])])):w("",!0),e("div",Ee,[e("div",Se,[l(b)?(c(),d("div",Ae,t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des tombolas...",-1)]))):l(M).length===0?(c(),d("div",ze,[t[17]||(t[17]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),t[18]||(t[18]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucune tombola",-1)),t[19]||(t[19]=e("p",{class:"text-gray-600 mb-4"},"Vous n'avez pas encore créé de tombolas.",-1)),R(N,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[16]||(t[16]=[k(" Créer ma première tombola ",-1)])),_:1,__:[16]})])):(c(),d("div",Pe,[e("div",Ve,[(c(!0),d(U,null,I(l(M),a=>(c(),d("div",{key:a.id,class:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow"},[e("div",Fe,[a.product?.main_image?(c(),d("img",{key:0,src:a.product.main_image,alt:a.product?.name,class:"w-full h-full object-cover"},null,8,Ne)):(c(),d("div",Re,t[20]||(t[20]=[e("svg",{class:"h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]))),e("div",Ge,[e("span",{class:T(["px-2 py-1 text-xs font-medium rounded-full",l($)(a.status).class])},n(l($)(a.status).label),3)])]),e("div",qe,[e("div",He,[e("h4",Ue,n(a.product?.name||"Produit sans nom"),1),e("span",Ie,"#"+n(a.lottery_number),1)]),e("p",Qe,n(a.product?.description),1),e("div",Xe,[e("div",Je,[t[21]||(t[21]=e("span",{class:"text-gray-500"},"Prix du ticket:",-1)),e("span",Oe,n(a.ticket_price)+" XAF",1)]),e("div",We,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"Tickets vendus:",-1)),e("span",Ye,n(a.sold_tickets||0)+"/"+n(a.total_tickets),1)]),e("div",Ze,[t[23]||(t[23]=e("span",{class:"text-gray-500"},"Temps restant:",-1)),e("span",{class:T(["font-medium",{"text-red-600":l(B)(a.end_date)==="Terminée"}])},n(l(B)(a.end_date)),3)]),e("div",Ke,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:se({width:`${Math.min((a.sold_tickets||0)/a.total_tickets*100,100)}%`})},null,4)])]),e("div",et,[R(N,{to:{name:"merchant.lottery.view",params:{id:a.id}},class:"flex-1 text-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},{default:G(()=>t[24]||(t[24]=[k(" Détails ",-1)])),_:2,__:[24]},1032,["to"]),l(F)(a)?(c(),d("button",{key:0,onClick:O=>X(a),disabled:o.value===a.id,class:"flex-1 px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 transition-colors"},n(o.value===a.id?"Tirage...":"Effectuer le tirage"),9,tt)):w("",!0)])])]))),128))]),l(i).last_page>1?(c(),d("div",st,[e("div",ot," Page "+n(l(i).current_page)+" sur "+n(l(i).last_page)+" ("+n(l(i).total)+" résultats) ",1),e("div",at,[e("button",{onClick:t[2]||(t[2]=a=>l(D)(l(i).current_page-1)),disabled:l(i).current_page<=1,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Précédent ",8,rt),e("button",{onClick:t[3]||(t[3]=a=>l(D)(l(i).current_page+1)),disabled:l(i).current_page>=l(i).last_page,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Suivant ",8,lt)])])):w("",!0)]))])]),L.value?(c(),d("div",nt,[e("div",it,[t[27]||(t[27]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Confirmer le tirage",-1)),e("p",dt,[t[25]||(t[25]=k(" Êtes-vous sûr de vouloir effectuer le tirage pour la tombola ",-1)),e("strong",null,n(f.value?.product?.name),1),t[26]||(t[26]=k(" ? Cette action est irréversible. ",-1))]),e("div",ct,[e("button",{onClick:t[4]||(t[4]=a=>L.value=!1),class:"px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50"}," Annuler "),e("button",{onClick:J,disabled:o.value,class:"px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400"},n(o.value?"Tirage...":"Confirmer le tirage"),9,ut)])])])):w("",!0),s.value?(c(),d("div",gt,[e("div",{class:T(["rounded-md p-4 shadow-lg",v.value==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"])},[e("div",vt,[e("div",pt,[v.value==="success"?(c(),d("svg",mt,t[28]||(t[28]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(c(),d("svg",bt,t[29]||(t[29]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])))]),e("div",_t,[e("p",{class:T(["text-sm",v.value==="success"?"text-green-800":"text-red-800"])},n(r.value),3)])])],2)])):w("",!0)])}}};export{ht as default};
