import{r as w,c as S,x as de,g as ie,y as ce,b as u,e,j as A,i as h,l as _,q as T,u as p,t as n,F as L,p as V,A as F,B as R,E as K,f as ue,o as d,n as Q,v as X}from"./vendor-Dds7lS9y.js";import{a as me,B as pe,C as ge,o as xe,d as U,p as ye,m as be,n as ve,h as fe,s as he,q as _e,D as we,z as ke,E as Ce,j as De}from"./app-CPWTtOBx.js";function Se(){const{get:b,put:i,loading:k,error:I}=me(),C=w([]),v=w({total_orders:0,revenue:0,pending:0,conversion_rate:0}),O=w([]),M=async()=>{try{const r=await b("/merchant/dashboard/stats");return r.success&&(v.value={total_orders:r.data.tickets_sold,revenue:r.data.total_sales,pending:r.data.pending_orders||0,conversion_rate:r.data.conversion_rate||0}),r}catch(r){throw console.error("Erreur lors du chargement des stats:",r),r}},B=async(r={})=>{try{const l=new URLSearchParams;r.search&&l.append("search",r.search),r.status&&l.append("status",r.status),r.product&&l.append("product_id",r.product),r.startDate&&l.append("start_date",r.startDate),r.endDate&&l.append("end_date",r.endDate),r.limit&&l.append("limit",r.limit);const a=l.toString(),y=`/merchant/dashboard/recent-transactions${a?"?"+a:""}`,f=await b(y);return f.success&&f.data.transactions&&(C.value=f.data.transactions.map(m=>({id:m.id,order_number:m.transaction_id,customer_name:m.user.name,customer_email:m.user.email,product_name:m.product.title,product_image:m.product.image_url||"/images/products/placeholder.jpg",tickets_count:m.quantity,ticket_numbers:m.ticket_numbers||[],ticket_price:m.amount/m.quantity,total_amount:m.amount,currency:"FCFA",payment_method:m.payment_method,status:m.status||"completed",created_at:m.completed_at}))),f}catch(l){throw console.error("Erreur lors du chargement des commandes:",l),l}},N=async()=>{try{const r=await b("/merchant/dashboard/top-products?limit=100");return r.success&&r.data.products&&(O.value=r.data.products.map(l=>({id:l.id,name:l.title}))),r}catch(r){throw console.error("Erreur lors du chargement des produits:",r),r}},$=async(r,l)=>{try{const a=await i(`/transactions/${r}/status`,{status:l});if(a.success){const y=C.value.findIndex(f=>f.id===r);y!==-1&&(C.value[y].status=l)}return a}catch(a){throw console.error("Erreur lors de la mise à jour du statut:",a),a}},g=async r=>$(r.id,"confirmed"),E=async r=>$(r.id,"cancelled"),c=async(r="csv")=>{try{return await b(`/merchant/dashboard/export-orders?format=${r}`)}catch(l){throw console.error("Erreur lors de l'export:",l),l}},x=S(()=>{const r=new Date,l=new Date(r.getTime()-10080*60*1e3);C.value.filter(y=>new Date(y.created_at)>=l);const a=()=>Math.random()*20-5;return[{label:"Total commandes",value:v.value.total_orders.toString(),change:a(),icon:"ShoppingBagIcon",color:"bg-[#0099cc]"},{label:"Revenus",value:Math.floor(v.value.revenue).toLocaleString(),change:a(),icon:"CurrencyDollarIcon",color:"bg-blue-500"},{label:"En attente",value:v.value.pending.toString(),change:a(),icon:"ClockIcon",color:"bg-yellow-500"},{label:"Taux conversion",value:`${v.value.conversion_rate}%`,change:a(),icon:"CheckIcon",color:"bg-purple-500"}]});return{orders:C,stats:v,products:O,orderStats:x,loading:k,error:I,loadStats:M,loadOrders:B,loadProducts:N,updateOrderStatus:$,confirmOrder:g,cancelOrder:E,exportOrders:c}}function Oe(){const b=(i,k="info",I=3e3)=>{k==="error"?(console.error(i),alert("Erreur: "+i)):(console.log(i),alert(i))};return{success:i=>b(i,"success"),error:i=>b(i,"error"),info:i=>b(i,"info"),warning:i=>b(i,"warning")}}const $e={class:"space-y-6"},Ee={class:"flex items-center justify-between"},Ae={class:"flex space-x-3"},Te=["disabled"],Fe={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Ie={class:"flex items-center justify-between"},Me={class:"text-sm font-medium text-gray-600"},Pe={class:"text-2xl font-bold text-gray-900 mt-1"},je={class:"mt-4 pt-4 border-t border-gray-100"},Le={class:"flex items-center text-xs"},Ve={class:"bg-white rounded-xl shadow-lg border border-gray-100 p-6"},Be={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},Ne={class:"relative"},Re=["value"],Ue={class:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden"},qe={key:0,class:"flex justify-center py-12"},ze={key:1,class:"text-center py-12"},We={key:2,class:"overflow-x-auto"},Ge={class:"min-w-full"},He={class:"bg-white divide-y divide-gray-200"},Je={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"text-sm font-medium text-gray-900"},Qe={class:"text-sm text-gray-500"},Xe={class:"px-6 py-4 whitespace-nowrap"},Ye={class:"flex items-center"},Ze={class:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center"},et={class:"ml-3"},tt={class:"text-sm font-medium text-gray-900"},st={class:"text-sm text-gray-500"},rt={class:"px-6 py-4 whitespace-nowrap"},ot={class:"flex items-center"},at=["src","alt"],nt={class:"ml-3"},lt={class:"text-sm font-medium text-gray-900"},dt={class:"text-sm text-gray-500"},it={class:"px-6 py-4 whitespace-nowrap"},ct={class:"text-sm text-gray-900"},ut={class:"text-sm text-gray-500"},mt={class:"px-6 py-4 whitespace-nowrap"},pt={class:"text-sm font-semibold text-gray-900"},gt={class:"text-sm text-gray-500"},xt={class:"px-6 py-4 whitespace-nowrap"},yt={class:"px-6 py-4 whitespace-nowrap"},bt={class:"text-sm text-gray-900"},vt={class:"text-sm text-gray-500"},ft={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ht={class:"flex items-center space-x-2"},_t=["onClick"],wt=["onClick"],kt=["onClick"],Ct={class:"bg-white px-6 py-3 border-t border-gray-200 flex items-center justify-between"},Dt={class:"text-sm text-gray-700"},St={class:"font-medium"},Ot={class:"font-medium"},$t={class:"font-medium"},Et={class:"flex space-x-2"},At=["disabled"],Tt=["disabled"],Ft={key:0,class:"fixed inset-0 bg-black bg-opacity-20 overflow-y-auto h-full w-full z-50"},It={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-xl bg-white"},Mt={class:"flex items-center justify-between mb-6"},Pt={key:0,class:"space-y-6"},jt={class:"grid grid-cols-2 gap-4"},Lt={class:"text-sm text-gray-900"},Vt={class:"text-sm text-gray-900"},Bt={class:"text-sm text-gray-900 font-semibold"},Nt={class:"bg-gray-50 p-4 rounded-lg"},Rt={class:"grid grid-cols-2 gap-4"},Ut={class:"text-sm text-gray-900"},qt={class:"text-sm text-gray-900"},zt={class:"bg-gray-50 p-4 rounded-lg"},Wt={class:"text-sm text-gray-700 mb-2"},Gt={class:"flex flex-wrap gap-2"},Ht={class:"mt-6 flex justify-end space-x-3"},Qt={__name:"Orders",setup(b){const{orders:i,products:k,orderStats:I,loading:C,loadStats:v,loadOrders:O,loadProducts:M,confirmOrder:B,cancelOrder:N,exportOrders:$}=Se(),g=Oe(),E=w(!1),c=w(null),x=w(1),r=w(10),l=w(!1),a=de({search:"",status:"",product:"",startDate:"",endDate:""}),y=S(()=>{let o=i.value;if(a.search){const t=a.search.toLowerCase();o=o.filter(s=>s.order_number.toLowerCase().includes(t)||s.customer_name.toLowerCase().includes(t)||s.product_name.toLowerCase().includes(t))}return a.status&&(o=o.filter(t=>t.status===a.status)),a.product&&(o=o.filter(t=>t.product_name.includes(k.value.find(s=>s.id==a.product)?.name||""))),a.startDate&&(o=o.filter(t=>new Date(t.created_at)>=new Date(a.startDate))),a.endDate&&(o=o.filter(t=>new Date(t.created_at)<=new Date(a.endDate))),o}),f=S(()=>Math.ceil(y.value.length/r.value)),m=S(()=>{const o=(x.value-1)*r.value,t=o+r.value;return y.value.slice(o,t)}),Y=S(()=>(x.value-1)*r.value+1),Z=S(()=>{const o=x.value*r.value;return Math.min(o,y.value.length)}),D=async()=>{x.value=1,await P()},P=async()=>{try{await O(a)}catch{g.error("Erreur lors du chargement des commandes")}},ee=()=>{x.value>1&&x.value--},te=()=>{x.value<f.value&&x.value++},q=o=>({pending:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",confirmed:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",completed:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",cancelled:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"})[o]||"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800",z=o=>({pending:"En attente",confirmed:"Confirmé",completed:"Terminé",cancelled:"Annulé"})[o]||o,W=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),se=o=>new Date(o).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),re=o=>{c.value=o,E.value=!0},j=()=>{E.value=!1,c.value=null},G=async o=>{if(confirm(`Confirmer la commande ${o.order_number} ?`))try{await B(o),g.success("Commande confirmée avec succès !"),j(),await P()}catch{g.error("Erreur lors de la confirmation")}},oe=async o=>{if(confirm(`Annuler la commande ${o.order_number} ? Cette action est irréversible.`))try{await N(o),g.success("Commande annulée"),j(),await P()}catch{g.error("Erreur lors de l'annulation")}},ae=async()=>{l.value=!0;try{await Promise.all([v(),P(),M()]),g.success("Commandes actualisées")}catch{g.error("Erreur lors de l'actualisation")}finally{l.value=!1}},ne=async()=>{try{await $("csv"),g.success("Export des commandes démarré")}catch{g.error("Erreur lors de l'export des commandes")}};ie(async()=>{try{await Promise.all([v(),O(),M()])}catch(o){console.error("Erreur lors du chargement initial:",o),g.error("Erreur lors du chargement des données")}});let H=null;ce(()=>a.search,o=>{clearTimeout(H),H=setTimeout(()=>{D()},500)});const le=o=>({ShoppingBagIcon:U,CurrencyDollarIcon:De,ClockIcon:Ce,CheckIcon:ke})[o]||U;return(o,t)=>(d(),u("div",$e,[e("div",Ee,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Mes Commandes"),e("p",{class:"mt-2 text-gray-600"},"Suivez et gérez toutes vos ventes de tickets de tombola")],-1)),e("div",Ae,[e("button",{onClick:ae,disabled:l.value,class:"inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50"},[h(p(pe),{class:T(["w-4 h-4 mr-2",{"animate-spin":l.value}])},null,8,["class"]),_(" "+n(l.value?"Actualisation...":"Actualiser"),1)],8,Te),e("button",{onClick:ne,class:"inline-flex items-center px-4 py-2 bg-[#0099cc] hover:bg-[#0088bb] text-white rounded-lg transition-colors"},[h(p(ge),{class:"w-4 h-4 mr-2"}),t[6]||(t[6]=_(" Exporter ",-1))])])]),e("div",Fe,[(d(!0),u(L,null,V(p(I),s=>(d(),u("div",{key:s.label,class:"bg-white p-6 rounded-xl shadow-lg border border-gray-100"},[e("div",Ie,[e("div",null,[e("p",Me,n(s.label),1),e("p",Pe,n(s.value),1)]),e("div",{class:T(["p-3 rounded-xl",s.color])},[(d(),Q(X(le(s.icon)),{class:"w-6 h-6 text-white"}))],2)]),e("div",je,[e("div",Le,[e("span",{class:T(["inline-flex items-center px-2 py-1 rounded-full font-medium",s.change>=0?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},[(d(),Q(X(s.change>=0?p(be):p(ve)),{class:"w-3 h-3 mr-1"})),_(" "+n(Math.abs(s.change))+"% ",1)],2),t[8]||(t[8]=e("span",{class:"ml-2 text-gray-500"},"vs semaine dernière",-1))])])]))),128))]),e("div",Ve,[e("div",Be,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Rechercher",-1)),e("div",Ne,[h(p(xe),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),F(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.search=s),type:"text",placeholder:"ID, client, produit...",class:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0099cc] focus:border-transparent text-black",onInput:D},null,544),[[R,a.search]])])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Statut",-1)),F(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.status=s),onChange:D,class:"w-full py-2 px-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0099cc] focus:border-transparent text-black"},t[10]||(t[10]=[ue('<option value="">Tous les statuts</option><option value="pending">En attente</option><option value="confirmed">Confirmé</option><option value="completed">Terminé</option><option value="cancelled">Annulé</option>',5)]),544),[[K,a.status]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Produit",-1)),F(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.product=s),onChange:D,class:"w-full py-2 px-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0099cc] focus:border-transparent text-black"},[t[12]||(t[12]=e("option",{value:""},"Tous les produits",-1)),(d(!0),u(L,null,V(p(k),s=>(d(),u("option",{key:s.id,value:s.id},n(s.name),9,Re))),128))],544),[[K,a.product]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date début",-1)),F(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.startDate=s),type:"date",onChange:D,class:"w-full py-2 px-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0099cc] focus:border-transparent text-black"},null,544),[[R,a.startDate]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date fin",-1)),F(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.endDate=s),type:"date",onChange:D,class:"w-full py-2 px-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0099cc] focus:border-transparent text-black"},null,544),[[R,a.endDate]])])])]),e("div",Ue,[t[24]||(t[24]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Commandes récentes")],-1)),p(C)?(d(),u("div",qe,t[16]||(t[16]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0099cc]"},null,-1)]))):y.value.length===0?(d(),u("div",ze,[h(p(U),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t[17]||(t[17]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucune commande",-1)),t[18]||(t[18]=e("p",{class:"text-gray-600"},"Aucune commande ne correspond à vos critères.",-1))])):(d(),u("div",We,[e("table",Ge,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Commande "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Client "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Produit "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tickets "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Montant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",He,[(d(!0),u(L,null,V(m.value,s=>(d(),u("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Je,[e("div",null,[e("div",Ke,"#"+n(s.order_number),1),e("div",Qe,n(s.payment_method),1)])]),e("td",Xe,[e("div",Ye,[e("div",Ze,[h(p(fe),{class:"w-5 h-5 text-gray-600"})]),e("div",et,[e("div",tt,n(s.customer_name),1),e("div",st,n(s.customer_email),1)])])]),e("td",rt,[e("div",ot,[e("img",{class:"h-12 w-12 rounded-lg object-cover",src:s.product_image,alt:s.product_name},null,8,at),e("div",nt,[e("div",lt,n(s.product_name),1),e("div",dt,n(s.ticket_price.toLocaleString())+" FCFA/ticket",1)])])]),e("td",it,[e("div",ct,n(s.tickets_count)+" tickets",1),e("div",ut,"N° "+n(s.ticket_numbers.join(", ")),1)]),e("td",mt,[e("div",pt,n(s.total_amount.toLocaleString())+" FCFA",1),e("div",gt,n(s.currency),1)]),e("td",xt,[e("span",{class:T(q(s.status))},n(z(s.status)),3)]),e("td",yt,[e("div",bt,n(W(s.created_at)),1),e("div",vt,n(se(s.created_at)),1)]),e("td",ft,[e("div",ht,[e("button",{onClick:J=>re(s),class:"text-[#0099cc] hover:text-[#0088bb] transition-colors",title:"Voir détails"},[h(p(he),{class:"w-4 h-4"})],8,_t),s.status==="pending"?(d(),u("button",{key:0,onClick:J=>G(s),class:"text-blue-600 hover:text-blue-800 transition-colors",title:"Confirmer"},[h(p(_e),{class:"w-4 h-4"})],8,wt)):A("",!0),["pending","confirmed"].includes(s.status)?(d(),u("button",{key:1,onClick:J=>oe(s),class:"text-red-600 hover:text-red-800 transition-colors",title:"Annuler"},[h(p(we),{class:"w-4 h-4"})],8,kt)):A("",!0)])])]))),128))])])])),e("div",Ct,[e("div",Dt,[t[20]||(t[20]=_(" Affichage de ",-1)),e("span",St,n(Y.value),1),t[21]||(t[21]=_(" à ",-1)),e("span",Ot,n(Z.value),1),t[22]||(t[22]=_(" sur ",-1)),e("span",$t,n(y.value.length),1),t[23]||(t[23]=_(" résultats ",-1))]),e("div",Et,[e("button",{onClick:ee,disabled:x.value===1,class:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Précédent ",8,At),e("button",{onClick:te,disabled:x.value===f.value,class:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Suivant ",8,Tt)])])]),E.value?(d(),u("div",Ft,[e("div",It,[e("div",Mt,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Détails de la commande",-1)),e("button",{onClick:j,class:"text-gray-400 hover:text-gray-600"},[h(p(ye),{class:"w-6 h-6"})])]),c.value?(d(),u("div",Pt,[e("div",jt,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"N° de commande",-1)),e("p",Lt,n(c.value.order_number),1)]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Date",-1)),e("p",Vt,n(W(c.value.created_at)),1)]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700"},"Statut",-1)),e("span",{class:T(q(c.value.status))},n(z(c.value.status)),3)]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700"},"Montant",-1)),e("p",Bt,n(c.value.total_amount.toLocaleString())+" FCFA",1)])]),e("div",null,[t[32]||(t[32]=e("h4",{class:"text-md font-semibold text-gray-900 mb-3"},"Informations client",-1)),e("div",Nt,[e("div",Rt,[e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nom",-1)),e("p",Ut,n(c.value.customer_name),1)]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),e("p",qt,n(c.value.customer_email),1)])])])]),e("div",null,[t[33]||(t[33]=e("h4",{class:"text-md font-semibold text-gray-900 mb-3"},"Tickets achetés",-1)),e("div",zt,[e("p",Wt,[e("strong",null,n(c.value.tickets_count)+" tickets",1),_(" pour "+n(c.value.product_name),1)]),e("div",Gt,[(d(!0),u(L,null,V(c.value.ticket_numbers,s=>(d(),u("span",{key:s,class:"inline-block bg-[#0099cc] text-white px-2 py-1 rounded text-xs font-mono"}," #"+n(s),1))),128))])])])])):A("",!0),e("div",Ht,[e("button",{onClick:j,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"}," Fermer "),c.value?.status==="pending"?(d(),u("button",{key:0,onClick:t[5]||(t[5]=s=>G(c.value)),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Confirmer la commande ")):A("",!0)])])])):A("",!0)]))}};export{Qt as default};
