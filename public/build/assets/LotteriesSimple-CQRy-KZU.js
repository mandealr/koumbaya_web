import{r as v,c as H,P as Z,j as K,b as u,e,l as y,g as F,w as G,h as ee,U as I,V as te,$ as se,f as ae,t as n,u as l,F as Q,y as X,i as C,v as k,o as g,a6 as oe}from"./vendor-jx2CZFIM.js";import{a as re,c as le}from"./app-BHl73pPI.js";function ne(){const{get:j,post:S,loading:x,error:N}=re(),i=v([]),_=v({total:0,active:0,completed:0,pending:0,cancelled:0}),m=v({status:"all",search:"",sortBy:"end_date_asc"}),E=v({current_page:1,per_page:15,total:0,last_page:1}),T=async(s={})=>{try{const a={per_page:m.value.per_page||15,page:s.page||1,sort_by:m.value.sortBy,...s};m.value.status&&m.value.status!=="all"&&(a.status=m.value.status),m.value.search&&(a.search=m.value.search);const r=await j("/merchant/dashboard/lottery-performance",{params:a});return r.success&&(i.value=r.data.data||r.data,r.data.current_page&&(E.value={current_page:r.data.current_page,per_page:r.data.per_page,total:r.data.total,last_page:r.data.last_page}),r.stats?_.value=r.stats:f()),r}catch(a){throw console.error("Erreur lors du chargement des tombolas:",a),a}},f=()=>{const s=i.value.length,a=i.value.filter(p=>p.status==="active").length,r=i.value.filter(p=>p.status==="completed").length,d=i.value.filter(p=>p.status==="pending").length,b=i.value.filter(p=>p.status==="cancelled").length;_.value={total:s,active:a,completed:r,pending:d,cancelled:b}},R=async s=>{try{const a=await S(`/lotteries/${s}/draw`);if(a.success||a.message){const r=i.value.findIndex(d=>d.id===s);r!==-1&&(i.value[r]={...i.value[r],status:"completed",is_drawn:!0,winner_user_id:a.lottery?.winner_user_id,winner_ticket_number:a.lottery?.winner_ticket_number,draw_date:a.lottery?.draw_date}),f()}return a}catch(a){throw console.error("Erreur lors du tirage:",a),a}},B=async s=>{try{const a=await j(`/lotteries/${s}`);return a.lottery||a.data}catch(a){throw console.error("Erreur lors du chargement des détails:",a),a}},q=async s=>{m.value={...m.value,...s},await T()},P=async s=>{m.value.search=s,await T()},A=async s=>{await T({page:s})},D=H(()=>[{key:"all",label:"Toutes",count:_.value.total},{key:"active",label:"Actives",count:_.value.active},{key:"pending",label:"En attente",count:_.value.pending},{key:"completed",label:"Terminées",count:_.value.completed},{key:"cancelled",label:"Annulées",count:_.value.cancelled}]),V=H(()=>{let s=[...i.value];if(m.value.search){const a=m.value.search.toLowerCase();s=s.filter(r=>r.lottery_number?.toLowerCase().includes(a)||r.product?.name?.toLowerCase().includes(a)||r.product?.description?.toLowerCase().includes(a))}return s}),L=s=>{if(s.status!=="active"||s.is_drawn)return!1;const a=s.sold_tickets||0,r=s.total_tickets||s.max_tickets||0,d=a>=r&&r>0,b=new Date(s.end_date)<=new Date;return d||b},M=s=>({pending:{label:"En attente",class:"bg-yellow-100 text-yellow-800"},active:{label:"Active",class:"bg-green-100 text-green-800"},completed:{label:"Terminée",class:"bg-blue-100 text-blue-800"},cancelled:{label:"Annulée",class:"bg-red-100 text-red-800"}})[s]||{label:s,class:"bg-gray-100 text-gray-800"},$=s=>{const a=new Date,d=new Date(s)-a;if(d<=0)return"Terminée";const b=Math.floor(d/(1e3*60*60*24)),p=Math.floor(d%(1e3*60*60*24)/(1e3*60*60)),z=Math.floor(d%(1e3*60*60)/(1e3*60));return b>0?`${b}j ${p}h`:p>0?`${p}h ${z}min`:`${z}min`},h=s=>{if(s.status!=="active"||s.is_drawn)return null;const a=s.sold_tickets||0,r=s.total_tickets||s.max_tickets||0,d=a>=r&&r>0,b=new Date(s.end_date)<=new Date;return d&&!b?"manual":b?"automatic":null};return{lotteries:V,stats:_,filters:m,pagination:E,tabs:D,loading:x,error:N,fetchLotteries:T,drawLottery:R,getLotteryDetails:B,updateFilters:q,searchLotteries:P,changePage:A,canDrawLottery:L,getFormattedStatus:M,getTimeRemaining:$,getDrawType:h,getDrawMessage:s=>{const a=h(s);return a==="manual"?"Tirage manuel disponible (quota atteint)":a==="automatic"?"Tirage automatique (date atteinte)":null},loadLotteryStats:async()=>{try{const s=await j("/stats/merchant/lotteries");if(s&&s.success){const a=s.data.stats;return _.value={total:a.total_lotteries,active:a.active_lotteries,pending:a.pending_lotteries,completed:a.completed_lotteries,cancelled:a.cancelled_lotteries},s.data}}catch(s){console.error("Erreur lors du chargement des stats tombolas:",s)}}}}const ie={class:"space-y-6"},de={class:"sm:flex sm:items-center sm:justify-between"},ce={class:"mt-4 sm:mt-0"},ue={class:"bg-white p-4 rounded-lg shadow"},ge={class:"flex flex-col sm:flex-row gap-4"},me={class:"flex-1"},pe={class:"relative"},ve={class:"sm:w-48"},be={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},_e={class:"bg-white rounded-lg shadow p-4"},xe={class:"text-2xl font-bold text-gray-900"},fe={class:"bg-white rounded-lg shadow p-4"},he={class:"text-2xl font-bold text-green-600"},we={class:"bg-white rounded-lg shadow p-4"},ye={class:"text-2xl font-bold text-yellow-600"},ke={class:"bg-white rounded-lg shadow p-4"},Te={class:"text-2xl font-bold text-blue-600"},Ce={class:"bg-white rounded-lg shadow p-4"},De={class:"text-2xl font-bold text-red-600"},Le={class:"border-b border-gray-200"},Me={class:"-mb-px flex space-x-8"},$e=["onClick"],je={key:0,class:"ml-2 bg-gray-100 text-gray-600 py-1 px-2 rounded-full text-xs"},Se={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},Ee={class:"flex"},Be={class:"ml-3"},Pe={class:"text-sm text-red-800"},Ae={class:"bg-white rounded-lg shadow"},Ve={class:"p-6"},ze={key:0,class:"text-center py-12"},Fe={key:1,class:"text-center py-12"},Ne={key:2},Re={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},qe={class:"h-48 bg-gray-200 relative"},Ue={class:"absolute top-2 right-2"},Ge={class:"p-4"},He={class:"flex justify-between items-start mb-2"},Ie={class:"font-semibold text-gray-900 truncate"},Qe={class:"text-sm text-gray-600 ml-2"},Xe={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Je={class:"space-y-2 text-sm"},Oe={class:"flex justify-between"},We={class:"font-medium"},Ye={class:"flex justify-between"},Ze={class:"font-medium"},Ke={class:"flex justify-between"},et={class:"w-full bg-gray-200 rounded-full h-2"},tt={class:"flex gap-2 mt-4"},st=["onClick","disabled"],at={key:0,class:"mt-6 flex justify-between items-center"},ot={class:"text-sm text-gray-700"},rt={class:"flex gap-2"},lt=["disabled"],nt=["disabled"],it={key:1,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},dt={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},ct={class:"text-sm text-gray-600 mb-6"},ut={class:"flex gap-3 justify-end"},gt=["disabled"],mt={key:2,class:"fixed bottom-4 right-4 z-50"},pt={class:"flex"},vt={class:"flex-shrink-0"},bt={key:0,class:"h-5 w-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_t={key:1,class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xt={class:"ml-3"},wt={__name:"LotteriesSimple",setup(j){const{lotteries:S,stats:x,tabs:N,pagination:i,loading:_,error:m,fetchLotteries:E,drawLottery:T,updateFilters:f,searchLotteries:R,changePage:B,canDrawLottery:q,getFormattedStatus:P,getTimeRemaining:A,getDrawType:D,getDrawMessage:V}=ne(),L=v("all"),M=v(""),$=v("end_date_asc"),h=v(!1),w=v(null),s=v(null),a=v(!1),r=v(""),d=v("success");let b=null;const p=()=>{clearTimeout(b),b=setTimeout(()=>{R(M.value)},500)},z=c=>{L.value=c,f({status:c==="all"?null:c,page:1})},J=()=>{f({sortBy:$.value,page:1})},O=c=>{w.value=c,h.value=!0},W=async()=>{if(w.value){s.value=w.value.id;try{const c=await T(w.value.id);a.value=!0,d.value="success",r.value=`Tirage effectué avec succès ! Gagnant : ${c.winning_ticket?.user?.first_name} ${c.winning_ticket?.user?.last_name}`,h.value=!1,w.value=null,setTimeout(()=>{a.value=!1},5e3)}catch(c){console.error("Erreur lors du tirage:",c),a.value=!0,d.value="error",r.value=c.response?.data?.error||"Erreur lors du tirage",setTimeout(()=>{a.value=!1},5e3)}finally{s.value=null}}};return Z(()=>L.value,c=>{f(c!=="all"?{status:c}:{status:null})}),K(async()=>{try{await E()}catch(c){console.error("Erreur lors du chargement initial:",c),a.value=!0,d.value="error",r.value="Erreur lors du chargement des tombolas",setTimeout(()=>{a.value=!1},5e3)}}),(c,t)=>{const U=ee("router-link");return g(),u("div",ie,[e("div",de,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Mes Tombolas"),e("p",{class:"mt-2 text-gray-600"},"Gérez vos tombolas et effectuez les tirages")],-1)),e("div",ce,[F(U,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[5]||(t[5]=[C(" Nouvelle tombola ",-1)])),_:1,__:[5]})])]),e("div",ue,[e("div",ge,[e("div",me,[e("div",pe,[t[7]||(t[7]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>M.value=o),onInput:p,type:"text",placeholder:"Rechercher par numéro, nom ou description...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[te,M.value]])])]),e("div",ve,[I(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>$.value=o),onChange:J,class:"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[8]||(t[8]=[ae('<option value="end_date_asc">Date de fin (croissant)</option><option value="end_date_desc">Date de fin (décroissant)</option><option value="popularity">Popularité</option><option value="ticket_price_asc">Prix ticket (croissant)</option><option value="ticket_price_desc">Prix ticket (décroissant)</option>',5)]),544),[[se,$.value]])])])]),e("div",be,[e("div",_e,[e("div",xe,n(l(x).total),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600"},"Total",-1))]),e("div",fe,[e("div",he,n(l(x).active),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-600"},"Actives",-1))]),e("div",we,[e("div",ye,n(l(x).pending),1),t[11]||(t[11]=e("div",{class:"text-sm text-gray-600"},"En attente",-1))]),e("div",ke,[e("div",Te,n(l(x).completed),1),t[12]||(t[12]=e("div",{class:"text-sm text-gray-600"},"Terminées",-1))]),e("div",Ce,[e("div",De,n(l(x).cancelled),1),t[13]||(t[13]=e("div",{class:"text-sm text-gray-600"},"Annulées",-1))])]),e("div",Le,[e("nav",Me,[(g(!0),u(Q,null,X(l(N),o=>(g(),u("button",{key:o.key,onClick:Y=>z(o.key),class:k(["py-2 px-1 border-b-2 font-medium text-sm",L.value===o.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[C(n(o.label)+" ",1),o.count!==null?(g(),u("span",je,n(o.count),1)):y("",!0)],10,$e))),128))])]),l(m)?(g(),u("div",Se,[e("div",Ee,[t[14]||(t[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Be,[e("p",Pe,n(l(m)),1)])])])):y("",!0),e("div",Ae,[e("div",Ve,[l(_)?(g(),u("div",ze,t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des tombolas...",-1)]))):l(S).length===0?(g(),u("div",Fe,[t[17]||(t[17]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),t[18]||(t[18]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucune tombola",-1)),t[19]||(t[19]=e("p",{class:"text-gray-600 mb-4"},"Vous n'avez pas encore créé de tombolas.",-1)),F(U,{to:"/merchant/products/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:G(()=>t[16]||(t[16]=[C(" Créer ma première tombola ",-1)])),_:1,__:[16]})])):(g(),u("div",Ne,[e("div",Re,[(g(!0),u(Q,null,X(l(S),o=>(g(),u("div",{key:o.id,class:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow"},[e("div",qe,[F(le,{src:o.product?.main_image||o.product?.image_url||o.product?.image,alt:o.product?.name,"container-class":"h-48 w-full","image-class":"w-full h-full object-cover","fallback-class":"h-48 w-full","fallback-text":"Photo"},null,8,["src","alt"]),e("div",Ue,[e("span",{class:k(["px-2 py-1 text-xs font-medium rounded-full",l(P)(o.status).class])},n(l(P)(o.status).label),3)])]),e("div",Ge,[e("div",He,[e("h4",Ie,n(o.product?.name||"Produit sans nom"),1),e("span",Qe,"#"+n(o.lottery_number),1)]),e("p",Xe,n(o.product?.description),1),e("div",Je,[e("div",Oe,[t[20]||(t[20]=e("span",{class:"text-gray-600"},"Prix du ticket:",-1)),e("span",We,n(o.ticket_price)+" XAF",1)]),e("div",Ye,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Tickets vendus:",-1)),e("span",Ze,n(o.sold_tickets||0)+"/"+n(o.total_tickets),1)]),e("div",Ke,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"Temps restant:",-1)),e("span",{class:k(["font-medium",{"text-red-600":l(A)(o.end_date)==="Terminée"}])},n(l(A)(o.end_date)),3)]),e("div",et,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:oe({width:`${Math.min((o.sold_tickets||0)/o.total_tickets*100,100)}%`})},null,4)])]),l(V)(o)?(g(),u("div",{key:0,class:k(["mt-3 px-3 py-2 rounded-lg text-sm",l(D)(o)==="manual"?"bg-orange-50 text-orange-800":"bg-blue-50 text-blue-800"])},n(l(V)(o)),3)):y("",!0),e("div",tt,[F(U,{to:{name:"merchant.lottery.view",params:{id:o.id}},class:"flex-1 text-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 transition-colors"},{default:G(()=>t[23]||(t[23]=[C(" Détails ",-1)])),_:2,__:[23]},1032,["to"]),l(q)(o)?(g(),u("button",{key:0,onClick:Y=>O(o),disabled:s.value===o.id,class:k(["flex-1 px-3 py-2 text-sm rounded-md transition-colors text-white",l(D)(o)==="manual"?"bg-orange-600 hover:bg-orange-700":"bg-green-600 hover:bg-green-700",s.value===o.id?"disabled:bg-gray-400":""])},n(s.value===o.id?"Tirage...":l(D)(o)==="manual"?"Tirage manuel":"Effectuer le tirage"),11,st)):y("",!0)])])]))),128))]),l(i).last_page>1?(g(),u("div",at,[e("div",ot," Page "+n(l(i).current_page)+" sur "+n(l(i).last_page)+" ("+n(l(i).total)+" résultats) ",1),e("div",rt,[e("button",{onClick:t[2]||(t[2]=o=>l(B)(l(i).current_page-1)),disabled:l(i).current_page<=1,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Précédent ",8,lt),e("button",{onClick:t[3]||(t[3]=o=>l(B)(l(i).current_page+1)),disabled:l(i).current_page>=l(i).last_page,class:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:bg-gray-100 disabled:cursor-not-allowed"}," Suivant ",8,nt)])])):y("",!0)]))])]),h.value?(g(),u("div",it,[e("div",dt,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Confirmer le tirage",-1)),e("p",ct,[t[24]||(t[24]=C(" Êtes-vous sûr de vouloir effectuer le tirage pour la tombola ",-1)),e("strong",null,n(w.value?.product?.name),1),t[25]||(t[25]=C(" ? Cette action est irréversible. ",-1))]),e("div",ut,[e("button",{onClick:t[4]||(t[4]=o=>h.value=!1),class:"px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-100"}," Annuler "),e("button",{onClick:W,disabled:s.value,class:"px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400"},n(s.value?"Tirage...":"Confirmer le tirage"),9,gt)])])])):y("",!0),a.value?(g(),u("div",mt,[e("div",{class:k(["rounded-md p-4 shadow-lg",d.value==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"])},[e("div",pt,[e("div",vt,[d.value==="success"?(g(),u("svg",bt,t[27]||(t[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(g(),u("svg",_t,t[28]||(t[28]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])))]),e("div",xt,[e("p",{class:k(["text-sm",d.value==="success"?"text-green-800":"text-red-800"])},n(r.value),3)])])],2)])):y("",!0)])}}};export{wt as default};
