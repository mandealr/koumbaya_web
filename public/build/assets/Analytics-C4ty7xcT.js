import{c as b,au as E,aJ as L,aK as H,b as r,o,e,l as F,t as l,z as V,v as y,N as R,a6 as T,F as j,y as B,r as x,j as O,U as N,$ as G,f as J,V as q,u as i,g as _,I as K,b4 as Q,G as I,aH as U,b5 as W,b6 as Y,b7 as Z}from"./vendor-jx2CZFIM.js";import{a as ee}from"./app-0kwJdgle.js";const te={class:"koumbaya-card group hover:scale-105 transition-all duration-300 cursor-pointer"},se={class:"koumbaya-card-body"},ae={key:0,class:"flex items-center justify-center h-24"},oe={key:1,class:"flex items-center justify-between"},re={class:"flex-1"},ne={class:"space-y-1"},le={class:"text-sm font-medium text-gray-600 group-hover:text-gray-700 transition-colors"},ie={class:"text-3xl font-bold text-gray-900 group-hover:text-koumbaya-primary transition-colors"},de={key:0,class:"flex items-center mt-2 space-x-1"},ce={class:"text-sm text-gray-500"},ue={key:2,class:"mt-4"},ge={class:"flex justify-between text-xs text-gray-500 mb-1"},me={class:"w-full bg-gray-200 rounded-full h-2"},pe={key:3,class:"flex gap-2 mt-4"},ve=["onClick"],P={__name:"StatsCard",props:{title:{type:String,required:!0},value:{type:[Number,String],required:!0},icon:{type:[Object,Function],required:!0},change:{type:Number,default:void 0},period:{type:String,default:"mois dernier"},color:{type:String,default:"blue",validator:d=>["blue","green","orange","red","purple","indigo"].includes(d)},format:{type:String,default:"number",validator:d=>["number","currency","percentage"].includes(d)},showProgress:{type:Boolean,default:!1},progressValue:{type:Number,default:void 0},progressTarget:{type:Number,default:100},actions:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["action"],setup(d,{emit:g}){const n=d,c=g,m=b(()=>{const h=n.value;switch(n.format){case"currency":return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(h).replace("XAF","FCFA");case"percentage":return`${h}%`;default:return new Intl.NumberFormat("fr-FR").format(h)}}),f=b(()=>n.change===void 0?E:n.change>0?L:n.change<0?H:E),p=b(()=>n.change===void 0?"text-gray-400":n.change>0?"text-blue-600":n.change<0?"text-red-600":"text-gray-400"),u={blue:{iconBg:"bg-blue-100 group-hover:bg-blue-200",iconColor:"text-blue-600",progress:"bg-gradient-to-r from-blue-500 to-blue-600"},green:{iconBg:"bg-blue-100 group-hover:bg-blue-200",iconColor:"text-blue-600",progress:"bg-gradient-to-r from-blue-500 to-blue-600"},orange:{iconBg:"bg-orange-100 group-hover:bg-orange-200",iconColor:"text-orange-600",progress:"bg-gradient-to-r from-orange-500 to-orange-600"},red:{iconBg:"bg-red-100 group-hover:bg-red-200",iconColor:"text-red-600",progress:"bg-gradient-to-r from-red-500 to-red-600"},purple:{iconBg:"bg-purple-100 group-hover:bg-purple-200",iconColor:"text-purple-600",progress:"bg-gradient-to-r from-purple-500 to-purple-600"},indigo:{iconBg:"bg-indigo-100 group-hover:bg-indigo-200",iconColor:"text-indigo-600",progress:"bg-gradient-to-r from-indigo-500 to-indigo-600"}},k=b(()=>u[n.color]?.iconBg||u.blue.iconBg),w=b(()=>u[n.color]?.iconColor||u.blue.iconColor),C=b(()=>u[n.color]?.progress||u.blue.progress),v=b(()=>!n.showProgress||n.progressValue===void 0?0:Math.min(n.progressValue/n.progressTarget*100,100)),S=h=>{c("action",h)};return(h,A)=>(o(),r("div",te,[e("div",se,[d.loading?(o(),r("div",ae,A[0]||(A[0]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):(o(),r("div",oe,[e("div",re,[e("div",ne,[e("p",le,l(d.title),1),e("p",ie,l(m.value),1)]),d.change!==void 0?(o(),r("div",de,[(o(),V(R(f.value),{class:y([p.value,"w-4 h-4 flex-shrink-0"])},null,8,["class"])),e("span",{class:y([p.value,"text-sm font-medium"])},l(Math.abs(d.change))+"% ",3),e("span",ce," vs "+l(d.period||"mois dernier"),1)])):F("",!0)]),e("div",{class:y([k.value,"p-4 rounded-xl group-hover:scale-110 transition-transform duration-300"])},[(o(),V(R(d.icon),{class:y([w.value,"w-8 h-8"])},null,8,["class"]))],2)])),d.showProgress&&d.progressValue!==void 0?(o(),r("div",ue,[e("div",ge,[e("span",null,"Objectif: "+l(d.progressTarget),1),e("span",null,l(Math.round(v.value))+"%",1)]),e("div",me,[e("div",{class:y([C.value,"h-2 rounded-full transition-all duration-500"]),style:T({width:v.value+"%"})},null,6)])])):F("",!0),d.actions?.length?(o(),r("div",pe,[(o(!0),r(j,null,B(d.actions,$=>(o(),r("button",{key:$.label,onClick:D=>S($),class:y(["flex-1 text-xs px-3 py-1.5 rounded-lg font-medium transition-all duration-200",$.primary?"bg-koumbaya-primary text-white hover:bg-koumbaya-primary-dark":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},l($.label),11,ve))),128))])):F("",!0)])]))}},he={class:"px-6"},be={class:"mb-6"},ye={class:"bg-white rounded-lg shadow p-4"},fe={class:"flex flex-col sm:flex-row gap-4"},xe={class:"flex-1"},_e={key:0,class:"flex gap-4"},ke={class:"flex items-end"},we=["disabled"],Ce={key:0},$e={key:1},Fe={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},Ae={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},Pe={class:"koumbaya-card"},je={class:"koumbaya-card-body"},Be={key:0,class:"h-64 bg-gradient-to-br from-blue-50 to-blue-50 rounded-lg flex items-center justify-center"},Ve={key:1,class:"h-64"},Se={class:"h-full flex items-end justify-between space-x-2 p-4"},De={class:"text-xs text-gray-600 mt-2"},Me={class:"text-xs font-medium text-gray-900"},Ne={key:2,class:"h-64 bg-gradient-to-br from-blue-50 to-blue-50 rounded-lg flex items-center justify-center"},Te={class:"text-center"},Ee={class:"koumbaya-card"},Re={class:"koumbaya-card-body"},qe={key:0,class:"h-64 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg flex items-center justify-center"},Ie={key:1,class:"h-64 overflow-y-auto"},Ue={class:"space-y-3"},Xe={class:"font-medium text-gray-900"},ze={class:"text-sm text-gray-600"},Le={class:"text-right"},He={class:"font-medium text-gray-900"},Oe={key:2,class:"h-64 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg flex items-center justify-center"},Ge={class:"text-center"},Je={class:"koumbaya-card"},Ke={class:"koumbaya-card-body"},Qe={key:0,class:"flex justify-center items-center h-32"},We={key:1,class:"overflow-x-auto"},Ye={class:"min-w-full divide-y divide-gray-200"},Ze={class:"bg-white divide-y divide-gray-200"},et={class:"px-6 py-4 whitespace-nowrap"},tt={class:"flex items-center"},st={class:"flex-shrink-0 h-10 w-10"},at=["src","alt"],ot={class:"ml-4"},rt={class:"text-sm font-medium text-gray-900"},nt={class:"text-sm text-gray-500"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},it={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},dt={class:"px-6 py-4 whitespace-nowrap"},ct={class:"flex items-center"},ut={key:3,class:"text-sm text-gray-500"},gt={key:2,class:"text-center py-8"},vt={__name:"Analytics",setup(d){const{loading:g,get:n}=ee(),c=x({}),m=x([]),f=x([]),p=x([]),u=x("this_month"),k=x(""),w=x(""),C=b(()=>{const a={period:u.value};return u.value==="custom"&&(k.value&&(a.start_date=k.value),w.value&&(a.end_date=w.value)),a}),v=async()=>{try{await Promise.all([S(),h(),A(),$()])}catch(a){console.error("Erreur lors du chargement des analytics:",a)}},S=async()=>{try{const a=await n("/stats/merchant/dashboard",{params:C.value});if(a&&a.success){const t=a.data;c.value={total_revenue:t.revenue.total,monthly_sales:t.orders.total,active_products:t.products.active,conversion_rate:t.products.total_views>0?t.orders.total/t.products.total_views*100:0,revenue_change:0,sales_change:0,products_change:0,conversion_change:0}}}catch(a){console.error("Erreur lors du chargement des stats:",a),c.value={}}},h=async()=>{try{const a=await n("/stats/merchant/analytics",{params:C.value});a&&a.success&&(m.value=a.data.daily_revenue.map(t=>({date:t.date,sales:t.orders,revenue:t.revenue})))}catch(a){console.error("Erreur lors du chargement du graphique des ventes:",a),m.value=[]}},A=async()=>{try{const a=await n("/stats/merchant/analytics",{params:C.value});a&&a.success&&(f.value=a.data.top_products.map(t=>({...t,sales:t.order_count,total_revenue:t.revenue,performance_change:0})))}catch(a){console.error("Erreur lors du chargement des top produits:",a),f.value=[]}},$=async()=>{try{const a=await n("/stats/merchant/lotteries",{params:C.value});a&&a.success&&(p.value=a.data.recent_lotteries.map(t=>({id:t.id,name:t.product_name,tickets_sold:t.sold_tickets,revenue:t.sold_tickets*1e3,performance_change:t.completion_rate-50})))}catch(a){console.error("Erreur lors du chargement de la performance des tombolas:",a),p.value=[]}},D=a=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(a||0).replace("XAF","FCFA"),X=a=>a?new Date(a).toLocaleDateString("fr-FR",{month:"short",day:"numeric"}):"";return O(()=>{v()}),(a,t)=>(o(),r("div",he,[t[17]||(t[17]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Analytiques"),e("p",{class:"mt-2 text-gray-600"},"Analyse de vos performances de vente")],-1)),e("div",be,[e("div",ye,[e("div",fe,[e("div",xe,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Période",-1)),N(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),onChange:v,class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},t[3]||(t[3]=[J('<option value="today">Aujourd&#39;hui</option><option value="yesterday">Hier</option><option value="this_week">Cette semaine</option><option value="last_week">Semaine dernière</option><option value="this_month">Ce mois</option><option value="last_month">Mois dernier</option><option value="this_year">Cette année</option><option value="custom">Période personnalisée</option>',8)]),544),[[G,u.value]])]),u.value==="custom"?(o(),r("div",_e,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date début",-1)),N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onChange:v,type:"date",class:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,544),[[q,k.value]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date fin",-1)),N(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),onChange:v,type:"date",class:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,544),[[q,w.value]])])])):F("",!0),e("div",ke,[e("button",{onClick:v,disabled:i(g),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"},[i(g)?(o(),r("span",Ce,"Chargement...")):(o(),r("span",$e,"Actualiser"))],8,we)])])])]),e("div",Fe,[_(P,{title:"Revenus Totaux",value:c.value.total_revenue||0,format:"currency",change:c.value.revenue_change||0,color:"green",icon:i(K),loading:i(g),actions:[{label:"Détails",primary:!0}]},null,8,["value","change","icon","loading"]),_(P,{title:"Ventes ce mois",value:c.value.monthly_sales||0,change:c.value.sales_change||0,color:"blue",icon:i(Q),loading:i(g),"show-progress":!0,"progress-value":c.value.monthly_sales||0,"progress-target":c.value.sales_target||200},null,8,["value","change","icon","loading","progress-value","progress-target"]),_(P,{title:"Produits Actifs",value:c.value.active_products||0,change:c.value.products_change||0,color:"purple",icon:i(I),loading:i(g)},null,8,["value","change","icon","loading"]),_(P,{title:"Taux Conversion",value:c.value.conversion_rate||0,format:"percentage",change:c.value.conversion_change||0,color:"orange",icon:i(U),loading:i(g)},null,8,["value","change","icon","loading"])]),e("div",Ae,[e("div",Pe,[t[9]||(t[9]=e("div",{class:"koumbaya-card-header"},[e("h3",{class:"koumbaya-heading-4"},"Évolution des Ventes")],-1)),e("div",je,[i(g)?(o(),r("div",Be,t[7]||(t[7]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e("p",{class:"text-gray-500"},"Chargement...")],-1)]))):m.value&&m.value.length>0?(o(),r("div",Ve,[e("div",Se,[(o(!0),r(j,null,B(m.value.slice(-7),(s,z)=>(o(),r("div",{key:z,class:"flex-1 flex flex-col items-center"},[e("div",{class:"w-full bg-blue-200 rounded-t",style:T({height:`${Math.max(10,s.sales/Math.max(...m.value.map(M=>M.sales))*180)}px`})},[e("div",{class:"w-full bg-blue-600 rounded-t",style:T({height:`${Math.max(5,s.sales/Math.max(...m.value.map(M=>M.sales))*180)}px`})},null,4)],4),e("span",De,l(X(s.date)),1),e("span",Me,l(s.sales),1)]))),128))])])):(o(),r("div",Ne,[e("div",Te,[_(i(U),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t[8]||(t[8]=e("p",{class:"text-gray-500"},"Aucune donnée disponible",-1))])]))])]),e("div",Ee,[t[12]||(t[12]=e("div",{class:"koumbaya-card-header"},[e("h3",{class:"koumbaya-heading-4"},"Performance des Tombolas")],-1)),e("div",Re,[i(g)?(o(),r("div",qe,t[10]||(t[10]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e("p",{class:"text-gray-500"},"Chargement...")],-1)]))):p.value&&p.value.length>0?(o(),r("div",Ie,[e("div",Ue,[(o(!0),r(j,null,B(p.value.slice(0,5),s=>(o(),r("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-100 rounded-lg"},[e("div",null,[e("h4",Xe,l(s.name),1),e("p",ze,l(s.tickets_sold)+" tickets vendus",1)]),e("div",Le,[e("p",He,l(D(s.revenue)),1),e("p",{class:y(["text-sm",s.performance_change>=0?"text-green-600":"text-red-600"])},l(s.performance_change>=0?"+":"")+l(s.performance_change)+"% ",3)])]))),128))])])):(o(),r("div",Oe,[e("div",Ge,[_(i(W),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t[11]||(t[11]=e("p",{class:"text-gray-500"},"Aucune tombola disponible",-1))])]))])])]),e("div",Je,[t[16]||(t[16]=e("div",{class:"koumbaya-card-header"},[e("h3",{class:"koumbaya-heading-4"},"Top Produits")],-1)),e("div",Ke,[i(g)?(o(),r("div",Qe,t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("span",{class:"ml-2 text-gray-600"},"Chargement des produits...",-1)]))):f.value&&f.value.length>0?(o(),r("div",We,[e("table",Ye,[t[14]||(t[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Produit "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ventes "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Revenus "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tendance ")])],-1)),e("tbody",Ze,[(o(!0),r(j,null,B(f.value,s=>(o(),r("tr",{key:s.id},[e("td",et,[e("div",tt,[e("div",st,[e("img",{src:s.image_url||s.main_image||s.image||"/images/products/placeholder.jpg",alt:s.name,class:"h-10 w-10 rounded-lg object-cover bg-gray-100"},null,8,at)]),e("div",ot,[e("div",rt,l(s.name),1),e("div",nt,l(s.category?.name||s.category||"Sans catégorie"),1)])])]),e("td",lt,l(s.sales_count||s.sales||0),1),e("td",it,l(D(s.total_revenue||s.revenue||0)),1),e("td",dt,[e("div",ct,[(s.trend||s.performance_change||0)>0?(o(),V(i(Y),{key:0,class:"w-4 h-4 text-green-500 mr-1"})):(s.trend||s.performance_change||0)<0?(o(),V(i(Z),{key:1,class:"w-4 h-4 text-red-500 mr-1"})):F("",!0),(s.trend||s.performance_change||0)!==0?(o(),r("span",{key:2,class:y([(s.trend||s.performance_change||0)>0?"text-green-600":"text-red-600","text-sm font-medium"])},l(Math.abs(s.trend||s.performance_change||0))+"% ",3)):(o(),r("span",ut,"-"))])])]))),128))])])])):(o(),r("div",gt,[_(i(I),{class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t[15]||(t[15]=e("p",{class:"text-gray-500"},"Aucun produit trouvé pour cette période",-1))]))])])]))}};export{vt as default};
