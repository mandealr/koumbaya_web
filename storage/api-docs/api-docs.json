{
    "openapi": "3.0.0",
    "info": {
        "title": "Koumbaya Marketplace API",
        "description": "API REST pour la marketplace Koumbaya avec système de tombolas et paiements mobile money",
        "contact": {
            "name": "Équipe Koumbaya",
            "email": "dev@koumbaya.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:8000",
            "description": "Serveur de développement Koumbaya"
        }
    ],
    "paths": {
        "/api/auth/register": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Inscription d'un nouvel utilisateur",
                "operationId": "c7bb21a0d87049e161b8e4c9b0d909f2",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "first_name",
                                    "last_name",
                                    "email",
                                    "phone",
                                    "password",
                                    "role"
                                ],
                                "properties": {
                                    "first_name": {
                                        "type": "string",
                                        "example": "Jean"
                                    },
                                    "last_name": {
                                        "type": "string",
                                        "example": "Dupont"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jean@example.com"
                                    },
                                    "phone": {
                                        "type": "string",
                                        "example": "+24177123456"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    },
                                    "role": {
                                        "type": "string",
                                        "enum": [
                                            "MERCHANT",
                                            "RESELLER",
                                            "PARTNER"
                                        ],
                                        "example": "MERCHANT"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Utilisateur créé avec succès",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Utilisateur créé avec succès"
                                        },
                                        "user": {
                                            "type": "object"
                                        },
                                        "access_token": {
                                            "type": "string"
                                        },
                                        "token_type": {
                                            "type": "string",
                                            "example": "bearer"
                                        },
                                        "expires_in": {
                                            "type": "integer",
                                            "example": 3600
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Erreur de validation"
                    }
                }
            }
        },
        "/api/auth/login": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Connexion d'un utilisateur",
                "operationId": "dd51a484b7fa0f97c7680fdbde14cf5f",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jean@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Connexion réussie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "access_token": {
                                            "type": "string"
                                        },
                                        "token_type": {
                                            "type": "string",
                                            "example": "bearer"
                                        },
                                        "expires_in": {
                                            "type": "integer",
                                            "example": 3600
                                        },
                                        "user": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Identifiants invalides"
                    }
                }
            }
        },
        "/api/auth/me": {
            "get": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Récupérer les informations de l'utilisateur connecté",
                "operationId": "b5de204f5e452ef51327c691aa99e77c",
                "responses": {
                    "200": {
                        "description": "Informations utilisateur",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "user": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Non authentifié"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/logout": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Déconnexion de l'utilisateur",
                "operationId": "df9bdc6c7a6d9f20b983526b2ec0f698",
                "responses": {
                    "200": {
                        "description": "Déconnexion réussie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Déconnexion réussie"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/refresh": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Rafraîchir le token JWT",
                "operationId": "30c20c52f5f72828d8c531fd7c9ea3e7",
                "responses": {
                    "200": {
                        "description": "Token rafraîchi",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "access_token": {
                                            "type": "string"
                                        },
                                        "token_type": {
                                            "type": "string",
                                            "example": "bearer"
                                        },
                                        "expires_in": {
                                            "type": "integer",
                                            "example": 3600
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/categories": {
            "get": {
                "tags": [
                    "Categories"
                ],
                "summary": "Lister toutes les catégories",
                "operationId": "ac9c4d978ea4e5b72915ca9728e5b8b1",
                "parameters": [
                    {
                        "name": "parent_only",
                        "in": "query",
                        "description": "Afficher seulement les catégories parentes",
                        "required": false,
                        "schema": {
                            "type": "boolean"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Liste des catégories",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "categories": {
                                            "type": "array",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/categories/{id}": {
            "get": {
                "tags": [
                    "Categories"
                ],
                "summary": "Récupérer une catégorie par ID",
                "operationId": "09767bb2e47dde77dd1e2591428b0ae1",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la catégorie",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Détails de la catégorie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "category": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Catégorie non trouvée"
                    }
                }
            }
        },
        "/api/categories/{id}/products": {
            "get": {
                "tags": [
                    "Categories"
                ],
                "summary": "Récupérer les produits d'une catégorie",
                "operationId": "f5471cad040b47602127693aa34ba309",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la catégorie",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "page",
                        "in": "query",
                        "description": "Numéro de page",
                        "required": false,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "description": "Nombre d'éléments par page",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 50
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Produits de la catégorie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "products": {
                                            "type": "object"
                                        },
                                        "category": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/countries": {
            "get": {
                "tags": [
                    "Countries"
                ],
                "summary": "Lister tous les pays",
                "operationId": "bbb90b9e86a9cab92aaa448fe98954c9",
                "parameters": [
                    {
                        "name": "active_only",
                        "in": "query",
                        "description": "Afficher seulement les pays actifs",
                        "required": false,
                        "schema": {
                            "type": "boolean",
                            "default": true
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Liste des pays",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "countries": {
                                            "type": "array",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/countries/{id}": {
            "get": {
                "tags": [
                    "Countries"
                ],
                "summary": "Récupérer un pays par ID",
                "operationId": "c172dfb1b3785a376f52b0f46f344f20",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID du pays",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Détails du pays",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "country": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Pays non trouvé"
                    }
                }
            }
        },
        "/api/languages": {
            "get": {
                "tags": [
                    "Languages"
                ],
                "summary": "Lister toutes les langues",
                "operationId": "1cb1ddff581b67412e8c4d53e8a5286d",
                "parameters": [
                    {
                        "name": "active_only",
                        "in": "query",
                        "description": "Afficher seulement les langues actives",
                        "required": false,
                        "schema": {
                            "type": "boolean",
                            "default": true
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Liste des langues",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "languages": {
                                            "type": "array",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/languages/{id}": {
            "get": {
                "tags": [
                    "Languages"
                ],
                "summary": "Récupérer une langue par ID",
                "operationId": "0f580519be224b9e58ceae07113528c8",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la langue",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Détails de la langue",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "language": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Langue non trouvée"
                    }
                }
            }
        },
        "/api/languages/default": {
            "get": {
                "tags": [
                    "Languages"
                ],
                "summary": "Récupérer la langue par défaut",
                "operationId": "0e6b8efde73a795079b0013889422368",
                "responses": {
                    "200": {
                        "description": "Langue par défaut",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "language": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Aucune langue par défaut définie"
                    }
                }
            }
        },
        "/api/lotteries": {
            "get": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Lister toutes les tombolas",
                "operationId": "9ea87e50016fca92c67526b0b1c981e0",
                "parameters": [
                    {
                        "name": "status",
                        "in": "query",
                        "description": "Filtrer par statut",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "pending",
                                "active",
                                "completed",
                                "cancelled"
                            ]
                        }
                    },
                    {
                        "name": "category_id",
                        "in": "query",
                        "description": "Filtrer par catégorie de produit",
                        "required": false,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "min_ticket_price",
                        "in": "query",
                        "description": "Prix minimum du ticket",
                        "required": false,
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "name": "max_ticket_price",
                        "in": "query",
                        "description": "Prix maximum du ticket",
                        "required": false,
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "name": "ending_soon",
                        "in": "query",
                        "description": "Tombolas se terminant dans les 24h",
                        "required": false,
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "name": "sort_by",
                        "in": "query",
                        "description": "Trier par",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "end_date_asc",
                                "end_date_desc",
                                "ticket_price_asc",
                                "ticket_price_desc",
                                "popularity"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Liste des tombolas"
                    }
                }
            }
        },
        "/api/lotteries/active": {
            "get": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Tombolas actives",
                "operationId": "a24ac4021cb411c5255935d0cc5c93fb",
                "responses": {
                    "200": {
                        "description": "Tombolas actives"
                    }
                }
            }
        },
        "/api/lotteries/{id}": {
            "get": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Détails d'une tombola",
                "operationId": "fbb03768631c4ce3881e829c0b88da49",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la tombola",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Détails de la tombola"
                    }
                }
            }
        },
        "/api/lotteries/{id}/buy-ticket": {
            "post": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Acheter un ticket de tombola",
                "operationId": "ce2ff44ef1aca23589f45b6cd481b1a5",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la tombola",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "quantity": {
                                        "description": "Nombre de tickets",
                                        "type": "integer",
                                        "example": 1
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Ticket(s) acheté(s)"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/lotteries/{id}/my-tickets": {
            "get": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Mes tickets pour une tombola",
                "operationId": "91ac3d540c9f89d679fe367eeb01b08e",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la tombola",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Mes tickets"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/lotteries/{id}/draw": {
            "post": {
                "tags": [
                    "Lotteries"
                ],
                "summary": "Effectuer le tirage d'une tombola (Admin/Merchant seulement)",
                "operationId": "a1e7277d52ec67123ce470184b911246",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID de la tombola",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Tirage effectué"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/otp/send": {
            "post": {
                "tags": [
                    "OTP"
                ],
                "summary": "Envoyer un code OTP",
                "operationId": "d34d0fcd867e74d90714f6163dae0c32",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "identifier",
                                    "type",
                                    "purpose"
                                ],
                                "properties": {
                                    "identifier": {
                                        "description": "Email ou numéro de téléphone",
                                        "type": "string",
                                        "example": "user@example.com"
                                    },
                                    "type": {
                                        "description": "Type d'envoi",
                                        "type": "string",
                                        "enum": [
                                            "email",
                                            "sms"
                                        ],
                                        "example": "email"
                                    },
                                    "purpose": {
                                        "description": "But du code OTP",
                                        "type": "string",
                                        "enum": [
                                            "registration",
                                            "password_reset",
                                            "login",
                                            "payment"
                                        ],
                                        "example": "registration"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Code OTP envoyé avec succès",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Code de vérification envoyé par email"
                                        },
                                        "data": {
                                            "properties": {
                                                "masked_identifier": {
                                                    "type": "string",
                                                    "example": "us**@example.com"
                                                },
                                                "expires_at": {
                                                    "type": "string",
                                                    "example": "2025-08-07 18:05:00"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur de validation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Validation failed"
                                        },
                                        "errors": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "429": {
                        "description": "Trop de tentatives",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Trop de tentatives, veuillez patienter"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/otp/verify": {
            "post": {
                "tags": [
                    "OTP"
                ],
                "summary": "Vérifier un code OTP",
                "operationId": "4d68b7909e86f7183a88d99c570feee3",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "identifier",
                                    "code",
                                    "purpose"
                                ],
                                "properties": {
                                    "identifier": {
                                        "description": "Email ou numéro de téléphone",
                                        "type": "string",
                                        "example": "user@example.com"
                                    },
                                    "code": {
                                        "description": "Code OTP à 6 chiffres",
                                        "type": "string",
                                        "example": "123456"
                                    },
                                    "purpose": {
                                        "description": "But du code OTP",
                                        "type": "string",
                                        "enum": [
                                            "registration",
                                            "password_reset",
                                            "login",
                                            "payment"
                                        ],
                                        "example": "registration"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Code OTP vérifié avec succès",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Code de vérification validé avec succès"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Code invalide ou expiré",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Code de vérification invalide ou expiré"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/otp/resend": {
            "post": {
                "tags": [
                    "OTP"
                ],
                "summary": "Renvoyer un code OTP",
                "operationId": "fd23a34799a79abfe400251392bba317",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "identifier",
                                    "type",
                                    "purpose"
                                ],
                                "properties": {
                                    "identifier": {
                                        "description": "Email ou numéro de téléphone",
                                        "type": "string",
                                        "example": "user@example.com"
                                    },
                                    "type": {
                                        "description": "Type d'envoi",
                                        "type": "string",
                                        "enum": [
                                            "email",
                                            "sms"
                                        ],
                                        "example": "email"
                                    },
                                    "purpose": {
                                        "description": "But du code OTP",
                                        "type": "string",
                                        "enum": [
                                            "registration",
                                            "password_reset",
                                            "login",
                                            "payment"
                                        ],
                                        "example": "registration"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Code OTP renvoyé avec succès"
                    }
                }
            }
        },
        "/api/otp/status/{identifier}": {
            "get": {
                "tags": [
                    "OTP"
                ],
                "summary": "Vérifier le statut d'un OTP",
                "operationId": "49bd7d71599eff2916f33c8aa045dcde",
                "parameters": [
                    {
                        "name": "identifier",
                        "in": "path",
                        "description": "Email ou téléphone",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "purpose",
                        "in": "query",
                        "description": "But du code OTP",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "registration",
                                "password_reset",
                                "login",
                                "payment"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Statut de l'OTP",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "data": {
                                            "properties": {
                                                "has_pending_otp": {
                                                    "type": "boolean",
                                                    "example": true
                                                },
                                                "masked_identifier": {
                                                    "type": "string",
                                                    "example": "us**@example.com"
                                                },
                                                "expires_at": {
                                                    "type": "string",
                                                    "example": "2025-08-07 18:05:00"
                                                },
                                                "type": {
                                                    "type": "string",
                                                    "example": "email"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/otp/cleanup": {
            "delete": {
                "tags": [
                    "OTP"
                ],
                "summary": "Nettoyer les anciens codes OTP (Admin only)",
                "operationId": "32b1e92d3fb6208119c7a75ed92e37d8",
                "responses": {
                    "200": {
                        "description": "Nettoyage effectué",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Nettoyage effectué"
                                        },
                                        "data": {
                                            "properties": {
                                                "deleted_count": {
                                                    "type": "integer",
                                                    "example": 15
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/payments/initiate": {
            "post": {
                "tags": [
                    "Payments"
                ],
                "summary": "Initier un paiement pour achat de tickets ou produit",
                "operationId": "09337e33e2aff50f10b00befaf0ae25f",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "type"
                                ],
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "lottery_ticket",
                                            "product_purchase"
                                        ],
                                        "example": "lottery_ticket"
                                    },
                                    "lottery_id": {
                                        "description": "Required for lottery_ticket type",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "product_id": {
                                        "description": "Required for product_purchase type",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "quantity": {
                                        "description": "Number of tickets (for lottery_ticket)",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "phone": {
                                        "description": "Phone for payment",
                                        "type": "string",
                                        "example": "074123456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Paiement initié",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string"
                                        },
                                        "data": {
                                            "properties": {
                                                "bill_id": {
                                                    "type": "string"
                                                },
                                                "reference": {
                                                    "type": "string"
                                                },
                                                "amount": {
                                                    "type": "number"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/payments/callback": {
            "post": {
                "tags": [
                    "Payments"
                ],
                "summary": "Callback E-Billing (Webhook)",
                "operationId": "0b732d8a5ed20f67b03a5e8b20267c0d",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "reference": {
                                        "type": "string"
                                    },
                                    "transactionid": {
                                        "type": "string"
                                    },
                                    "paymentsystem": {
                                        "type": "string"
                                    },
                                    "amount": {
                                        "type": "number"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Callback traité"
                    }
                }
            }
        },
        "/api/payments/{id}/status": {
            "get": {
                "tags": [
                    "Payments"
                ],
                "summary": "Vérifier le statut d'un paiement",
                "operationId": "adc18ab90fbf9829221668152a1b1dfc",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID du paiement",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Statut du paiement"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/payments/success": {
            "get": {
                "tags": [
                    "Payments"
                ],
                "summary": "Page de succès de paiement",
                "operationId": "ef11379b5af0c382479811f7ee3a2fb2",
                "parameters": [
                    {
                        "name": "reference",
                        "in": "query",
                        "description": "Référence du paiement",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Page de succès"
                    }
                }
            }
        },
        "/api/payments/notify": {
            "post": {
                "tags": [
                    "Payments"
                ],
                "summary": "Notification E-Billing (IPN)",
                "operationId": "ab2521c44367d3e67b70dfbf676947b3",
                "responses": {
                    "200": {
                        "description": "Notification traitée"
                    }
                }
            }
        },
        "/api/payments/ussd-push": {
            "post": {
                "tags": [
                    "Payments"
                ],
                "summary": "Déclencher un push USSD",
                "operationId": "f27fc5a34e475b3e862c434d2c05cbe1",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "bill_id",
                                    "payment_system_name",
                                    "payer_msisdn"
                                ],
                                "properties": {
                                    "bill_id": {
                                        "type": "string",
                                        "example": "BILL123456"
                                    },
                                    "payment_system_name": {
                                        "type": "string",
                                        "example": "airtel_money"
                                    },
                                    "payer_msisdn": {
                                        "type": "string",
                                        "example": "074123456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Push USSD envoyé"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/payments/kyc": {
            "get": {
                "tags": [
                    "Payments"
                ],
                "summary": "Récupérer les informations KYC",
                "operationId": "946c715356c8c637ddae58608c6e16b1",
                "parameters": [
                    {
                        "name": "operator",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "airtel_money"
                        }
                    },
                    {
                        "name": "phone",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "074123456"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Données KYC récupérées"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/products": {
            "get": {
                "tags": [
                    "Products"
                ],
                "summary": "Lister tous les produits",
                "operationId": "d97d1c3727cbac49708b85f7d11f7d58",
                "parameters": [
                    {
                        "name": "category_id",
                        "in": "query",
                        "description": "Filtrer par catégorie",
                        "required": false,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "featured",
                        "in": "query",
                        "description": "Produits mis en avant seulement",
                        "required": false,
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "name": "search",
                        "in": "query",
                        "description": "Recherche par nom/description",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "min_price",
                        "in": "query",
                        "description": "Prix minimum",
                        "required": false,
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "name": "max_price",
                        "in": "query",
                        "description": "Prix maximum",
                        "required": false,
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "name": "sort_by",
                        "in": "query",
                        "description": "Trier par",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "price_asc",
                                "price_desc",
                                "date_asc",
                                "date_desc",
                                "name_asc",
                                "name_desc",
                                "popularity"
                            ]
                        }
                    },
                    {
                        "name": "has_lottery",
                        "in": "query",
                        "description": "Produits avec tombola active",
                        "required": false,
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "name": "lottery_ending_soon",
                        "in": "query",
                        "description": "Tombolas se terminant bientôt (24h)",
                        "required": false,
                        "schema": {
                            "type": "boolean"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Liste des produits",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "products": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "tags": [
                    "Products"
                ],
                "summary": "Créer un nouveau produit (Marchands seulement)",
                "operationId": "785644b7d7dd38af4b51dafd0fbc1b6d",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name",
                                    "description",
                                    "price",
                                    "ticket_price",
                                    "category_id"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "iPhone 15 Pro"
                                    },
                                    "description": {
                                        "type": "string",
                                        "example": "Smartphone Apple dernière génération"
                                    },
                                    "price": {
                                        "type": "number",
                                        "format": "float",
                                        "example": 850000
                                    },
                                    "ticket_price": {
                                        "type": "number",
                                        "format": "float",
                                        "example": 2500
                                    },
                                    "category_id": {
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "images": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        }
                                    },
                                    "min_participants": {
                                        "type": "integer",
                                        "example": 300
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Produit créé avec succès",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string"
                                        },
                                        "product": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/products/search": {
            "get": {
                "tags": [
                    "Products"
                ],
                "summary": "Recherche intelligente avec auto-complétion",
                "operationId": "6b588a52a56a41d175df187e5fb615c8",
                "parameters": [
                    {
                        "name": "q",
                        "in": "query",
                        "description": "Terme de recherche",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Nombre de suggestions (max 10)",
                        "required": false,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Suggestions de recherche",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "data": {
                                            "properties": {
                                                "suggestions": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "type": {
                                                                "type": "string",
                                                                "example": "product"
                                                            },
                                                            "title": {
                                                                "type": "string",
                                                                "example": "iPhone 15 Pro"
                                                            },
                                                            "subtitle": {
                                                                "type": "string",
                                                                "example": "Électronique"
                                                            },
                                                            "id": {
                                                                "type": "integer",
                                                                "example": 1
                                                            },
                                                            "price": {
                                                                "type": "number",
                                                                "example": 750000
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                },
                                                "categories": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "id": {
                                                                "type": "integer"
                                                            },
                                                            "name": {
                                                                "type": "string"
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/products/featured": {
            "get": {
                "tags": [
                    "Products"
                ],
                "summary": "Produits mis en avant",
                "operationId": "787711e5f2b08d01a9338d339746e9e1",
                "responses": {
                    "200": {
                        "description": "Produits mis en avant"
                    }
                }
            }
        },
        "/api/products/{id}": {
            "get": {
                "tags": [
                    "Products"
                ],
                "summary": "Détails d'un produit",
                "operationId": "c87fb2e4d617e7b36c712cad358acdb8",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID du produit",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Détails du produit",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "product": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "tags": [
                    "Products"
                ],
                "summary": "Mettre à jour un produit",
                "operationId": "416e4959a3919547eb609d87e3db9135",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID du produit",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Produit mis à jour"
                    },
                    "403": {
                        "description": "Non autorisé"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/products/{id}/create-lottery": {
            "post": {
                "tags": [
                    "Products"
                ],
                "summary": "Créer une tombola pour un produit",
                "operationId": "0cc3e0afa739a2a67e4b2078084c6060",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "ID du produit",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "duration_days": {
                                        "description": "Durée en jours",
                                        "type": "integer",
                                        "example": 7
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Tombola créée"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        }
    },
    "components": {
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "description": "Authentification via token Bearer JWT",
                "bearerFormat": "JWT",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "Authentication",
            "description": "Endpoints d'authentification et gestion utilisateurs"
        },
        {
            "name": "Categories",
            "description": "Gestion des catégories de produits"
        },
        {
            "name": "Countries",
            "description": "Gestion des pays et localisation"
        },
        {
            "name": "Languages",
            "description": "Gestion des langues et internationalisation"
        },
        {
            "name": "Lotteries",
            "description": "Gestion des tombolas et tirages"
        },
        {
            "name": "OTP",
            "description": "Gestion des codes de vérification OTP (SMS/Email)"
        },
        {
            "name": "Payments",
            "description": "Système de paiement E-Billing et Mobile Money"
        },
        {
            "name": "Products",
            "description": "Gestion des produits et catalogue"
        }
    ]
}